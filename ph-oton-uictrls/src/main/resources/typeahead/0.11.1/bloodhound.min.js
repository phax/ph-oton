(function(g,e){"function"===typeof define&&define.amd?define("bloodhound",["jquery"],function(q){return g.Bloodhound=e(q)}):"object"===typeof exports?module.exports=e(require("jquery")):g.Bloodhound=e(jQuery)})(this,function(g){var e=function(){return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(b){return!b||/^\s*$/.test(b)},escapeRegExChars:function(b){return b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,
"\\$&")},isString:function(b){return"string"===typeof b},isNumber:function(b){return"number"===typeof b},isArray:g.isArray,isFunction:g.isFunction,isObject:g.isPlainObject,isUndefined:function(b){return"undefined"===typeof b},isElement:function(b){return!(!b||1!==b.nodeType)},isJQuery:function(b){return b instanceof g},toStr:function(b){return e.isUndefined(b)||null===b?"":b+""},bind:g.proxy,each:function(b,f){g.each(b,function(b,a){return f(a,b)})},map:g.map,filter:g.grep,every:function(b,f){var d=
!0;if(!b)return d;g.each(b,function(a,h){if(!(d=f.call(null,h,a,b)))return!1});return!!d},some:function(b,f){var d=!1;if(!b)return d;g.each(b,function(a,h){if(d=f.call(null,h,a,b))return!1});return!!d},mixin:g.extend,identity:function(b){return b},clone:function(b){return g.extend(!0,{},b)},getIdGenerator:function(){var b=0;return function(){return b++}},templatify:function(b){function f(){return String(b)}return g.isFunction(b)?b:f},defer:function(b){setTimeout(b,0)},debounce:function(b,f,d){var a,
h;return function(){var c=this,m=arguments,k;k=d&&!a;clearTimeout(a);a=setTimeout(function(){a=null;d||(h=b.apply(c,m))},f);k&&(h=b.apply(c,m));return h}},throttle:function(b,f){var d,a,h,c,m,k;m=0;k=function(){m=new Date;h=null;c=b.apply(d,a)};return function(){var e=new Date,g=f-(e-m);d=this;a=arguments;0>=g?(clearTimeout(h),h=null,m=e,c=b.apply(d,a)):h||(h=setTimeout(k,g));return c}},stringify:function(b){return e.isString(b)?b:JSON.stringify(b)},noop:function(){}}}(),q=function(){function b(a){return(a=
e.toStr(a))?a.split(/\s+/):[]}function f(a){return(a=e.toStr(a))?a.split(/\W+/):[]}function d(a){return function(h){h=e.isArray(h)?h:[].slice.call(arguments,0);return function(c){var b=[];e.each(h,function(h){b=b.concat(a(e.toStr(c[h])))});return b}}}return{nonword:f,whitespace:b,obj:{nonword:d(f),whitespace:d(b)}}}(),r=function(){function b(a){this.maxSize=e.isNumber(a)?a:100;this.reset();0>=this.maxSize&&(this.set=this.get=g.noop)}function f(){this.head=this.tail=null}function d(a,h){this.key=a;
this.val=h;this.prev=this.next=null}e.mixin(b.prototype,{set:function(a,h){var c=this.list.tail;this.size>=this.maxSize&&(this.list.remove(c),delete this.hash[c.key],this.size--);(c=this.hash[a])?(c.val=h,this.list.moveToFront(c)):(c=new d(a,h),this.list.add(c),this.hash[a]=c,this.size++)},get:function(a){if(a=this.hash[a])return this.list.moveToFront(a),a.val},reset:function(){this.size=0;this.hash={};this.list=new f}});e.mixin(f.prototype,{add:function(a){this.head&&(a.next=this.head,this.head.prev=
a);this.head=a;this.tail=this.tail||a},remove:function(a){a.prev?a.prev.next=a.next:this.head=a.next;a.next?a.next.prev=a.prev:this.tail=a.prev},moveToFront:function(a){this.remove(a);this.add(a)}});return b}(),u=function(){function b(a,c){this.prefix=["__",a,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix));this.ls=c||d;!this.ls&&this._noop()}function f(a){return JSON.stringify(e.isUndefined(a)?null:a)}var d;try{d=window.localStorage,d.setItem("~~~",
"!"),d.removeItem("~~~")}catch(a){d=null}e.mixin(b.prototype,{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=e.noop},_safeSet:function(a,c){try{this.ls.setItem(a,c)}catch(b){"QuotaExceededError"===b.name&&(this.clear(),this._noop())}},get:function(a){this.isExpired(a)&&this.remove(a);a=this.ls.getItem(this._prefix(a));return g.parseJSON(a)},set:function(a,c,b){e.isNumber(b)?
this._safeSet(this._ttlKey(a),f((new Date).getTime()+b)):this.ls.removeItem(this._ttlKey(a));return this._safeSet(this._prefix(a),f(c))},remove:function(a){this.ls.removeItem(this._ttlKey(a));this.ls.removeItem(this._prefix(a));return this},clear:function(){var a;a=this.keyMatcher;var c,b,f=[],e=d.length;for(c=0;c<e;c++)(b=d.key(c)).match(a)&&f.push(b.replace(a,""));for(a=f.length;a--;)this.remove(f[a]);return this},isExpired:function(a){a=this.ls.getItem(this._ttlKey(a));a=g.parseJSON(a);return e.isNumber(a)&&
(new Date).getTime()>a?!0:!1}});return b}(),t=function(){function b(c){c=c||{};this.cancelled=!1;this.lastReq=null;this._send=c.transport;this._get=c.limiter?c.limiter(this._get):this._get;this._cache=!1===c.cache?new r(0):h}var f=0,d={},a=6,h=new r(10);b.setMaxPendingRequests=function(c){a=c};b.resetCache=function(){h.reset()};e.mixin(b.prototype,{_fingerprint:function(c){c=c||{};return c.url+c.type+g.param(c.data||{})},_get:function(c,b){function h(c){b(null,c);n._cache.set(l,c)}function e(){b(!0)}
function g(){f--;delete d[l];n.onDeckRequestArgs&&(n._get.apply(n,n.onDeckRequestArgs),n.onDeckRequestArgs=null)}var n=this,l,p;l=this._fingerprint(c);this.cancelled||l!==this.lastReq||((p=d[l])?p.done(h).fail(e):f<a?(f++,d[l]=this._send(c).done(h).fail(e).always(g)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(c,a){var b,d;a=a||g.noop;c=e.isString(c)?{url:c}:c||{};d=this._fingerprint(c);this.cancelled=!1;this.lastReq=d;(b=this._cache.get(d))?a(null,b):this._get(c,a)},cancel:function(){this.cancelled=
!0}});return b}(),v=window.SearchIndex=function(){function b(a){a=a||{};a.datumTokenizer&&a.queryTokenizer||g.error("datumTokenizer and queryTokenizer are both required");this.identify=a.identify||e.stringify;this.datumTokenizer=a.datumTokenizer;this.queryTokenizer=a.queryTokenizer;this.reset()}function f(a){a=e.filter(a,function(a){return!!a});return a=e.map(a,function(a){return a.toLowerCase()})}function d(a){for(var b={},c=[],d=0,f=a.length;d<f;d++)b[a[d]]||(b[a[d]]=!0,c.push(a[d]));return c}e.mixin(b.prototype,
{bootstrap:function(a){this.datums=a.datums;this.trie=a.trie},add:function(a){var b=this;a=e.isArray(a)?a:[a];e.each(a,function(c){var a;b.datums[a=b.identify(c)]=c;c=f(b.datumTokenizer(c));e.each(c,function(c){var d,f;d=b.trie;for(c=c.split("");f=c.shift();)d=d.c[f]||(d.c[f]={i:[],c:{}}),d.i.push(a)})})},get:function(a){var b=this;return e.map(a,function(c){return b.datums[c]})},search:function(a){var b=this,c;a=f(this.queryTokenizer(a));e.each(a,function(a){var d,f;if(c&&0===c.length)return!1;d=
b.trie;for(a=a.split("");d&&(f=a.shift());)d=d.c[f];if(d&&0===a.length){f=d.i.slice(0);if(c){d=c;var e=a=0,g=[];d=d.sort();f=f.sort();for(var l=d.length,p=f.length;a<l&&e<p;)d[a]<f[e]?a++:(d[a]>f[e]||(g.push(d[a]),a++),e++);d=g}else d=f;c=d}else return c=[],!1});return c?e.map(d(c),function(a){return b.datums[a]}):[]},all:function(){var a=[],b;for(b in this.datums)a.push(this.datums[b]);return a},reset:function(){this.datums={};this.trie={i:[],c:{}}},serialize:function(){return{datums:this.datums,
trie:this.trie}}});return b}(),w=function(){function b(b){this.url=b.url;this.ttl=b.ttl;this.cache=b.cache;this.prepare=b.prepare;this.transform=b.transform;this.transport=b.transport;this.thumbprint=b.thumbprint;this.storage=new u(b.cacheKey)}e.mixin(b.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(b){this.cache&&(this.storage.set("data",b,this.ttl),this.storage.set("protocol",location.protocol,this.ttl),this.storage.set("thumbprint",this.thumbprint,
this.ttl))},fromCache:function(){var b,d;if(!this.cache)return null;b=this.storage.get("data");d=this.storage.get("protocol");d=this.storage.get("thumbprint")!==this.thumbprint||d!==location.protocol;return b&&!d?b:null},fromNetwork:function(b){function d(){b(!0)}function a(a){b(null,e.transform(a))}var e=this,c;b&&(c=this.prepare(this._settings()),this.transport(c).fail(d).done(a))},clear:function(){this.storage.clear();return this}});return b}(),x=function(){function b(b){this.url=b.url;this.prepare=
b.prepare;this.transform=b.transform;this.transport=new t({cache:b.cache,limiter:b.limiter,transport:b.transport})}e.mixin(b.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},get:function(b,d){function a(a,c){a?d([]):d(e.transform(c))}var e=this,c;if(d)return c=this.prepare(b||"",this._settings()),this.transport.get(c,a)},cancelLastRequest:function(){this.transport.cancel()}});return b}(),y=function(){function b(a){var b;if(!a)return null;b={url:null,ttl:864E5,cache:!0,
cacheKey:null,thumbprint:"",prepare:e.identity,transform:e.identity,transport:null};a=e.isString(a)?{url:a}:a;a=e.mixin(b,a);!a.url&&g.error("prefetch requires url to be set");a.transform=a.filter||a.transform;a.cacheKey=a.cacheKey||a.url;a.thumbprint="0.11.1"+a.thumbprint;a.transport=a.transport?h(a.transport):g.ajax;return a}function f(c){var b;if(c)return b={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:e.identity,transport:null},
c=e.isString(c)?{url:c}:c,c=e.mixin(b,c),!c.url&&g.error("remote requires url to be set"),c.transform=c.filter||c.transform,c.prepare=d(c),c.limiter=a(c),c.transport=c.transport?h(c.transport):g.ajax,delete c.replace,delete c.wildcard,delete c.rateLimitBy,delete c.rateLimitWait,c}function d(a){function b(a,c){c.url=h(c.url,a);return c}function d(a,b){b.url=b.url.replace(g,encodeURIComponent(a));return b}function e(a,b){return b}var f,h,g;f=a.prepare;h=a.replace;g=a.wildcard;return f?f:f=h?b:a.wildcard?
d:e}function a(a){function b(a){return function(b){return e.debounce(b,a)}}function d(a){return function(b){return e.throttle(b,a)}}var f,h;f=a.limiter;h=a.rateLimitBy;a=a.rateLimitWait;f||(f=/^throttle$/i.test(h)?d(a):b(a));return f}function h(a){return function(b){var d=g.Deferred();a(b,function(a){e.defer(function(){d.resolve(a)})},function(a){e.defer(function(){d.reject(a)})});return d}}return function(a){var d;a=e.mixin({initialize:!0,identify:e.stringify,datumTokenizer:null,queryTokenizer:null,
sufficient:5,sorter:null,local:[],prefetch:null,remote:null},a||{});!a.datumTokenizer&&g.error("datumTokenizer is required");!a.queryTokenizer&&g.error("queryTokenizer is required");d=a.sorter;a.sorter=d?function(a){return a.sort(d)}:e.identity;a.local=e.isFunction(a.local)?a.local():a.local;a.prefetch=b(a.prefetch);a.remote=f(a.remote);return a}}();return function(){function b(b){b=y(b);this.sorter=b.sorter;this.identify=b.identify;this.sufficient=b.sufficient;this.local=b.local;this.remote=b.remote?
new x(b.remote):null;this.prefetch=b.prefetch?new w(b.prefetch):null;this.index=new v({identify:this.identify,datumTokenizer:b.datumTokenizer,queryTokenizer:b.queryTokenizer});!1!==b.initialize&&this.initialize()}var f;f=window&&window.Bloodhound;b.noConflict=function(){window&&(window.Bloodhound=f);return b};b.tokenizers=q;e.mixin(b.prototype,{__ttAdapter:function(){function b(a,d,f){return e.search(a,d,f)}function a(a,b){return e.search(a,b)}var e=this;return this.remote?b:a},_loadPrefetch:function(){function b(c,
d){if(c)return e.reject();a.add(d);a.prefetch.store(a.index.serialize());e.resolve()}var a=this,e,c;e=g.Deferred();this.prefetch?(c=this.prefetch.fromCache())?(this.index.bootstrap(c),e.resolve()):this.prefetch.fromNetwork(b):e.resolve();return e.promise()},_initialize:function(){var b=this;this.clear();(this.initPromise=this._loadPrefetch()).done(function(){b.add(b.local)});return this.initPromise},initialize:function(b){return!this.initPromise||b?this._initialize():this.initPromise},add:function(b){this.index.add(b);
return this},get:function(b){b=e.isArray(b)?b:[].slice.call(arguments);return this.index.get(b)},search:function(b,a,f){function c(a){var b=[];e.each(a,function(a){!e.some(k,function(b){return g.identify(a)===g.identify(b)})&&b.push(a)});f&&f(b)}var g=this,k;k=this.sorter(this.index.search(b));a(this.remote?k.slice():k);this.remote&&k.length<this.sufficient?this.remote.get(b,c):this.remote&&this.remote.cancelLastRequest();return this},all:function(){return this.index.all()},clear:function(){this.index.reset();
return this},clearPrefetchCache:function(){this.prefetch&&this.prefetch.clear();return this},clearRemoteCache:function(){t.resetCache();return this},ttAdapter:function(){return this.__ttAdapter()}});return b}()});
