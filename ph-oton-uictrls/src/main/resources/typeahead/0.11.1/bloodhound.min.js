(function(g,e){"function"===typeof define&&define.amd?define("bloodhound",["jquery"],function(q){return g.Bloodhound=e(q)}):"object"===typeof exports?module.exports=e(require("jquery")):g.Bloodhound=e(jQuery)})(this,function(g){var e=function(){return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(b){return!b||/^\s*$/.test(b)},escapeRegExChars:function(b){return b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,
"\\$&")},isString:function(b){return"string"===typeof b},isNumber:function(b){return"number"===typeof b},isArray:g.isArray,isFunction:g.isFunction,isObject:g.isPlainObject,isUndefined:function(b){return"undefined"===typeof b},isElement:function(b){return!(!b||1!==b.nodeType)},isJQuery:function(b){return b instanceof g},toStr:function(b){return e.isUndefined(b)||null===b?"":b+""},bind:g.proxy,each:function(b,f){g.each(b,function(b,a){return f(a,b)})},map:g.map,filter:g.grep,every:function(b,f){var c=
!0;if(!b)return c;g.each(b,function(a,h){if(!(c=f.call(null,h,a,b)))return!1});return!!c},some:function(b,f){var c=!1;if(!b)return c;g.each(b,function(a,h){if(c=f.call(null,h,a,b))return!1});return!!c},mixin:g.extend,identity:function(b){return b},clone:function(b){return g.extend(!0,{},b)},getIdGenerator:function(){var b=0;return function(){return b++}},templatify:function(b){function f(){return String(b)}return g.isFunction(b)?b:f},defer:function(b){setTimeout(b,0)},debounce:function(b,f,c){var a,
h;return function(){var d=this,k=arguments,l;l=c&&!a;clearTimeout(a);a=setTimeout(function(){a=null;c||(h=b.apply(d,k))},f);l&&(h=b.apply(d,k));return h}},throttle:function(b,f){var c,a,h,d,k,l;k=0;l=function(){k=new Date;h=null;d=b.apply(c,a)};return function(){var e=new Date,g=f-(e-k);c=this;a=arguments;0>=g?(clearTimeout(h),h=null,k=e,d=b.apply(c,a)):h||(h=setTimeout(l,g));return d}},stringify:function(b){return e.isString(b)?b:JSON.stringify(b)},noop:function(){}}}(),q=function(){function b(a){return(a=
e.toStr(a))?a.split(/\s+/):[]}function f(a){return(a=e.toStr(a))?a.split(/\W+/):[]}function c(a){return function(b){b=e.isArray(b)?b:[].slice.call(arguments,0);return function(d){var c=[];e.each(b,function(b){c=c.concat(a(e.toStr(d[b])))});return c}}}return{nonword:f,whitespace:b,obj:{nonword:c(f),whitespace:c(b)}}}(),r=function(){function b(a){this.maxSize=e.isNumber(a)?a:100;this.reset();0>=this.maxSize&&(this.set=this.get=g.noop)}function f(){this.head=this.tail=null}function c(a,b){this.key=a;
this.val=b;this.prev=this.next=null}e.mixin(b.prototype,{set:function(a,b){var d=this.list.tail;this.size>=this.maxSize&&(this.list.remove(d),delete this.hash[d.key],this.size--);(d=this.hash[a])?(d.val=b,this.list.moveToFront(d)):(d=new c(a,b),this.list.add(d),this.hash[a]=d,this.size++)},get:function(a){if(a=this.hash[a])return this.list.moveToFront(a),a.val},reset:function(){this.size=0;this.hash={};this.list=new f}});e.mixin(f.prototype,{add:function(a){this.head&&(a.next=this.head,this.head.prev=
a);this.head=a;this.tail=this.tail||a},remove:function(a){a.prev?a.prev.next=a.next:this.head=a.next;a.next?a.next.prev=a.prev:this.tail=a.prev},moveToFront:function(a){this.remove(a);this.add(a)}});return b}(),u=function(){function b(a,b){this.prefix=["__",a,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix));this.ls=b||c;!this.ls&&this._noop()}function f(a){return JSON.stringify(e.isUndefined(a)?null:a)}var c;try{c=window.localStorage,c.setItem("~~~",
"!"),c.removeItem("~~~")}catch(a){c=null}e.mixin(b.prototype,{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},_noop:function(){this.get=this.set=this.remove=this.clear=this.isExpired=e.noop},_safeSet:function(a,b){try{this.ls.setItem(a,b)}catch(d){"QuotaExceededError"===d.name&&(this.clear(),this._noop())}},get:function(a){this.isExpired(a)&&this.remove(a);a=this.ls.getItem(this._prefix(a));return g.parseJSON(a)},set:function(a,b,d){e.isNumber(d)?
this._safeSet(this._ttlKey(a),f((new Date).getTime()+d)):this.ls.removeItem(this._ttlKey(a));return this._safeSet(this._prefix(a),f(b))},remove:function(a){this.ls.removeItem(this._ttlKey(a));this.ls.removeItem(this._prefix(a));return this},clear:function(){var a;a=this.keyMatcher;var b,d,k=[],f=c.length;for(b=0;b<f;b++)(d=c.key(b)).match(a)&&k.push(d.replace(a,""));for(a=k.length;a--;)this.remove(k[a]);return this},isExpired:function(a){a=this.ls.getItem(this._ttlKey(a));a=g.parseJSON(a);return e.isNumber(a)&&
(new Date).getTime()>a?!0:!1}});return b}(),t=function(){function b(d){d=d||{};this.cancelled=!1;this.lastReq=null;this._send=d.transport;this._get=d.limiter?d.limiter(this._get):this._get;this._cache=!1===d.cache?new r(0):h}var f=0,c={},a=6,h=new r(10);b.setMaxPendingRequests=function(d){a=d};b.resetCache=function(){h.reset()};e.mixin(b.prototype,{_fingerprint:function(d){d=d||{};return d.url+d.type+g.param(d.data||{})},_get:function(d,b){function e(d){b(null,d);n._cache.set(m,d)}function h(){b(!0)}
function g(){f--;delete c[m];n.onDeckRequestArgs&&(n._get.apply(n,n.onDeckRequestArgs),n.onDeckRequestArgs=null)}var n=this,m,p;m=this._fingerprint(d);this.cancelled||m!==this.lastReq||((p=c[m])?p.done(e).fail(h):f<a?(f++,c[m]=this._send(d).done(e).fail(h).always(g)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(d,a){var b,c;a=a||g.noop;d=e.isString(d)?{url:d}:d||{};c=this._fingerprint(d);this.cancelled=!1;this.lastReq=c;(b=this._cache.get(c))?a(null,b):this._get(d,a)},cancel:function(){this.cancelled=
!0}});return b}(),v=window.SearchIndex=function(){function b(a){a=a||{};a.datumTokenizer&&a.queryTokenizer||g.error("datumTokenizer and queryTokenizer are both required");this.identify=a.identify||e.stringify;this.datumTokenizer=a.datumTokenizer;this.queryTokenizer=a.queryTokenizer;this.reset()}function f(a){a=e.filter(a,function(a){return!!a});return a=e.map(a,function(a){return a.toLowerCase()})}function c(a){for(var b={},d=[],c=0,f=a.length;c<f;c++)b[a[c]]||(b[a[c]]=!0,d.push(a[c]));return d}e.mixin(b.prototype,
{bootstrap:function(a){this.datums=a.datums;this.trie=a.trie},add:function(a){var b=this;a=e.isArray(a)?a:[a];e.each(a,function(d){var a;b.datums[a=b.identify(d)]=d;d=f(b.datumTokenizer(d));e.each(d,function(d){var c,f;c=b.trie;for(d=d.split("");f=d.shift();)c=c.c[f]||(c.c[f]={i:[],c:{}}),c.i.push(a)})})},get:function(a){var b=this;return e.map(a,function(d){return b.datums[d]})},search:function(a){var b=this,d;a=f(this.queryTokenizer(a));e.each(a,function(a){var c,f;if(d&&0===d.length)return!1;c=
b.trie;for(a=a.split("");c&&(f=a.shift());)c=c.c[f];if(c&&0===a.length){f=c.i.slice(0);if(d){c=d;var e=a=0,g=[];c=c.sort();f=f.sort();for(var m=c.length,p=f.length;a<m&&e<p;)c[a]<f[e]?a++:(c[a]>f[e]||(g.push(c[a]),a++),e++);c=g}else c=f;d=c}else return d=[],!1});return d?e.map(c(d),function(a){return b.datums[a]}):[]},all:function(){var a=[],b;for(b in this.datums)a.push(this.datums[b]);return a},reset:function(){this.datums={};this.trie={i:[],c:{}}},serialize:function(){return{datums:this.datums,
trie:this.trie}}});return b}(),w=function(){function b(b){this.url=b.url;this.ttl=b.ttl;this.cache=b.cache;this.prepare=b.prepare;this.transform=b.transform;this.transport=b.transport;this.thumbprint=b.thumbprint;this.storage=new u(b.cacheKey)}e.mixin(b.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},store:function(b){this.cache&&(this.storage.set("data",b,this.ttl),this.storage.set("protocol",location.protocol,this.ttl),this.storage.set("thumbprint",this.thumbprint,
this.ttl))},fromCache:function(){var b,c;if(!this.cache)return null;b=this.storage.get("data");c=this.storage.get("protocol");c=this.storage.get("thumbprint")!==this.thumbprint||c!==location.protocol;return b&&!c?b:null},fromNetwork:function(b){function c(){b(!0)}function a(a){b(null,e.transform(a))}var e=this,d;b&&(d=this.prepare(this._settings()),this.transport(d).fail(c).done(a))},clear:function(){this.storage.clear();return this}});return b}(),x=function(){function b(b){this.url=b.url;this.prepare=
b.prepare;this.transform=b.transform;this.transport=new t({cache:b.cache,limiter:b.limiter,transport:b.transport})}e.mixin(b.prototype,{_settings:function(){return{url:this.url,type:"GET",dataType:"json"}},get:function(b,c){function a(a,d){a?c([]):c(e.transform(d))}var e=this,d;if(c)return d=this.prepare(b||"",this._settings()),this.transport.get(d,a)},cancelLastRequest:function(){this.transport.cancel()}});return b}(),y=function(){function b(a){var b;if(!a)return null;b={url:null,ttl:864E5,cache:!0,
cacheKey:null,thumbprint:"",prepare:e.identity,transform:e.identity,transport:null};a=e.isString(a)?{url:a}:a;a=e.mixin(b,a);!a.url&&g.error("prefetch requires url to be set");a.transform=a.filter||a.transform;a.cacheKey=a.cacheKey||a.url;a.thumbprint="0.11.1"+a.thumbprint;a.transport=a.transport?h(a.transport):g.ajax;return a}function f(b){var f;if(b)return f={url:null,cache:!0,prepare:null,replace:null,wildcard:null,limiter:null,rateLimitBy:"debounce",rateLimitWait:300,transform:e.identity,transport:null},
b=e.isString(b)?{url:b}:b,b=e.mixin(f,b),!b.url&&g.error("remote requires url to be set"),b.transform=b.filter||b.transform,b.prepare=c(b),b.limiter=a(b),b.transport=b.transport?h(b.transport):g.ajax,delete b.replace,delete b.wildcard,delete b.rateLimitBy,delete b.rateLimitWait,b}function c(a){function b(a,d){d.url=g(d.url,a);return d}function c(a,b){b.url=b.url.replace(h,encodeURIComponent(a));return b}function e(a,b){return b}var f,g,h;f=a.prepare;g=a.replace;h=a.wildcard;return f?f:f=g?b:a.wildcard?
c:e}function a(a){function b(a){return function(b){return e.debounce(b,a)}}function c(a){return function(b){return e.throttle(b,a)}}var f,g;f=a.limiter;g=a.rateLimitBy;a=a.rateLimitWait;f||(f=/^throttle$/i.test(g)?c(a):b(a));return f}function h(a){return function(b){var c=g.Deferred();a(b,function(a){e.defer(function(){c.resolve(a)})},function(a){e.defer(function(){c.reject(a)})});return c}}return function(a){var c;a=e.mixin({initialize:!0,identify:e.stringify,datumTokenizer:null,queryTokenizer:null,
sufficient:5,sorter:null,local:[],prefetch:null,remote:null},a||{});!a.datumTokenizer&&g.error("datumTokenizer is required");!a.queryTokenizer&&g.error("queryTokenizer is required");c=a.sorter;a.sorter=c?function(a){return a.sort(c)}:e.identity;a.local=e.isFunction(a.local)?a.local():a.local;a.prefetch=b(a.prefetch);a.remote=f(a.remote);return a}}();return function(){function b(b){b=y(b);this.sorter=b.sorter;this.identify=b.identify;this.sufficient=b.sufficient;this.local=b.local;this.remote=b.remote?
new x(b.remote):null;this.prefetch=b.prefetch?new w(b.prefetch):null;this.index=new v({identify:this.identify,datumTokenizer:b.datumTokenizer,queryTokenizer:b.queryTokenizer});!1!==b.initialize&&this.initialize()}var f;f=window&&window.Bloodhound;b.noConflict=function(){window&&(window.Bloodhound=f);return b};b.tokenizers=q;e.mixin(b.prototype,{__ttAdapter:function(){function b(a,c,f){return e.search(a,c,f)}function a(a,b){return e.search(a,b)}var e=this;return this.remote?b:a},_loadPrefetch:function(){function b(c,
d){if(c)return e.reject();a.add(d);a.prefetch.store(a.index.serialize());e.resolve()}var a=this,e,d;e=g.Deferred();this.prefetch?(d=this.prefetch.fromCache())?(this.index.bootstrap(d),e.resolve()):this.prefetch.fromNetwork(b):e.resolve();return e.promise()},_initialize:function(){var b=this;this.clear();(this.initPromise=this._loadPrefetch()).done(function(){b.add(b.local)});return this.initPromise},initialize:function(b){return!this.initPromise||b?this._initialize():this.initPromise},add:function(b){this.index.add(b);
return this},get:function(b){b=e.isArray(b)?b:[].slice.call(arguments);return this.index.get(b)},search:function(b,a,f){function d(a){var b=[];e.each(a,function(a){!e.some(l,function(b){return g.identify(a)===g.identify(b)})&&b.push(a)});f&&f(b)}var g=this,l;l=this.sorter(this.index.search(b));a(this.remote?l.slice():l);this.remote&&l.length<this.sufficient?this.remote.get(b,d):this.remote&&this.remote.cancelLastRequest();return this},all:function(){return this.index.all()},clear:function(){this.index.reset();
return this},clearPrefetchCache:function(){this.prefetch&&this.prefetch.clear();return this},clearRemoteCache:function(){t.resetCache();return this},ttAdapter:function(){return this.__ttAdapter()}});return b}()});
