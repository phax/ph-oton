(function(f){var e=function(){return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(c){return!c||/^\s*$/.test(c)},escapeRegExChars:function(c){return c.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(c){return"string"===typeof c},isNumber:function(c){return"number"===typeof c},isArray:f.isArray,isFunction:f.isFunction,isObject:f.isPlainObject,isUndefined:function(c){return"undefined"===
typeof c},toStr:function(c){return e.isUndefined(c)||null===c?"":c+""},bind:f.proxy,each:function(c,e){f.each(c,function(d,b){return e(b,d)})},map:f.map,filter:f.grep,every:function(c,e){var d=!0;if(!c)return d;f.each(c,function(b,a){if(!(d=e.call(null,a,b,c)))return!1});return!!d},some:function(c,e){var d=!1;if(!c)return d;f.each(c,function(b,a){if(d=e.call(null,a,b,c))return!1});return!!d},mixin:f.extend,getUniqueId:function(){var c=0;return function(){return c++}}(),templatify:function(c){function e(){return String(c)}
return f.isFunction(c)?c:e},defer:function(c){setTimeout(c,0)},debounce:function(c,e,d){var b,a;return function(){var g=this,k=arguments,l;l=d&&!b;clearTimeout(b);b=setTimeout(function(){b=null;d||(a=c.apply(g,k))},e);l&&(a=c.apply(g,k));return a}},throttle:function(c,e){var d,b,a,g,k,l;k=0;l=function(){k=new Date;a=null;g=c.apply(d,b)};return function(){var h=new Date,f=e-(h-k);d=this;b=arguments;0>=f?(clearTimeout(a),a=null,k=h,g=c.apply(d,b)):a||(a=setTimeout(l,f));return g}},noop:function(){}}}(),
p=function(){var c={wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},
ltr:{left:"0",right:"auto"},rtl:{left:"auto",right:" 0"}};e.isMsie()&&e.mixin(c.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"});e.isMsie()&&7>=e.isMsie()&&e.mixin(c.input,{marginTop:"-1px"});return c}(),t=function(){function c(c){c&&c.el||f.error("EventBus initialized without el");this.$el=f(c.el)}e.mixin(c.prototype,{trigger:function(c){var d=[].slice.call(arguments,1);this.$el.trigger("typeahead:"+c,d)}});return c}(),r=function(){function c(a,
k,c,e){if(!c)return this;k=k.split(b);c=e?d(c,e):c;for(this._callbacks=this._callbacks||{};e=k.shift();)this._callbacks[e]=this._callbacks[e]||{sync:[],async:[]},this._callbacks[e][a].push(c);return this}function e(a,b,d){return function(){for(var c,e=0,f=a.length;!c&&e<f;e+=1)c=!1===a[e].apply(b,d);return!c}}function d(a,b){return a.bind?a.bind(b):function(){a.apply(b,[].slice.call(arguments,0))}}var b=/\s+/,a=function(){return window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},
0)}}();return{onSync:function(a,b,d){return c.call(this,"sync",a,b,d)},onAsync:function(a,b,d){return c.call(this,"async",a,b,d)},off:function(a){var d;if(!this._callbacks)return this;for(a=a.split(b);d=a.shift();)delete this._callbacks[d];return this},trigger:function(g){var d,c,f,m,u;if(!this._callbacks)return this;g=g.split(b);for(f=[].slice.call(arguments,1);(d=g.shift())&&(c=this._callbacks[d]);)m=e(c.sync,this,[d].concat(f)),u=e(c.async,this,[d].concat(f)),m()&&a(u);return this}}}(),w=function(c){function f(b,
a,d){for(var c=[],l=0,h=b.length;l<h;l++)c.push(e.escapeRegExChars(b[l]));b=d?"\\b("+c.join("|")+")\\b":"("+c.join("|")+")";return a?new RegExp(b):new RegExp(b,"i")}var d={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(b){function a(a){var d,g,e;if(d=k.exec(a.data))e=c.createElement(b.tagName),b.className&&(e.className=b.className),g=a.splitText(d.index),g.splitText(d[0].length),e.appendChild(g.cloneNode(!0)),a.parentNode.replaceChild(e,g);return!!d}
function g(a,b){for(var d,c=0;c<a.childNodes.length;c++)d=a.childNodes[c],3===d.nodeType?c+=b(d)?1:0:g(d,b)}var k;b=e.mixin({},d,b);b.node&&b.pattern&&(b.pattern=e.isArray(b.pattern)?b.pattern:[b.pattern],k=f(b.pattern,b.caseSensitive,b.wordsOnly),g(b.node,a))}}(window.document),v=function(){function c(a){var d=this,c,l,h,m;a=a||{};a.input||f.error("input is missing");c=e.bind(this._onBlur,this);l=e.bind(this._onFocus,this);h=e.bind(this._onKeydown,this);m=e.bind(this._onInput,this);this.$hint=f(a.hint);
this.$input=f(a.input).on("blur.tt",c).on("focus.tt",l).on("keydown.tt",h);0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=e.noop);if(e.isMsie())this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){b[a.which||a.keyCode]||e.defer(e.bind(d._onInput,d,a))});else this.$input.on("input.tt",m);this.query=this.$input.val();this.$overflowHelper=n(this.$input)}function n(a){return f('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",
whiteSpace:"pre",fontFamily:a.css("font-family"),fontSize:a.css("font-size"),fontStyle:a.css("font-style"),fontVariant:a.css("font-variant"),fontWeight:a.css("font-weight"),wordSpacing:a.css("word-spacing"),letterSpacing:a.css("letter-spacing"),textIndent:a.css("text-indent"),textRendering:a.css("text-rendering"),textTransform:a.css("text-transform")}).insertAfter(a)}function d(a){return a.altKey||a.ctrlKey||a.metaKey||a.shiftKey}var b;b={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};
c.normalizeQuery=function(a){return(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")};e.mixin(c.prototype,r,{_onBlur:function(){this.resetInputValue();this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(a){var d=b[a.which||a.keyCode];this._managePreventDefault(d,a);d&&this._shouldTrigger(d,a)&&this.trigger(d+"Keyed",a)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(a,b){var c,e;switch(a){case "tab":c=this.getHint();e=this.getInputValue();
c=c&&c!==e&&!d(b);break;case "up":case "down":c=!d(b);break;default:c=!1}c&&b.preventDefault()},_shouldTrigger:function(a,b){var c;switch(a){case "tab":c=!d(b);break;default:c=!0}return c},_checkInputValue:function(){var a,b,d;a=this.getInputValue();b=this.query;d=(b=c.normalizeQuery(a)===c.normalizeQuery(b))?this.query.length!==a.length:!1;this.query=a;b?d&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},
getQuery:function(){return this.query},setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,b){this.$input.val(a);b?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(a){this.$hint.val(a)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var a,b;a=this.getInputValue();b=this.getHint();b=a!==b&&0===b.indexOf(a);
""!==a&&b&&!this.hasOverflow()||this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var a=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=a},isCursorAtEnd:function(){var a,b;a=this.$input.val().length;b=this.$input[0].selectionStart;return e.isNumber(b)?b===a:document.selection?(b=document.selection.createRange(),b.moveStart("character",-a),a===b.text.length):
!0},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null}});return c}(),q=function(){function c(b){b=b||{};b.templates=b.templates||{};b.source||f.error("missing source");b.name&&!/^[_a-zA-Z0-9-]+$/.test(b.name)&&f.error("invalid dataset name: "+b.name);this.query=null;this.highlight=!!b.highlight;this.name=b.name||e.getUniqueId();this.source=b.source;this.displayFn=n(b.display||b.displayKey);this.templates=d(b.templates,this.displayFn);
this.$el=f('<div class="tt-dataset-%CLASS%"></div>'.replace("%CLASS%",this.name))}function n(b){function a(a){return a[b]}b=b||"value";return e.isFunction(b)?b:a}function d(b,a){function d(b){return"<p>"+a(b)+"</p>"}return{empty:b.empty&&e.templatify(b.empty),header:b.header&&e.templatify(b.header),footer:b.footer&&e.templatify(b.footer),suggestion:b.suggestion||d}}c.extractDatasetName=function(b){return f(b).data("ttDataset")};c.extractValue=function(b){return f(b).data("ttValue")};c.extractDatum=
function(b){return f(b).data("ttDatum")};e.mixin(c.prototype,r,{_render:function(b,a){function d(){var c,g;c=f('<span class="tt-suggestions"></span>').css(p.suggestions);g=e.map(a,function(a){a=f('<div class="tt-suggestion"></div>').append(h.templates.suggestion(a)).data("ttDataset",h.name).data("ttValue",h.displayFn(a)).data("ttDatum",a);a.children().each(function(){f(this).css(p.suggestionChild)});return a});c.append.apply(c,g);h.highlight&&w({className:"tt-highlight",node:c[0],pattern:b});return c}
function c(){return h.templates.header({query:b,isEmpty:!m})}function l(){return h.templates.footer({query:b,isEmpty:!m})}if(this.$el){var h=this,m;this.$el.empty();m=a&&a.length;!m&&this.templates.empty?this.$el.html(h.templates.empty({query:b,isEmpty:!0})).prepend(h.templates.header?c():null).append(h.templates.footer?l():null):m&&this.$el.html(d()).prepend(h.templates.header?c():null).append(h.templates.footer?l():null);this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(b){var a=
this;this.query=b;this.canceled=!1;this.source(b,function(d){a.canceled||b!==a.query||a._render(b,d)})},cancel:function(){this.canceled=!0},clear:function(){this.cancel();this.$el.empty();this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}});return c}(),x=function(){function c(d){var b=this,a,c,k;d=d||{};d.menu||f.error("menu is required");this.isOpen=!1;this.isEmpty=!0;this.datasets=e.map(d.datasets,n);a=e.bind(this._onSuggestionClick,this);
c=e.bind(this._onSuggestionMouseEnter,this);k=e.bind(this._onSuggestionMouseLeave,this);this.$menu=f(d.menu).on("click.tt",".tt-suggestion",a).on("mouseenter.tt",".tt-suggestion",c).on("mouseleave.tt",".tt-suggestion",k);e.each(this.datasets,function(a){b.$menu.append(a.getRoot());a.onSync("rendered",b._onRendered,b)})}function n(d){return new q(d)}e.mixin(c.prototype,r,{_onSuggestionClick:function(d){this.trigger("suggestionClicked",f(d.currentTarget))},_onSuggestionMouseEnter:function(d){this._removeCursor();
this._setCursor(f(d.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){(this.isEmpty=e.every(this.datasets,function(d){return d.isEmpty()}))?this._hide():this.isOpen&&this._show();this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(d,
b){d.first().addClass("tt-cursor");!b&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(d){var b,a;this.isOpen&&(a=this._getCursor(),b=this._getSuggestions(),this._removeCursor(),d=b.index(a)+d,d=(d+1)%(b.length+1)-1,-1===d?this.trigger("cursorRemoved"):(-1>d&&(d=b.length-1),this._setCursor(b=b.eq(d)),this._ensureVisible(b)))},_ensureVisible:function(d){var b,a,c;b=d.position().top;d=b+d.outerHeight(!0);a=this.$menu.scrollTop();
c=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);0>b?this.$menu.scrollTop(a+b):c<d&&this.$menu.scrollTop(a+(d-c))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(d){this.$menu.css("ltr"===d?p.ltr:p.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},
getDatumForSuggestion:function(d){var b=null;d.length&&(b={raw:q.extractDatum(d),value:q.extractValue(d),datasetName:q.extractDatasetName(d)});return b},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(d){e.each(this.datasets,function(b){b.update(d)})},empty:function(){e.each(this.datasets,function(d){d.clear()});this.isEmpty=!0},isVisible:function(){return this.isOpen&&
!this.isEmpty},destroy:function(){this.$menu.off(".tt");this.$menu=null;e.each(this.datasets,function(d){d.destroy()})}});return c}(),y=function(){function c(a){var b,d,c;a=a||{};a.input||f.error("missing input");this.isActivated=!1;this.autoselect=!!a.autoselect;this.minLength=e.isNumber(a.minLength)?a.minLength:1;this.$node=n(a.input,a.withHint);b=this.$node.find(".tt-dropdown-menu");d=this.$node.find(".tt-input");c=this.$node.find(".tt-hint");d.on("blur.tt",function(a){var c,f;c=document.activeElement;
f=b.is(c);c=0<b.has(c).length;e.isMsie()&&(f||c)&&(a.preventDefault(),a.stopImmediatePropagation(),e.defer(function(){d.focus()}))});b.on("mousedown.tt",function(a){a.preventDefault()});this.eventBus=a.eventBus||new t({el:d});this.dropdown=(new x({menu:b,datasets:a.datasets})).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,
this).onAsync("datasetRendered",this._onDatasetRendered,this);this.input=(new v({input:d,hint:c})).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,
this).onSync("whitespaceChanged",this._onWhitespaceChanged,this);this._setLanguageDirection()}function n(a,b){var c,e,h,m;c=f(a);e=f('<span class="twitter-typeahead"></span>').css(p.wrapper);h=f('<span class="tt-dropdown-menu"></span>').css(p.dropdown);m=c.clone().css(p.hint).css(d(c));m.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",!0).attr({autocomplete:"off",spellcheck:"false",tabindex:-1});c.data("ttAttrs",{dir:c.attr("dir"),autocomplete:c.attr("autocomplete"),
spellcheck:c.attr("spellcheck"),style:c.attr("style")});c.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(b?p.input:p.inputWithNoHint);try{!c.attr("dir")&&c.attr("dir","auto")}catch(n){}return c.wrap(e).parent().prepend(b?m:null).append(h)}function d(a){return{backgroundAttachment:a.css("background-attachment"),backgroundClip:a.css("background-clip"),backgroundColor:a.css("background-color"),backgroundImage:a.css("background-image"),backgroundOrigin:a.css("background-origin"),backgroundPosition:a.css("background-position"),
backgroundRepeat:a.css("background-repeat"),backgroundSize:a.css("background-size")}}function b(a){var b=a.find(".tt-input");e.each(b.data("ttAttrs"),function(a,c){e.isUndefined(a)?b.removeAttr(c):b.attr(c,a)});b.detach().removeData("ttAttrs").removeClass("tt-input").insertAfter(a);a.remove()}e.mixin(c.prototype,{_onSuggestionClicked:function(a,b){var c;(c=this.dropdown.getDatumForSuggestion(b))&&this._select(c)},_onCursorMoved:function(){var a=this.dropdown.getDatumForCursor();this.input.setInputValue(a.value,
!0);this.eventBus.trigger("cursorchanged",a.raw,a.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue();this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint();this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint();this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0;this.dropdown.open()},_onBlurred:function(){this.isActivated=!1;this.dropdown.empty();this.dropdown.close()},_onEnterKeyed:function(a,
b){var c,d;c=this.dropdown.getDatumForCursor();d=this.dropdown.getDatumForTopSuggestion();c?(this._select(c),b.preventDefault()):this.autoselect&&d&&(this._select(d),b.preventDefault())},_onTabKeyed:function(a,b){var c;(c=this.dropdown.getDatumForCursor())?(this._select(c),b.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close();this.input.resetInputValue()},_onUpKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):
this.dropdown.moveCursorUp();this.dropdown.open()},_onDownKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorDown();this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(a,b){this.input.clearHintIfInvalid();b.length>=this.minLength?this.dropdown.update(b):this.dropdown.empty();this.dropdown.open();
this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint();this.dropdown.open()},_setLanguageDirection:function(){var a;this.dir!==(a=this.input.getLanguageDirection())&&(this.dir=a,this.$node.css("direction",a),this.dropdown.setLanguageDirection(a))},_updateHint:function(){var a,b,c;(a=this.dropdown.getDatumForTopSuggestion())&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(b=this.input.getInputValue(),c=v.normalizeQuery(b),c=e.escapeRegExChars(c),c=new RegExp("^(?:"+
c+")(.+$)","i"),(a=c.exec(a.value))?this.input.setHint(b+a[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(a){var b,c;b=this.input.getHint();c=this.input.getQuery();a=a||this.input.isCursorAtEnd();b&&c!==b&&a&&((b=this.dropdown.getDatumForTopSuggestion())&&this.input.setInputValue(b.value),this.eventBus.trigger("autocompleted",b.raw,b.datasetName))},_select:function(a){this.input.setQuery(a.value);this.input.setInputValue(a.value,!0);this._setLanguageDirection();this.eventBus.trigger("selected",
a.raw,a.datasetName);this.dropdown.close();e.defer(e.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(a){a=e.toStr(a);this.isActivated?this.input.setInputValue(a):(this.input.setQuery(a),this.input.setInputValue(a,!0));this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy();this.dropdown.destroy();b(this.$node);this.$node=null}});return c}();(function(){var c,
n;c=f.fn.typeahead;n={initialize:function(c,b){b=e.isArray(b)?b:[].slice.call(arguments,1);c=c||{};return this.each(function(){var a=f(this),g;e.each(b,function(a){a.highlight=!!c.highlight});g=new y({input:a,eventBus:new t({el:a}),withHint:e.isUndefined(c.hint)?!0:!!c.hint,minLength:c.minLength,autoselect:c.autoselect,datasets:b});a.data("ttTypeahead",g)})},open:function(){return this.each(function(){var c;(c=f(this).data("ttTypeahead"))&&c.open()})},close:function(){return this.each(function(){var c;
(c=f(this).data("ttTypeahead"))&&c.close()})},val:function(c){function b(){var a;(a=f(this).data("ttTypeahead"))&&a.setVal(c)}function a(a){var b;if(a=a.data("ttTypeahead"))b=a.getVal();return b}return arguments.length?this.each(b):a(this.first())},destroy:function(){return this.each(function(){var c=f(this),b;if(b=c.data("ttTypeahead"))b.destroy(),c.removeData("ttTypeahead")})}};f.fn.typeahead=function(c){var b;return n[c]&&"initialize"!==c?(b=this.filter(function(){return!!f(this).data("ttTypeahead")}),
n[c].apply(b,[].slice.call(arguments,1))):n.initialize.apply(this,arguments)};f.fn.typeahead.noConflict=function(){f.fn.typeahead=c;return this}})()})(window.jQuery);
