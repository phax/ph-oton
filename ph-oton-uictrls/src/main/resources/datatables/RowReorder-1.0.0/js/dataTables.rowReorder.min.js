/*
   Copyright 2015 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license/mit

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
*/
(function(n,k,m){m=function(e,h){var g=function(b,a){if(!h.versionCheck||!h.versionCheck("1.10.8"))throw"DataTables RowReorder requires DataTables 1.10.8 or newer";this.c=e.extend(!0,{},h.defaults.rowReorder,g.defaults,a);this.s={bodyTop:null,dt:new h.Api(b),getDataFn:h.ext.oApi._fnGetObjectDataFn(this.c.dataSrc),middles:null,setDataFn:h.ext.oApi._fnSetObjectDataFn(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[]},windowHeight:0};this.dom={clone:null};var c=this.s.dt.settings()[0],
d=c.rowreorder;if(d)return d;c.rowreorder=this;this._constructor()};g.prototype={_constructor:function(){var b=this,a=this.s.dt,c=e(a.table().node());"static"===c.css("position")&&c.css("position","relative");e(c).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,function(d){var c=e(this).closest("tr");if(a.row(c).any())return b._mouseDown(d,c),!1});a.on("destroy",function(){c.off("mousedown.rowReorder")})},_cachePositions:function(){var b=this.s.dt,a=e(b.table().node()).find("thead").outerHeight(),
c=e.unique(b.rows({page:"current"}).nodes().toArray()),d=e.map(c,function(b,d){return e(b).position().top-a}),c=e.map(d,function(a,c){return d.length<c-1?(a+d[c+1])/2:(a+a+e(b.row(":last-child").node()).outerHeight())/2});this.s.middles=c;this.s.bodyTop=e(b.table().body()).offset().top;this.s.windowHeight=e(n).height()},_clone:function(b){var a=e(this.s.dt.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(b.clone(!1)),c=b.outerWidth(),d=b.outerHeight(),f=b.children().map(function(){return e(this).width()});
a.width(c).height(d).find("tr").children().each(function(a){this.style.width=f[a]+"px"});a.appendTo("body");this.dom.clone=a},_clonePosition:function(b){var a=this.s.start,c=this._eventToPage(b,"Y")-a.top;b=this._eventToPage(b,"X")-a.left;var d=this.c.snapX;this.dom.clone.css({top:c+a.offsetTop,left:!0===d?a.offsetLeft:"number"===typeof d?a.offsetLeft+d:b+a.offsetLeft})},_emitEvent:function(b,a){this.s.dt.iterator("table",function(c,d){e(c.nTable).triggerHandler(b+".dt",a)})},_eventToPage:function(b,
a){return-1!==b.type.indexOf("touch")?b.originalEvent.touches[0]["page"+a]:b["page"+a]},_mouseDown:function(b,a){var c=this,d=this.s.dt,f=this.s.start,g=a.offset();f.top=this._eventToPage(b,"Y");f.left=this._eventToPage(b,"X");f.offsetTop=g.top;f.offsetLeft=g.left;f.nodes=e.unique(d.rows({page:"current"}).nodes().toArray());this._cachePositions();this._clone(a);this._clonePosition(b);this.dom.target=a;a.addClass("dt-rowReorder-moving");e(k).on("mouseup.rowReorder touchend.rowReorder",function(a){c._mouseUp(a)}).on("mousemove.rowReorder touchmove.rowReorder",
function(a){c._mouseMove(a)});e(n).width()===e(k).width()&&e(k.body).addClass("dt-rowReorder-noOverflow")},_mouseMove:function(b){this._clonePosition(b);for(var a=this._eventToPage(b,"Y")-this.s.bodyTop,c=this.s.middles,d=null,f=this.s.dt,g=f.table().body(),l=0,h=c.length;l<h;l++)if(a<c[l]){d=l;break}null===d&&(d=c.length);if(null===this.s.lastInsert||this.s.lastInsert!==d)0===d?this.dom.target.prependTo(g):(a=e.unique(f.rows({page:"current"}).nodes().toArray()),d>this.s.lastInsert?this.dom.target.before(a[d-
1]):this.dom.target.after(a[d])),this._cachePositions(),this.s.lastInsert=d;b=this._eventToPage(b,"Y")-k.body.scrollTop;d=this.s.scrollInterval;65>b?d||(this.s.scrollInterval=setInterval(function(){k.body.scrollTop-=5},15)):65>this.s.windowHeight-b?d||(this.s.scrollInterval=setInterval(function(){k.body.scrollTop+=5},15)):(clearInterval(d),this.s.scrollInterval=null)},_mouseUp:function(b){b=this.s.dt;var a,c;this.dom.clone.remove();this.dom.clone=null;this.dom.target.removeClass("dt-rowReorder-moving");
e(k).off(".rowReorder");e(k.body).removeClass("dt-rowReorder-noOverflow");var d=this.s.start.nodes,f=e.unique(b.rows({page:"current"}).nodes().toArray()),g={},l=[],h=[],m=this.s.getDataFn,n=this.s.setDataFn;a=0;for(c=d.length;a<c;a++)if(d[a]!==f[a]){var p=b.row(f[a]).id(),r=b.row(f[a]).data(),q=b.row(d[a]).data();p&&(g[p]=m(q));l.push({node:f[a],oldData:m(r),newData:m(q),newPosition:a,oldPosition:e.inArray(f[a],d)});h.push(f[a])}this._emitEvent("row-reorder",[l,{dataSrc:this.c.dataSrc,nodes:h,values:g}]);
this.c.editor&&this.c.editor.edit(h,!1,{submit:"changed"}).multiSet(this.c.dataSrc,g).submit();if(this.c.update){a=0;for(c=l.length;a<c;a++)d=b.row(l[a].node),f=d.data(),n(f,l[a].newData),d.invalidate("data");b.draw(!1)}}};g.defaults={dataSrc:0,editor:null,selector:"td:first-child",snapX:!1,update:!0};g.version="1.0.0";e.fn.dataTable.RowReorder=g;e.fn.DataTable.RowReorder=g;e(k).on("init.dt.dtr",function(b,a,c){"dt"===b.namespace&&(b=a.oInit.rowReorder,c=h.defaults.rowReorder,b||c)&&(c=e.extend({},
b,c),!1!==b&&new g(a,c))});return g};"function"===typeof define&&define.amd?define(["jquery","datatables"],m):"object"===typeof exports?m(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.RowReorder&&m(jQuery,jQuery.fn.dataTable)})(window,document);
