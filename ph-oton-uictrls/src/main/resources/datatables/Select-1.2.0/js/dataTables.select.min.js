/*
   Copyright 2015-2016 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license/mit

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net/extensions/select
*/
(function(e){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(k){return e(k,window,document)}):"object"===typeof exports?module.exports=function(k,m){k||(k=window);m&&m.fn.dataTable||(m=require("datatables.net")(k,m).$);return e(m,k,k.document)}:e(jQuery,window,document)})(function(e,k,m,h){function v(b,a,c){var d;d=function(a,c){if(a>c){var d=c;c=a;a=d}var f=!1;return b.columns(":visible").indexes().filter(function(b){b===a&&(f=!0);return b===c?(f=!1,!0):f})};var f=
function(a,c){var d=b.rows({search:"applied"}).indexes();if(d.indexOf(a)>d.indexOf(c)){var f=c;c=a;a=f}var e=!1;return d.filter(function(b){b===a&&(e=!0);return b===c?(e=!1,!0):e})};b.cells({selected:!0}).any()||c?(d=d(c.column,a.column),c=f(c.row,a.row)):(d=d(0,a.column),c=f(0,a.row));c=b.cells(c,d).flatten();b.cells(a,{selected:!0}).any()?b.cells(c).deselect():b.cells(c).select()}function t(b){var a=b.settings()[0]._select.selector;e(b.table().body()).off("mousedown.dtSelect",a).off("mouseup.dtSelect",
a).off("click.dtSelect",a);e("body").off("click.dtSelect")}function z(b){var a=e(b.table().body()),c=b.settings()[0],d=c._select.selector;a.on("mousedown.dtSelect",d,function(c){if(c.shiftKey||c.metaKey||c.ctrlKey)a.css("-moz-user-select","none").one("selectstart.dtSelect",d,function(){return!1})}).on("mouseup.dtSelect",d,function(){a.css("-moz-user-select","")}).on("click.dtSelect",d,function(c){var a=b.select.items();if(!k.getSelection||!k.getSelection().toString()){var d=b.settings()[0];if(e(c.target).closest("div.dataTables_wrapper")[0]==
b.table().container()){var g=b.cell(e(c.target).closest("td, th"));if(g.any()){var h=e.Event("user-select.dt");l(b,h,[a,g,c]);h.isDefaultPrevented()||(h=g.index(),"row"===a?(a=h.row,u(c,b,d,"row",a)):"column"===a?(a=g.index().column,u(c,b,d,"column",a)):"cell"===a&&(a=g.index(),u(c,b,d,"cell",a)),d._select_lastCell=h)}}}});e("body").on("click.dtSelect",function(a){c._select.blurable&&!e(a.target).parents().filter(b.table().container()).length&&(e(a.target).parents("div.DTE").length||q(c,!0))})}function l(b,
a,c,d){if(!d||b.flatten().length)"string"===typeof a&&(a+=".dt"),c.unshift(b),e(b.table().node()).triggerHandler(a,c)}function A(b){var a=b.settings()[0];if(a._select.info&&a.aanFeatures.i){var c=e('<span class="select-info"/>'),d=function(a,d){c.append(e('<span class="select-item"/>').append(b.i18n("select."+a+"s",{_:"%d "+a+"s selected",0:"",1:"1 "+a+" selected"},d)))};d("row",b.rows({selected:!0}).flatten().length);d("column",b.columns({selected:!0}).flatten().length);d("cell",b.cells({selected:!0}).flatten().length);
e.each(a.aanFeatures.i,function(a,b){b=e(b);var d=b.children("span.select-info");d.length&&d.remove();""!==c.text()&&b.append(c)})}}function C(b){var a=new g.Api(b);b.aoRowCreatedCallback.push({fn:function(a,d,f){d=b.aoData[f];d._select_selected&&e(a).addClass(b._select.className);a=0;for(f=b.aoColumns.length;a<f;a++)(b.aoColumns[a]._select_selected||d._selected_cells&&d._selected_cells[a])&&e(d.anCells[a]).addClass(b._select.className)},sName:"select-deferRender"});a.on("preXhr.dt.dtSelect",function(){var c=
a.rows({selected:!0}).ids(!0).filter(function(a){return a!==h}),b=a.cells({selected:!0}).eq(0).map(function(c){var b=a.row(c.row).id(!0);return b?{row:b,column:c.column}:h}).filter(function(a){return a!==h});a.one("draw.dt.dtSelect",function(){a.rows(c).select();b.any()&&b.each(function(c){a.cells(c.row,c.column).select()})})});a.on("draw.dtSelect.dt select.dtSelect.dt deselect.dtSelect.dt info.dt",function(){A(a)});a.on("destroy.dtSelect",function(){t(a);a.off(".dtSelect")})}function B(b,a,c,d){var f=
b[a+"s"]({search:"applied"}).indexes();d=e.inArray(d,f);var g=e.inArray(c,f);if(b[a+"s"]({selected:!0}).any()||-1!==d){if(d>g){var h=g,g=d;d=h}f.splice(g+1,f.length);f.splice(0,d)}else f.splice(e.inArray(c,f)+1,f.length);b[a](c,{selected:!0}).any()?(f.splice(e.inArray(c,f),1),b[a+"s"](f).deselect()):b[a+"s"](f).select()}function q(b,a){if(a||"single"===b._select.style){var c=new g.Api(b);c.rows({selected:!0}).deselect();c.columns({selected:!0}).deselect();c.cells({selected:!0}).deselect()}}function u(b,
a,c,d,f){var e=a.select.style(),g=a[d](f,{selected:!0}).any();"os"===e?b.ctrlKey||b.metaKey?a[d](f).select(!g):b.shiftKey?"cell"===d?v(a,f,c._select_lastCell||null):B(a,d,f,c._select_lastCell?c._select_lastCell[d]:null):(b=a[d+"s"]({selected:!0}),g&&1===b.flatten().length?a[d](f).deselect():(b.deselect(),a[d](f).select())):"multi+shift"==e?b.shiftKey?"cell"===d?v(a,f,c._select_lastCell||null):B(a,d,f,c._select_lastCell?c._select_lastCell[d]:null):a[d](f).select(!g):a[d](f).select(!g)}function r(b,
a){return function(c){return c.i18n("buttons."+b,a)}}var g=e.fn.dataTable;g.select={};g.select.version="1.2.0";g.select.init=function(b){var a=b.settings()[0],c=a.oInit.select,d=g.defaults.select,c=c===h?d:c,d="row",f="api",w=!1,x=!0,y="td, th",k="selected";a._select={};!0===c?f="os":"string"===typeof c?f=c:e.isPlainObject(c)&&(c.blurable!==h&&(w=c.blurable),c.info!==h&&(x=c.info),c.items!==h&&(d=c.items),c.style!==h&&(f=c.style),c.selector!==h&&(y=c.selector),c.className!==h&&(k=c.className));b.select.selector(y);
b.select.items(d);b.select.style(f);b.select.blurable(w);b.select.info(x);a._select.className=k;e.fn.dataTable.ext.order["select-checkbox"]=function(a,c){return this.api().column(c,{order:"index"}).nodes().map(function(c){return"row"===a._select.items?e(c).parent().hasClass(a._select.className):"cell"===a._select.items?e(c).hasClass(a._select.className):!1})};e(b.table().node()).hasClass("selectable")&&b.select.style("os")};e.each([{type:"row",prop:"aoData"},{type:"column",prop:"aoColumns"}],function(b,
a){g.ext.selector[a.type].push(function(c,b,f){b=b.selected;var e,g=[];if(b===h)return f;for(var k=0,l=f.length;k<l;k++)e=c[a.prop][f[k]],(!0===b&&!0===e._select_selected||!1===b&&!e._select_selected)&&g.push(f[k]);return g})});g.ext.selector.cell.push(function(b,a,c){a=a.selected;var d,f=[];if(a===h)return c;for(var e=0,g=c.length;e<g;e++)d=b.aoData[c[e].row],(!0===a&&d._selected_cells&&!0===d._selected_cells[c[e].column]||!(!1!==a||d._selected_cells&&d._selected_cells[c[e].column]))&&f.push(c[e]);
return f});var n=g.Api.register,p=g.Api.registerPlural;n("select()",function(){return this.iterator("table",function(b){g.select.init(new g.Api(b))})});n("select.blurable()",function(b){return b===h?this.context[0]._select.blurable:this.iterator("table",function(a){a._select.blurable=b})});n("select.info()",function(b){return A===h?this.context[0]._select.info:this.iterator("table",function(a){a._select.info=b})});n("select.items()",function(b){return b===h?this.context[0]._select.items:this.iterator("table",
function(a){a._select.items=b;l(new g.Api(a),"selectItems",[b])})});n("select.style()",function(b){return b===h?this.context[0]._select.style:this.iterator("table",function(a){a._select.style=b;a._select_init||C(a);var c=new g.Api(a);t(c);"api"!==b&&z(c);l(new g.Api(a),"selectStyle",[b])})});n("select.selector()",function(b){return b===h?this.context[0]._select.selector:this.iterator("table",function(a){t(new g.Api(a));a._select.selector=b;"api"!==a._select.style&&z(new g.Api(a))})});p("rows().select()",
"row().select()",function(b){var a=this;if(!1===b)return this.deselect();this.iterator("row",function(a,b){q(a);a.aoData[b]._select_selected=!0;e(a.aoData[b].nTr).addClass(a._select.className)});this.iterator("table",function(c,b){l(a,"select",["row",a[b]],!0)});return this});p("columns().select()","column().select()",function(b){var a=this;if(!1===b)return this.deselect();this.iterator("column",function(a,b){q(a);a.aoColumns[b]._select_selected=!0;var f=(new g.Api(a)).column(b);e(f.header()).addClass(a._select.className);
e(f.footer()).addClass(a._select.className);f.nodes().to$().addClass(a._select.className)});this.iterator("table",function(b,d){l(a,"select",["column",a[d]],!0)});return this});p("cells().select()","cell().select()",function(b){var a=this;if(!1===b)return this.deselect();this.iterator("cell",function(a,b,f){q(a);b=a.aoData[b];b._selected_cells===h&&(b._selected_cells=[]);b._selected_cells[f]=!0;b.anCells&&e(b.anCells[f]).addClass(a._select.className)});this.iterator("table",function(b,d){l(a,"select",
["cell",a[d]],!0)});return this});p("rows().deselect()","row().deselect()",function(){var b=this;this.iterator("row",function(a,b){a.aoData[b]._select_selected=!1;e(a.aoData[b].nTr).removeClass(a._select.className)});this.iterator("table",function(a,c){l(b,"deselect",["row",b[c]],!0)});return this});p("columns().deselect()","column().deselect()",function(){var b=this;this.iterator("column",function(a,b){a.aoColumns[b]._select_selected=!1;var d=new g.Api(a),f=d.column(b);e(f.header()).removeClass(a._select.className);
e(f.footer()).removeClass(a._select.className);d.cells(null,b).indexes().each(function(b){var c=a.aoData[b.row],d=c._selected_cells;!c.anCells||d&&d[b.column]||e(c.anCells[b.column]).removeClass(a._select.className)})});this.iterator("table",function(a,c){l(b,"deselect",["column",b[c]],!0)});return this});p("cells().deselect()","cell().deselect()",function(){var b=this;this.iterator("cell",function(a,b,d){b=a.aoData[b];b._selected_cells[d]=!1;b.anCells&&!a.aoColumns[d]._select_selected&&e(b.anCells[d]).removeClass(a._select.className)});
this.iterator("table",function(a,c){l(b,"deselect",["cell",b[c]],!0)});return this});e.extend(g.ext.buttons,{selected:{text:r("selected","Selected"),className:"buttons-selected",init:function(b){var a=this;b.on("draw.dt.DT select.dt.DT deselect.dt.DT",function(){var b=a.rows({selected:!0}).any()||a.columns({selected:!0}).any()||a.cells({selected:!0}).any();a.enable(b)});this.disable()}},selectedSingle:{text:r("selectedSingle","Selected single"),className:"buttons-selected-single",init:function(b){var a=
this;b.on("draw.dt.DT select.dt.DT deselect.dt.DT",function(){var c=b.rows({selected:!0}).flatten().length+b.columns({selected:!0}).flatten().length+b.cells({selected:!0}).flatten().length;a.enable(1===c)});this.disable()}},selectAll:{text:r("selectAll","Select all"),className:"buttons-select-all",action:function(){this[this.select.items()+"s"]().select()}},selectNone:{text:r("selectNone","Deselect all"),className:"buttons-select-none",action:function(){q(this.settings()[0],!0)},init:function(b){var a=
this;b.on("draw.dt.DT select.dt.DT deselect.dt.DT",function(){var c=b.rows({selected:!0}).flatten().length+b.columns({selected:!0}).flatten().length+b.cells({selected:!0}).flatten().length;a.enable(0<c)});this.disable()}}});e.each(["Row","Column","Cell"],function(b,a){var c=a.toLowerCase();g.ext.buttons["select"+a+"s"]={text:r("select"+a+"s","Select "+c+"s"),className:"buttons-select-"+c+"s",action:function(){this.select.items(c)},init:function(a){var b=this;a.on("selectItems.dt.DT",function(a,d,
e){b.active(e===c)})}}});e(m).on("preInit.dt.dtSelect",function(b,a){"dt"===b.namespace&&g.select.init(new g.Api(a))});return g.select});
