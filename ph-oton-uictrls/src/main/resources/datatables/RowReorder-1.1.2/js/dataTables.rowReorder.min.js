/*
   Copyright 2015-2016 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license/mit

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
*/
(function(d){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(f){return d(f,window,document)}):"object"===typeof exports?module.exports=function(f,h){f||(f=window);h&&h.fn.dataTable||(h=require("datatables.net")(f,h).$);return d(h,f,f.document)}:d(jQuery,window,document)})(function(d,f,h,u){var l=d.fn.dataTable,k=function(c,b){if(!l.versionCheck||!l.versionCheck("1.10.8"))throw"DataTables RowReorder requires DataTables 1.10.8 or newer";this.c=d.extend(!0,{},l.defaults.rowReorder,
k.defaults,b);this.s={bodyTop:null,dt:new l.Api(c),getDataFn:l.ext.oApi._fnGetObjectDataFn(this.c.dataSrc),middles:null,scroll:{},scrollInterval:null,setDataFn:l.ext.oApi._fnSetObjectDataFn(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[]},windowHeight:0};this.dom={clone:null,dtScroll:d("div.dataTables_scrollBody",this.s.dt.table().container())};var a=this.s.dt.settings()[0],e=a.rowreorder;if(e)return e;a.rowreorder=this;this._constructor()};d.extend(k.prototype,{_constructor:function(){var c=
this,b=this.s.dt,a=d(b.table().node());"static"===a.css("position")&&a.css("position","relative");d(b.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,function(a){var g=d(this).closest("tr");if(b.row(g).any())return c._mouseDown(a,g),!1});b.on("destroy.rowReorder",function(){d(b.table().container()).off(".rowReorder");b.off(".rowReorder")})},_cachePositions:function(){var c=this.s.dt,b=d(c.table().node()).find("thead").outerHeight(),a=d.unique(c.rows({page:"current"}).nodes().toArray()),
e=d.map(a,function(a,c){return d(a).position().top-b}),a=d.map(e,function(a,b){return e.length<b-1?(a+e[b+1])/2:(a+a+d(c.row(":last-child").node()).outerHeight())/2});this.s.middles=a;this.s.bodyTop=d(c.table().body()).offset().top;this.s.windowHeight=d(f).height()},_clone:function(c){var b=d(this.s.dt.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(c.clone(!1)),a=c.outerWidth(),e=c.outerHeight(),g=c.children().map(function(){return d(this).width()});b.width(a).height(e).find("tr").children().each(function(a){this.style.width=
g[a]+"px"});b.appendTo("body");this.dom.clone=b},_clonePosition:function(c){var b=this.s.start,a=this._eventToPage(c,"Y")-b.top;c=this._eventToPage(c,"X")-b.left;var e=this.c.snapX;this.dom.clone.css({top:a+b.offsetTop,left:!0===e?b.offsetLeft:"number"===typeof e?b.offsetLeft+e:c+b.offsetLeft})},_emitEvent:function(c,b){this.s.dt.iterator("table",function(a,e){d(a.nTable).triggerHandler(c+".dt",b)})},_eventToPage:function(c,b){return-1!==c.type.indexOf("touch")?c.originalEvent.touches[0]["page"+b]:
c["page"+b]},_mouseDown:function(c,b){var a=this,e=this.s.dt,g=this.s.start,m=b.offset();g.top=this._eventToPage(c,"Y");g.left=this._eventToPage(c,"X");g.offsetTop=m.top;g.offsetLeft=m.left;g.nodes=d.unique(e.rows({page:"current"}).nodes().toArray());this._cachePositions();this._clone(b);this._clonePosition(c);this.dom.target=b;b.addClass("dt-rowReorder-moving");d(h).on("mouseup.rowReorder touchend.rowReorder",function(b){a._mouseUp(b)}).on("mousemove.rowReorder touchmove.rowReorder",function(b){a._mouseMove(b)});
d(f).width()===d(h).width()&&d(h.body).addClass("dt-rowReorder-noOverflow");e=this.dom.dtScroll;this.s.scroll={windowHeight:d(f).height(),windowWidth:d(f).width(),dtTop:e.length?e.offset().top:null,dtLeft:e.length?e.offset().left:null,dtHeight:e.length?e.outerHeight():null,dtWidth:e.length?e.outerWidth():null}},_mouseMove:function(c){this._clonePosition(c);for(var b=this._eventToPage(c,"Y")-this.s.bodyTop,a=this.s.middles,e=null,g=this.s.dt,m=g.table().body(),h=0,f=a.length;h<f;h++)if(b<a[h]){e=h;
break}null===e&&(e=a.length);if(null===this.s.lastInsert||this.s.lastInsert!==e)0===e?this.dom.target.prependTo(m):(b=d.unique(g.rows({page:"current"}).nodes().toArray()),e>this.s.lastInsert?this.dom.target.insertAfter(b[e-1]):this.dom.target.insertBefore(b[e])),this._cachePositions(),this.s.lastInsert=e;this._shiftScroll(c)},_mouseUp:function(c){var b=this.s.dt,a,e=this.c.dataSrc;this.dom.clone.remove();this.dom.clone=null;this.dom.target.removeClass("dt-rowReorder-moving");d(h).off(".rowReorder");
d(h.body).removeClass("dt-rowReorder-noOverflow");clearInterval(this.s.scrollInterval);this.s.scrollInterval=null;var g=this.s.start.nodes,m=d.unique(b.rows({page:"current"}).nodes().toArray()),f={},n=[],k=[],l=this.s.getDataFn,r=this.s.setDataFn;a=0;for(c=g.length;a<c;a++)if(g[a]!==m[a]){var p=b.row(m[a]).id(),t=b.row(m[a]).data(),q=b.row(g[a]).data();p&&(f[p]=l(q));n.push({node:m[a],oldData:l(t),newData:l(q),newPosition:a,oldPosition:d.inArray(m[a],g)});k.push(m[a])}g=[n,{dataSrc:e,nodes:k,values:f,
triggerRow:b.row(this.dom.target)}];this._emitEvent("row-reorder",g);this.c.editor&&this.c.editor.edit(k,!1,{submit:"changed"}).multiSet(e,f).submit();if(this.c.update){a=0;for(c=n.length;a<c;a++)f=b.row(n[a].node).data(),r(f,n[a].newData),b.columns().every(function(){this.dataSrc()===e&&b.cell(n[a].node,this.index()).invalidate("data")});this._emitEvent("row-reordered",g);b.draw(!1)}},_shiftScroll:function(c){var b=this,a=this.s.scroll,e=!1,d=c.pageY-h.body.scrollTop,f,k;65>d?f=-5:d>a.windowHeight-
65&&(f=5);null!==a.dtTop&&c.pageY<a.dtTop+65?k=-5:null!==a.dtTop&&c.pageY>a.dtTop+a.dtHeight-65&&(k=5);f||k?(a.windowVert=f,a.dtVert=k,e=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null);!this.s.scrollInterval&&e&&(this.s.scrollInterval=setInterval(function(){a.windowVert&&(h.body.scrollTop+=a.windowVert);if(a.dtVert){var c=b.dom.dtScroll[0];a.dtVert&&(c.scrollTop+=a.dtVert)}},20))}});k.defaults={dataSrc:0,editor:null,selector:"td:first-child",snapX:!1,update:!0};
k.version="1.1.2";d.fn.dataTable.RowReorder=k;d.fn.DataTable.RowReorder=k;d(h).on("init.dt.dtr",function(c,b,a){"dt"===c.namespace&&(c=b.oInit.rowReorder,a=l.defaults.rowReorder,c||a)&&(a=d.extend({},c,a),!1!==c&&new k(b,a))});return k});
