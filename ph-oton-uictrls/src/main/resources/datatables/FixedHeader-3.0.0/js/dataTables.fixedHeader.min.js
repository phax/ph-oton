/*
   Copyright 2009-2015 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license/mit

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
*/
(function(h,k,f){f=function(e,f){var m=0,g=function(b,a){if(!(this instanceof g))throw"FixedHeader must be initialised with the 'new' keyword.";!0===a&&(a={});b=new f.Api(b);this.c=e.extend(!0,{},g.defaults,a);this.s={dt:b,position:{theadTop:0,tbodyTop:0,tfootTop:0,tfootBottom:0,width:0,left:0,tfootHeight:0,theadHeight:0,windowHeight:e(h).height(),visible:!0},headerMode:null,footerMode:null,namespace:".dtfc"+m++};this.dom={floatingHeader:null,thead:e(b.table().header()),tbody:e(b.table().body()),
tfoot:e(b.table().footer()),header:{host:null,floating:null,placeholder:null},footer:{host:null,floating:null,placeholder:null}};this.dom.header.host=this.dom.thead.parent();this.dom.footer.host=this.dom.tfoot.parent();var d=b.settings()[0];if(d._fixedHeader)throw"FixedHeader already initialised on table "+d.nTable.id;d._fixedHeader=this;this._constructor()};g.prototype={update:function(){this._positions();this._scroll(!0)},_constructor:function(){var b=this,a=this.s.dt;e(h).on("scroll"+this.s.namespace,
function(){b._scroll()}).on("resize"+this.s.namespace,function(){b.s.position.windowHeight=e(h).height();b._positions();b._scroll(!0)});a.on("column-reorder.dt.dtfc column-visibility.dt.dtfc",function(){b._positions();b._scroll(!0)}).on("draw.dtfc",function(){b._positions();b._scroll()});a.on("destroy.dtfc",function(){a.off(".dtfc");e(h).off(this.s.namespace)});this._positions();this._scroll()},_clone:function(b,a){var d=this.s.dt,c=this.dom[b],l="header"===b?this.dom.thead:this.dom.tfoot;!a&&c.floating?
c.floating.removeClass("fixedHeader-floating fixedHeader-locked"):(c.floating&&(c.placeholder.remove(),c.floating.children().detach(),c.floating.remove()),c.floating=e(d.table().node().cloneNode(!1)).removeAttr("id").append(l).appendTo("body"),c.placeholder=l.clone(!1),c.host.append(c.placeholder),"footer"===b&&this._footerMatch(c.placeholder,c.floating))},_footerMatch:function(b,a){var d=function(c){var d=e(c,b).map(function(){return e(this).width()}).toArray();e(c,a).each(function(a){e(this).width(d[a])})};
d("th");d("td")},_footerUnsize:function(){var b=this.dom.footer.floating;b&&e("th, td",b).css("width","")},_modeChange:function(b,a,d){var c=this.dom[a],e=this.s.position;"in-place"===b?(c.placeholder&&(c.placeholder.remove(),c.placeholder=null),c.host.append("header"===a?this.dom.thead:this.dom.tfoot),c.floating&&(c.floating.remove(),c.floating=null),"footer"===a&&this._footerUnsize()):"in"===b?(this._clone(a,d),c.floating.addClass("fixedHeader-floating").css("header"===a?"top":"bottom",this.c[a+
"Offset"]).css("left",e.left+"px").css("width",e.width+"px"),"footer"===a&&c.floating.css("top","")):"below"===b?(this._clone(a,d),c.floating.addClass("fixedHeader-locked").css("top",e.tfootTop-e.theadHeight).css("left",e.left+"px").css("width",e.width+"px")):"above"===b&&(this._clone(a,d),c.floating.addClass("fixedHeader-locked").css("top",e.tbodyTop).css("left",e.left+"px").css("width",e.width+"px"));this.s[a+"Mode"]=b},_positions:function(){var b=this.s.dt.table(),a=this.s.position,d=this.dom,
b=e(b.node()),c=b.children("thead"),f=b.children("tfoot"),d=d.tbody;a.visible=b.is(":visible");a.width=b.outerWidth();a.left=b.offset().left;a.theadTop=c.offset().top;a.tbodyTop=d.offset().top;a.theadHeight=a.tbodyTop-a.theadTop;f.length?(a.tfootTop=f.offset().top,a.tfootBottom=a.tfootTop+f.outerHeight(),a.tfootHeight=a.tfootBottom-a.tfootTop):(a.tfootTop=a.tbodyTop+d.outerHeight(),a.tfootBottom=a.tfootTop,a.tfootHeight=a.tfootTop)},_scroll:function(b){var a=e(k).scrollTop(),d=this.s.position,c;this.c.header&&
(c=!d.visible||a<=d.theadTop-this.c.headerOffset?"in-place":a<=d.tfootTop-d.theadHeight-this.c.headerOffset?"in":"below",(b||c!==this.s.headerMode)&&this._modeChange(c,"header",b));this.c.footer&&this.dom.tfoot.length&&(a=!d.visible||a+d.windowHeight>=d.tfootBottom+this.c.footerOffset?"in-place":d.windowHeight+a>d.tbodyTop+d.tfootHeight+this.c.footerOffset?"in":"above",(b||a!==this.s.footerMode)&&this._modeChange(a,"footer",b))}};g.version="3.0.0";g.defaults={header:!0,footer:!1,headerOffset:0,footerOffset:0};
e.fn.dataTable.FixedHeader=g;e.fn.DataTable.FixedHeader=g;e(k).on("init.dt.dtb",function(b,a,d){"dt"===b.namespace&&(b=a.oInit.fixedHeader||f.defaults.fixedHeader)&&!a._buttons&&new g(a,b)});f.Api.register("fixedHeader()",function(){});f.Api.register("fixedHeader.adjust()",function(){return this.iterator("table",function(b){(b=b._fixedHeader)&&b.update()})});return g};"function"===typeof define&&define.amd?define(["jquery","datatables"],f):"object"===typeof exports?f(require("jquery"),require("datatables")):
jQuery&&!jQuery.fn.dataTable.FixedHeader&&f(jQuery,jQuery.fn.dataTable)})(window,document);
