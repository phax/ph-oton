/*
   Copyright 2015 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license/mit

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net/extensions/select
*/
(function(m,x,k){m=function(e,g){function m(a,b,d){var c;c=function(d,b){if(d>b){var c=b;b=d;d=c}var f=!1;return a.columns(":visible").indexes().filter(function(a){a===d&&(f=!0);return a===b?(f=!1,!0):f})};var f=function(d,b){var c=a.rows({search:"applied"}).indexes();if(c.indexOf(d)>c.indexOf(b)){var f=b;b=d;d=f}var e=!1;return c.filter(function(a){a===d&&(e=!0);return a===b?(e=!1,!0):e})};a.cells({selected:!0}).any()||d?(c=c(d.column,b.column),d=f(d.row,b.row)):(c=c(0,b.column),d=f(0,b.row));d=
a.cells(d,c).flatten();a.cells(b,{selected:!0}).any()?a.cells(d).deselect():a.cells(d).select()}function t(a){var b=a.settings()[0]._select.selector;e(a.table().body()).off("mousedown.dtSelect",b).off("mouseup.dtSelect",b).off("click.dtSelect",b);e("body").off("click.dtSelect")}function v(a){var b=e(a.table().body()),d=a.settings()[0],c=d._select.selector;b.on("mousedown.dtSelect",c,function(a){if(a.shiftKey)b.css("-moz-user-select","none").one("selectstart.dtSelect",c,function(){return!1})}).on("mouseup.dtSelect",
c,function(a){b.css("-moz-user-select","")}).on("click.dtSelect",c,function(d){var c=a.select.items(),h=a.cell(this).index(),g=a.settings()[0];e(d.target).closest("tbody")[0]==b[0]&&a.cell(d.target).any()&&("row"===c?(c=h.row,u(d,a,g,"row",c)):"column"===c?(c=a.cell(d.target).index().column,u(d,a,g,"column",c)):"cell"===c&&(c=a.cell(d.target).index(),u(d,a,g,"cell",c)),g._select_lastCell=h)});e("body").on("click.dtSelect",function(b){d._select.blurable&&!e(b.target).parents().filter(a.table().container()).length&&
(e(b.target).parents("div.DTE").length||q(d,!0))})}function l(a,b,d,c){if(!c||a.flatten().length)d.unshift(a),e(a.table().node()).triggerHandler(b+".dt",d)}function w(a){var b=a.settings()[0];if(b._select.info){var d=e('<span class="select-info"/>'),c=function(b,c){d.append(e('<span class="select-item"/>').append(a.i18n("select."+b+"s",{_:"%d "+b+"s selected",0:"",1:"1 "+b+" selected"},c)))};c("row",a.rows({selected:!0}).flatten().length);c("column",a.columns({selected:!0}).flatten().length);c("cell",
a.cells({selected:!0}).flatten().length);e.each(b.aanFeatures.i,function(a,b){b=e(b);var c=b.children("span.select-info");c.length&&c.remove();""!==d.text()&&b.append(d)})}}function y(a){var b=new g.Api(a);a.aoRowCreatedCallback.push({fn:function(b,c,f){c=a.aoData[f];c._select_selected&&e(b).addClass("selected");b=0;for(f=a.aoColumns.length;b<f;b++)(a.aoColumns[b]._select_selected||c._selected_cells&&c._selected_cells[b])&&e(c.anCells[b]).addClass("selected")},sName:"select-deferRender"});b.on("preXhr.dt.dtSelect",
function(){var a=b.rows({selected:!0}).ids(!0).filter(function(b){return b!==k}),c=b.cells({selected:!0}).eq(0).map(function(a){var d=b.row(a.row).id(!0);return d?{row:d,column:a.column}:k}).filter(function(b){return b!==k});b.one("draw.dt.dtSelect",function(){b.rows(a).select();c.any()&&c.each(function(a){b.cells(a.row,a.column).select()})})});b.on("draw.dtSelect.dt select.dtSelect.dt deselect.dtSelect.dt",function(){w(b)});b.on("destroy.dtSelect",function(){t(b);b.off(".dtSelect")})}function q(a,
b){if(b||"single"===a._select.style){var d=new g.Api(a);d.rows({selected:!0}).deselect();d.columns({selected:!0}).deselect();d.cells({selected:!0}).deselect()}}function u(a,b,d,c,f){var g=b.select.style(),h=b[c](f,{selected:!0}).any();"os"===g?a.ctrlKey||a.metaKey?b[c](f).select(!h):a.shiftKey?"cell"===c?m(b,f,d._select_lastCell||null):(a=d._select_lastCell?d._select_lastCell[c]:null,h=b[c+"s"]({search:"applied"}).indexes(),a=e.inArray(a,h),d=e.inArray(f,h),b[c+"s"]({selected:!0}).any()||-1!==a?(a>
d&&(g=d,d=a,a=g),h.splice(d+1,h.length),h.splice(0,a)):h.splice(e.inArray(f,h)+1,h.length),b[c](f,{selected:!0}).any()?(h.splice(e.inArray(f,h),1),b[c+"s"](h).deselect()):b[c+"s"](h).select()):(a=b[c+"s"]({selected:!0}),h&&1===a.flatten().length?b[c](f).deselect():(a.deselect(),b[c](f).select())):b[c](f).select(!h)}function r(a,b){return function(d){return d.i18n("buttons."+a,b)}}g.select={};g.select.version="1.0.0";e.each([{type:"row",prop:"aoData"},{type:"column",prop:"aoColumns"}],function(a,b){g.ext.selector[b.type].push(function(a,
c,f){c=c.selected;var e,h=[];if(c===k)return f;for(var g=0,l=f.length;g<l;g++)e=a[b.prop][f[g]],(!0===c&&!0===e._select_selected||!1===c&&!e._select_selected)&&h.push(f[g]);return h})});g.ext.selector.cell.push(function(a,b,d){b=b.selected;var c,f=[];if(b===k)return d;for(var e=0,g=d.length;e<g;e++)c=a.aoData[d[e].row],(!0===b&&c._selected_cells&&!0===c._selected_cells[d[e].column]||!(!1!==b||c._selected_cells&&c._selected_cells[d[e].column]))&&f.push(d[e]);return f});var n=g.Api.register,p=g.Api.registerPlural;
n("select()",function(){});n("select.blurable()",function(a){return a===k?this.context[0]._select.blurable:this.iterator("table",function(b){b._select.blurable=a})});n("select.info()",function(a){return w===k?this.context[0]._select.info:this.iterator("table",function(b){b._select.info=a})});n("select.items()",function(a){return a===k?this.context[0]._select.items:this.iterator("table",function(b){b._select.items=a;l(new g.Api(b),"selectItems",[a])})});n("select.style()",function(a){return a===k?
this.context[0]._select.style:this.iterator("table",function(b){b._select.style=a;b._select_init||y(b);var d=new g.Api(b);t(d);"api"!==a&&v(d);l(new g.Api(b),"selectStyle",[a])})});n("select.selector()",function(a){return a===k?this.context[0]._select.selector:this.iterator("table",function(b){t(new g.Api(b));b._select.selector=a;"api"!==b._select.style&&v(new g.Api(b))})});p("rows().select()","row().select()",function(a){var b=this;if(!1===a)return this.deselect();this.iterator("row",function(b,
a){q(b);b.aoData[a]._select_selected=!0;e(b.aoData[a].nTr).addClass("selected")});this.iterator("table",function(a,c){l(b,"select",["row",b[c]],!0)});return this});p("columns().select()","column().select()",function(a){var b=this;if(!1===a)return this.deselect();this.iterator("column",function(b,a){q(b);b.aoColumns[a]._select_selected=!0;var f=(new g.Api(b)).column(a);e(f.header()).addClass("selected");e(f.footer()).addClass("selected");f.nodes().to$().addClass("selected")});this.iterator("table",
function(a,c){l(b,"select",["column",b[c]],!0)});return this});p("cells().select()","cell().select()",function(a){var b=this;if(!1===a)return this.deselect();this.iterator("cell",function(b,a,f){q(b);b=b.aoData[a];b._selected_cells===k&&(b._selected_cells=[]);b._selected_cells[f]=!0;b.anCells&&e(b.anCells[f]).addClass("selected")});this.iterator("table",function(a,c){l(b,"select",["cell",b[c]],!0)});return this});p("rows().deselect()","row().deselect()",function(){var a=this;this.iterator("row",function(b,
a){b.aoData[a]._select_selected=!1;e(b.aoData[a].nTr).removeClass("selected")});this.iterator("table",function(b,d){l(a,"deselect",["row",a[d]],!0)});return this});p("columns().deselect()","column().deselect()",function(){var a=this;this.iterator("column",function(b,a){b.aoColumns[a]._select_selected=!1;var c=new g.Api(b),f=c.column(a);e(f.header()).removeClass("selected");e(f.footer()).removeClass("selected");c.cells(null,a).indexes().each(function(a){var c=b.aoData[a.row],d=c._selected_cells;!c.anCells||
d&&d[a.column]||e(c.anCells[a.column]).removeClass("selected")})});this.iterator("table",function(b,d){l(a,"deselect",["column",a[d]],!0)});return this});p("cells().deselect()","cell().deselect()",function(){var a=this;this.iterator("cell",function(a,d,c){d=a.aoData[d];d._selected_cells[c]=!1;d.anCells&&!a.aoColumns[c]._select_selected&&e(d.anCells[c]).removeClass("selected")});this.iterator("table",function(b,d){l(a,"deselect",["cell",a[d]],!0)});return this});e.extend(g.ext.buttons,{selected:{text:r("selected",
"Selected"),className:"buttons-selected",init:function(a,b,d){var c=this;a.on("select.dt.DT deselect.dt.DT",function(){var a=c.rows({selected:!0}).any()||c.columns({selected:!0}).any()||c.cells({selected:!0}).any();c.enable(a)});this.disable()}},selectedSingle:{text:r("selectedSingle","Selected single"),className:"buttons-selected-single",init:function(a,b,d){var c=this;a.on("select.dt.DT deselect.dt.DT",function(){var b=a.rows({selected:!0}).flatten().length+a.columns({selected:!0}).flatten().length+
a.cells({selected:!0}).flatten().length;c.enable(1===b)});this.disable()}},selectAll:{text:r("selectAll","Select all"),className:"buttons-select-all",action:function(){this[this.select.items()+"s"]().select()}},selectNone:{text:r("selectNone","Deselect all"),className:"buttons-select-none",action:function(){q(this.settings()[0],!0)}}});e.each(["Row","Column","Cell"],function(a,b){var d=b.toLowerCase();g.ext.buttons["select"+b+"s"]={text:r("select"+b+"s","Select "+d+"s"),className:"buttons-select-"+
d+"s",action:function(){this.select.items(d)},init:function(a,b,e){var g=this;a.on("selectItems.dt.DT",function(a,b,c){g.active(c===d)})}}});e(x).on("init.dt.dtSelect",function(a,b,d){if("dt"===a.namespace){a=b.oInit.select||g.defaults.select;d=new g.Api(b);var c="row",f="api",l=!1,h=!0,m="td, th";b._select={};!0===a?f="os":"string"===typeof a?f=a:e.isPlainObject(a)&&(a.blurable!==k&&(l=a.blurable),a.info!==k&&(h=a.info),a.items!==k&&(c=a.items),a.style!==k&&(f=a.style),a.selector!==k&&(m=a.selector));
d.select.selector(m);d.select.items(c);d.select.style(f);d.select.blurable(l);d.select.info(h);e(d.table().node()).hasClass("selectable")&&d.select.style("os")}})};"function"===typeof define&&define.amd?define(["jquery","datatables"],m):"object"===typeof exports?m(require("jquery"),require("datatables")):jQuery&&!jQuery.fn.dataTable.select&&m(jQuery,jQuery.fn.dataTable)})(window,document);
