(function(K){(function(a){function c(a){a=g(a||{});var c;c=d("uploaderType",void 0);var k=d("endpointType",void 0);c?(c=c.charAt(0).toUpperCase()+c.slice(1).toLowerCase(),c=k?new b[k]["FineUploader"+c](a):new b["FineUploader"+c](a)):c=k?new b[k].FineUploader(a):new b.FineUploader(a);e(c);f(a,c);return l}function d(a,b){var c=l.data("fineuploader");if(b)void 0===c&&(c={}),c[a]=b,l.data("fineuploader",c);else return void 0===c?null:c[a]}function e(a){return d("uploader",a)}function f(c,d){var e=c.callbacks=
{};a.each(d._options.callbacks,function(c,d){var g,f;g=/^on(\w+)/.exec(c)[1];g=g.substring(0,1).toLowerCase()+g.substring(1);f=l;e[c]=function(){var c=Array.prototype.slice.call(arguments),e=[],r;a.each(c,function(a,b){e.push(k(b))});c=d.apply(this,c);try{r=f.triggerHandler(g,e)}catch(h){b.log("Caught error in Fine Uploader jQuery event handler: "+h.message,"error")}return null!=c?c:r}});d._options.callbacks=e}function g(b,c){var e,f;e=void 0===c?"basic"!==b.uploaderType?{element:l[0]}:{}:c;a.each(b,
function(b,c){0<=a.inArray(b,m)?d(b,c):c instanceof a?e[b]=c[0]:a.isPlainObject(c)?(e[b]={},g(c,e[b])):a.isArray(c)?(f=[],a.each(c,function(b,c){var d={};c instanceof a?a.merge(f,c):a.isPlainObject(c)?(g(c,d),f.push(d)):f.push(c)}),e[b]=f):e[b]=c});if(void 0===c)return e}function h(a){var b=[],c=Array.prototype.slice.call(arguments,1);g(c,b);b=e()[a].apply(e(),b);return k(b)}function k(b){var c=b;null==b||"object"!==typeof b||1!==b.nodeType&&9!==b.nodeType||!b.cloneNode||(c=a(b));return c}var l,m=
["uploaderType","endpointType"];a.fn.fineUploader=function(b){var d=this,g=arguments,f=[];this.each(function(k,m){l=a(m);var v;if(v=e())v=b,v="string"===a.type(v)&&!v.match(/^_/)&&void 0!==e()[v];if(v){if(f.push(h.apply(d,g)),1===d.length)return!1}else"object"!==typeof b&&b?a.error("Method "+b+" does not exist on jQuery.fineUploader"):c.apply(d,g)});return 1===f.length?f[0]:1<f.length?f:this}})(jQuery);(function(a){function c(a){a||(a={});a.dropZoneElements=[h];a=f(a);e(a);d(new b.DragAndDrop(a));
return h}function d(a){var b=h.data("fineUploaderDnd");a?(void 0===b&&(b={}),b.dndInstance=a,h.data("fineUploaderDnd",b),a=void 0):a=void 0===b?null:b.dndInstance;return a}function e(c){var d=c.callbacks={};a.each(new b.DragAndDrop.callbacks,function(a,b){var c;c=h;d[a]=function(){var b=Array.prototype.slice.call(arguments);return c.triggerHandler(a,b)}})}function f(b,c){var d,e;d=void 0===c?{}:c;a.each(b,function(b,c){c instanceof a?d[b]=c[0]:a.isPlainObject(c)?(d[b]={},f(c,d[b])):a.isArray(c)?(e=
[],a.each(c,function(b,c){c instanceof a?a.merge(e,c):e.push(c)}),d[b]=e):d[b]=c});if(void 0===c)return d}function g(a){var b=[],c=Array.prototype.slice.call(arguments,1);f(c,b);return d()[a].apply(d(),b)}var h;a.fn.fineUploaderDnd=function(b){var e=this,f=arguments,n=[];this.each(function(q,p){h=a(p);var r;if(r=d())r=b,r="string"===a.type(r)&&"dispose"===r&&void 0!==d()[r];if(r){if(n.push(g.apply(e,f)),1===e.length)return!1}else"object"!==typeof b&&b?a.error("Method "+b+" does not exist in Fine Uploader's DnD module."):
c.apply(e,f)});return 1===n.length?n[0]:1<n.length?n:this}})(jQuery);var b=function(a){return{hide:function(){a.style.display="none";return this},attach:function(c,d){a.addEventListener?a.addEventListener(c,d,!1):a.attachEvent&&a.attachEvent("on"+c,d);return function(){b(a).detach(c,d)}},detach:function(b,d){a.removeEventListener?a.removeEventListener(b,d,!1):a.attachEvent&&a.detachEvent("on"+b,d);return this},contains:function(b){return b?a===b?!0:a.contains?a.contains(b):!!(b.compareDocumentPosition(a)&
8):!1},insertBefore:function(b){b.parentNode.insertBefore(a,b);return this},remove:function(){a.parentNode.removeChild(a);return this},css:function(c){if(null==a.style)throw new b.Error("Can't apply style to node as it is not on the HTMLElement prototype chain!");null!=c.opacity&&"string"!==typeof a.style.opacity&&"undefined"!==typeof a.filters&&(c.filter="alpha(opacity="+Math.round(100*c.opacity)+")");b.extend(a.style,c);return this},hasClass:function(b,d){var e=new RegExp("(^| )"+b+"( |$)");return e.test(a.className)||
!(!d||!e.test(a.parentNode.className))},addClass:function(c){b(a).hasClass(c)||(a.className+=" "+c);return this},removeClass:function(b){a.className=a.className.replace(new RegExp("(^| )"+b+"( |$)")," ").replace(/^\s+|\s+$/g,"");return this},getByClass:function(c,d){var e,f=[];if(d&&a.querySelector)return a.querySelector("."+c);if(a.querySelectorAll)return a.querySelectorAll("."+c);e=a.getElementsByTagName("*");b.each(e,function(a,d){b(d).hasClass(c)&&f.push(d)});return d?f[0]:f},getFirstByClass:function(c){return b(a).getByClass(c,
!0)},children:function(){for(var b=[],d=a.firstChild;d;)1===d.nodeType&&b.push(d),d=d.nextSibling;return b},setText:function(b){a.innerText=b;a.textContent=b;return this},clearText:function(){return b(a).setText("")},hasAttribute:function(b){if(a.hasAttribute)return a.hasAttribute(b)?null==/^false$/i.exec(a.getAttribute(b)):!1;b=a[b];return void 0===b?!1:null==/^false$/i.exec(b)}}};(function(){b.canvasToBlob=function(a,c,d){return b.dataUriToBlob(a.toDataURL(c,d))};b.dataUriToBlob=function(a){var c,
d,e;c=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURI(a.split(",")[1]);e=a.split(",")[0].split(":")[1].split(";")[0];a=new ArrayBuffer(c.length);d=new Uint8Array(a);b.each(c,function(a,b){d[a]=b.charCodeAt(0)});return function(a,b){var c=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;return(c=c&&new c)?(c.append(a),c.getBlob(b)):new Blob([a],{type:b})}(a,e)};b.log=function(a,b){if(window.console)if(b&&"info"!==b)if(window.console[b])window.console[b](a);
else window.console.log("<"+b+"> "+a);else window.console.log(a)};b.isObject=function(a){return a&&!a.nodeType&&"[object Object]"===Object.prototype.toString.call(a)};b.isFunction=function(a){return"function"===typeof a};b.isArray=function(a){return"[object Array]"===Object.prototype.toString.call(a)||a&&window.ArrayBuffer&&a.buffer&&a.buffer.constructor===ArrayBuffer};b.isItemList=function(a){return"[object DataTransferItemList]"===Object.prototype.toString.call(a)};b.isNodeList=function(a){return"[object NodeList]"===
Object.prototype.toString.call(a)||a.item&&a.namedItem};b.isString=function(a){return"[object String]"===Object.prototype.toString.call(a)};b.trimStr=function(a){return String.prototype.trim?a.trim():a.replace(/^\s+|\s+$/g,"")};b.format=function(a){var c=Array.prototype.slice.call(arguments,1),d=a,e=d.indexOf("{}");b.each(c,function(a,b){var c=d.substring(0,e),k=d.substring(e+2);d=c+b+k;e=d.indexOf("{}",e+b.length);if(0>e)return!1});return d};b.isFile=function(a){return window.File&&"[object File]"===
Object.prototype.toString.call(a)};b.isFileList=function(a){return window.FileList&&"[object FileList]"===Object.prototype.toString.call(a)};b.isFileOrInput=function(a){return b.isFile(a)||b.isInput(a)};b.isInput=function(a,b){var d=function(a){a=a.toLowerCase();return b?"file"!==a:"file"===a};return window.HTMLInputElement&&"[object HTMLInputElement]"===Object.prototype.toString.call(a)&&a.type&&d(a.type)||a.tagName&&"input"===a.tagName.toLowerCase()&&a.type&&d(a.type)?!0:!1};b.isBlob=function(a){if(window.Blob&&
"[object Blob]"===Object.prototype.toString.call(a))return!0};b.isXhrUploadSupported=function(){var a=document.createElement("input");a.type="file";return void 0!==a.multiple&&"undefined"!==typeof File&&"undefined"!==typeof FormData&&"undefined"!==typeof b.createXhrInstance().upload};b.createXhrInstance=function(){if(window.XMLHttpRequest)return new XMLHttpRequest;try{return new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(a){return b.log("Neither XHR or ActiveX are supported!","error"),null}};b.isFolderDropSupported=
function(a){return a.items&&0<a.items.length&&a.items[0].webkitGetAsEntry};b.isFileChunkingSupported=function(){return!b.androidStock()&&b.isXhrUploadSupported()&&(void 0!==File.prototype.slice||void 0!==File.prototype.webkitSlice||void 0!==File.prototype.mozSlice)};b.sliceBlob=function(a,b,d){return(a.slice||a.mozSlice||a.webkitSlice).call(a,b,d)};b.arrayBufferToHex=function(a){var c="";a=new Uint8Array(a);b.each(a,function(a,b){var f=b.toString(16);2>f.length&&(f="0"+f);c+=f});return c};b.readBlobToHex=
function(a,c,d){a=b.sliceBlob(a,c,c+d);var e=new FileReader,f=new b.Promise;e.onload=function(){f.success(b.arrayBufferToHex(e.result))};e.onerror=f.failure;e.readAsArrayBuffer(a);return f};b.extend=function(a,c,d){b.each(c,function(c,f){d&&b.isObject(f)?(void 0===a[c]&&(a[c]={}),b.extend(a[c],f,!0)):a[c]=f});return a};b.override=function(a,c){var d={},e=c(d);b.each(e,function(b,c){void 0!==a[b]&&(d[b]=a[b]);a[b]=c});return a};b.indexOf=function(a,b,d){if(a.indexOf)return a.indexOf(b,d);d=d||0;var e=
a.length;for(0>d&&(d+=e);d<e;d+=1)if(a.hasOwnProperty(d)&&a[d]===b)return d;return-1};b.getUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=16*Math.random()|0;return("x"==a?b:b&3|8).toString(16)})};b.ie=function(){return-1!==navigator.userAgent.indexOf("MSIE")||-1!==navigator.userAgent.indexOf("Trident")};b.ie7=function(){return-1!==navigator.userAgent.indexOf("MSIE 7")};b.ie8=function(){return-1!==navigator.userAgent.indexOf("MSIE 8")};b.ie10=function(){return-1!==
navigator.userAgent.indexOf("MSIE 10")};b.ie11=function(){return b.ie()&&-1!==navigator.userAgent.indexOf("rv:11")};b.edge=function(){return 0<=navigator.userAgent.indexOf("Edge")};b.safari=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Apple")};b.chrome=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Google")};b.opera=function(){return void 0!==navigator.vendor&&-1!==navigator.vendor.indexOf("Opera")};b.firefox=function(){return!b.edge()&&
!b.ie11()&&-1!==navigator.userAgent.indexOf("Mozilla")&&void 0!==navigator.vendor&&""===navigator.vendor};b.windows=function(){return"Win32"===navigator.platform};b.android=function(){return-1!==navigator.userAgent.toLowerCase().indexOf("android")};b.androidStock=function(){return b.android()&&0>navigator.userAgent.toLowerCase().indexOf("chrome")};b.ios6=function(){return b.ios()&&-1!==navigator.userAgent.indexOf(" OS 6_")};b.ios7=function(){return b.ios()&&-1!==navigator.userAgent.indexOf(" OS 7_")};
b.ios8=function(){return b.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_")};b.ios800=function(){return b.ios()&&-1!==navigator.userAgent.indexOf(" OS 8_0 ")};b.ios=function(){return-1!==navigator.userAgent.indexOf("iPad")||-1!==navigator.userAgent.indexOf("iPod")||-1!==navigator.userAgent.indexOf("iPhone")};b.iosChrome=function(){return b.ios()&&-1!==navigator.userAgent.indexOf("CriOS")};b.iosSafari=function(){return b.ios()&&!b.iosChrome()&&-1!==navigator.userAgent.indexOf("Safari")};b.iosSafariWebView=
function(){return b.ios()&&!b.iosChrome()&&!b.iosSafari()};b.preventDefault=function(a){a.preventDefault?a.preventDefault():a.returnValue=!1};b.toElement=function(){var a=document.createElement("div");return function(b){a.innerHTML=b;b=a.firstChild;a.removeChild(b);return b}}();b.each=function(a,c){var d,e;if(a)if(window.Storage&&a.constructor===window.Storage)for(d=0;d<a.length&&(e=c(a.key(d),a.getItem(a.key(d))),!1!==e);d++);else if(b.isArray(a)||b.isItemList(a)||b.isNodeList(a))for(d=0;d<a.length&&
(e=c(d,a[d]),!1!==e);d++);else if(b.isString(a))for(d=0;d<a.length&&(e=c(d,a.charAt(d)),!1!==e);d++);else for(d in a)if(Object.prototype.hasOwnProperty.call(a,d)&&(e=c(d,a[d]),!1===e))break};b.bind=function(a,c){if(b.isFunction(a)){var d=Array.prototype.slice.call(arguments,2);return function(){var e=b.extend([],d);arguments.length&&(e=e.concat(Array.prototype.slice.call(arguments)));return a.apply(c,e)}}throw Error("first parameter must be a function!");};b.obj2url=function(a,c,d){var e=[],f="&",
g=function(a,d){var g=c?/\[\]$/.test(c)?c:c+"["+d+"]":d;"undefined"!==g&&"undefined"!==d&&e.push("object"===typeof a?b.obj2url(a,g,!0):"[object Function]"===Object.prototype.toString.call(a)?encodeURIComponent(g)+"="+encodeURIComponent(a()):encodeURIComponent(g)+"="+encodeURIComponent(a))};!d&&c?(f=/\?/.test(c)?/\?$/.test(c)?"":"&":"?",e.push(c),e.push(b.obj2url(a))):"[object Array]"===Object.prototype.toString.call(a)&&"undefined"!==typeof a?b.each(a,function(a,b){g(b,a)}):"undefined"!==typeof a&&
null!==a&&"object"===typeof a?b.each(a,function(a,b){g(b,a)}):e.push(encodeURIComponent(c)+"="+encodeURIComponent(a));return c?e.join(f):e.join(f).replace(/^&/,"").replace(/%20/g,"+")};b.obj2FormData=function(a,c,d){c||(c=new FormData);b.each(a,function(a,f){a=d?d+"["+a+"]":a;b.isObject(f)?b.obj2FormData(f,c,a):b.isFunction(f)?c.append(a,f()):c.append(a,f)});return c};b.obj2Inputs=function(a,c){var d;c||(c=document.createElement("form"));b.obj2FormData(a,{append:function(a,b){d=document.createElement("input");
d.setAttribute("name",a);d.setAttribute("value",b);c.appendChild(d)}});return c};b.parseJson=function(a){return window.JSON&&b.isFunction(JSON.parse)?JSON.parse(a):eval("("+a+")")};b.getExtension=function(a){var b=a.lastIndexOf(".")+1;if(0<b)return a.substr(b,a.length-b)};b.getFilename=function(a){return b.isInput(a)?a.value.replace(/.*(\/|\\)/,""):b.isFile(a)&&null!==a.fileName&&void 0!==a.fileName?a.fileName:a.name};b.DisposeSupport=function(){var a=[];return{dispose:function(){var b;do(b=a.shift())&&
b();while(b)},attach:function(){this.addDisposer(b(arguments[0]).attach.apply(this,Array.prototype.slice.call(arguments,1)))},addDisposer:function(b){a.push(b)}}}})();(function(){"function"===typeof define&&define.amd?define(function(){return b}):"undefined"!==typeof module&&module.exports?module.exports=b:K.qq=b})();(function(){b.Error=function(a){this.message="[Fine Uploader "+b.version+"] "+a};b.Error.prototype=Error()})();b.version="5.11.10";b.supportedFeatures=function(){function a(){var a=document.createElement("span");
return("draggable"in a||"ondragstart"in a&&"ondrop"in a)&&!b.android()&&!b.ios()}var c,d,e,f,g,h,k,l,m,n,q,p,r,y,w;d=(f=(c=function(){var a=!0,c;try{c=document.createElement("input"),c.type="file",b(c).hide(),c.disabled&&(a=!1)}catch(d){a=!1}return a}())&&b.isXhrUploadSupported())&&!b.androidStock();g=(e=f&&a())&&(b.chrome()||b.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[2][1-9]|Chrome\/[3-9][0-9]/);h=f&&b.isFileChunkingSupported();if(k=f&&h)try{k=!!window.localStorage&&b.isFunction(window.localStorage.setItem)}catch(v){k=
!1}l=f&&(b.chrome()||b.opera())&&void 0!==navigator.userAgent.match(/Chrome\/[1][4-9]|Chrome\/[2-9][0-9]/);m=c&&(void 0!==window.postMessage||f);q=window.XMLHttpRequest?void 0!==b.createXhrInstance().withCredentials:!1;n=void 0!==window.XDomainRequest;p=window.XMLHttpRequest&&void 0!==b.createXhrInstance().withCredentials?!0:void 0!==window.XDomainRequest;r=void 0!==document.createElement("input").webkitdirectory;y=f&&void 0!==window.FileReader;w=f?!b.androidStock()&&!b.iosChrome():!1;return{ajaxUploading:f,
blobUploading:d,canDetermineSize:f,chunking:h,deleteFileCors:p,deleteFileCorsXdr:n,deleteFileCorsXhr:q,dialogElement:!!window.HTMLDialogElement,fileDrop:e,folderDrop:g,folderSelection:r,imagePreviews:y,imageValidation:y,itemSizeValidation:f,pause:h,progressBar:w,resume:k,scaling:y&&d,tiffPreviews:b.safari(),unlimitedScaledImageSize:!b.ios(),uploading:c,uploadCors:m,uploadCustomHeaders:f,uploadNonMultipart:f,uploadViaPaste:l}}();b.isGenericPromise=function(a){return!!(a&&a.then&&b.isFunction(a.then))};
b.Promise=function(){var a,c,d=[],e=[],f=[],g=0;b.extend(this,{then:function(b,f){0===g?(b&&d.push(b),f&&e.push(f)):-1===g?f&&f.apply(null,c):b&&b.apply(null,a);return this},done:function(b){0===g?f.push(b):b.apply(null,void 0===c?a:c);return this},success:function(){g=1;a=arguments;d.length&&b.each(d,function(b,c){c.apply(null,a)});f.length&&b.each(f,function(b,c){c.apply(null,a)});return this},failure:function(){g=-1;c=arguments;e.length&&b.each(e,function(a,b){b.apply(null,c)});f.length&&b.each(f,
function(a,b){b.apply(null,c)});return this}})};b.BlobProxy=function(a,c){b.extend(this,{referenceBlob:a,create:function(){return c(a)}})};b.UploadButton=function(a){function c(){var a=document.createElement("input");a.setAttribute(b.UploadButton.BUTTON_ID_ATTR_NAME,h);a.setAttribute("title",f.title);d.setMultiple(f.multiple,a);f.folders&&b.supportedFeatures.folderSelection&&a.setAttribute("webkitdirectory","");f.acceptFiles&&a.setAttribute("accept",f.acceptFiles);a.setAttribute("type","file");a.setAttribute("name",
f.name);b(a).css({position:"absolute",right:0,top:0,fontFamily:"Arial",fontSize:b.ie()&&!b.ie8()?"3500px":"118px",margin:0,padding:0,cursor:"pointer",opacity:0});!b.ie7()&&b(a).css({height:"100%"});f.element.appendChild(a);e.attach(a,"change",function(){f.onChange(a)});e.attach(a,"mouseover",function(){b(f.element).addClass(f.hoverClass)});e.attach(a,"mouseout",function(){b(f.element).removeClass(f.hoverClass)});e.attach(a,"focus",function(){b(f.element).addClass(f.focusClass)});e.attach(a,"blur",
function(){b(f.element).removeClass(f.focusClass)});return a}var d=this,e=new b.DisposeSupport,f={acceptFiles:null,element:null,focusClass:"qq-upload-button-focus",folders:!1,hoverClass:"qq-upload-button-hover",ios8BrowserCrashWorkaround:!1,multiple:!1,name:"qqfile",onChange:function(a){},title:null},g,h;b.extend(f,a);h=b.getUniqueId();b(f.element).css({position:"relative",overflow:"hidden",direction:"ltr"});b.extend(this,{getInput:function(){return g},getButtonId:function(){return h},setMultiple:function(a,
c){var d=c||this.getInput();f.ios8BrowserCrashWorkaround&&b.ios8()&&(b.iosChrome()||b.iosSafariWebView())?d.setAttribute("multiple",""):a?d.setAttribute("multiple",""):d.removeAttribute("multiple")},setAcceptFiles:function(a){a!==f.acceptFiles&&g.setAttribute("accept",a)},reset:function(){g.parentNode&&b(g).remove();b(f.element).removeClass(f.focusClass);g=null;g=c()}});g=c()};b.UploadButton.BUTTON_ID_ATTR_NAME="qq-button-id";b.UploadData=function(a){function c(a){if(b.isArray(a)){var c=[];b.each(a,
function(a,b){c.push(f[b])});return c}return f[a]}function d(a){if(b.isArray(a)){var c=[];b.each(a,function(a,b){c.push(f[g[b]])});return c}return f[g[a]]}function e(a){var c=[];a=[].concat(a);b.each(a,function(a,d){var e=h[d];void 0!==e&&b.each(e,function(a,b){c.push(f[b])})});return c}var f=[],g={},h={},k={},l={};b.extend(this,{addFile:function(c){var d=c.status||b.status.SUBMITTING,e=f.push({name:c.name,originalName:c.name,uuid:c.uuid,size:null==c.size?-1:c.size,status:d})-1;c.batchId&&(f[e].batchId=
c.batchId,void 0===l[c.batchId]&&(l[c.batchId]=[]),l[c.batchId].push(e));c.proxyGroupId&&(f[e].proxyGroupId=c.proxyGroupId,void 0===k[c.proxyGroupId]&&(k[c.proxyGroupId]=[]),k[c.proxyGroupId].push(e));f[e].id=e;g[c.uuid]=e;void 0===h[d]&&(h[d]=[]);h[d].push(e);a.onStatusChange(e,null,d);return e},retrieve:function(a){if(b.isObject(a)&&f.length){if(void 0!==a.id)return c(a.id);if(void 0!==a.uuid)return d(a.uuid);if(a.status)return e(a.status)}else return b.extend([],f,!0)},reset:function(){f=[];g=
{};h={};l={}},setStatus:function(c,d){var e=f[c].status,g=b.indexOf(h[e],c);h[e].splice(g,1);f[c].status=d;void 0===h[d]&&(h[d]=[]);h[d].push(c);a.onStatusChange(c,e,d)},uuidChanged:function(a,b){var c=f[a].uuid;f[a].uuid=b;g[b]=a;delete g[c]},updateName:function(a,b){f[a].name=b},updateSize:function(a,b){f[a].size=b},setParentId:function(a,b){f[a].parentId=b},getIdsInProxyGroup:function(a){return(a=f[a].proxyGroupId)?k[a]:[]},getIdsInBatch:function(a){return l[f[a].batchId]}})};b.status={SUBMITTING:"submitting",
SUBMITTED:"submitted",REJECTED:"rejected",QUEUED:"queued",CANCELED:"canceled",PAUSED:"paused",UPLOADING:"uploading",UPLOAD_RETRYING:"retrying upload",UPLOAD_SUCCESSFUL:"upload successful",UPLOAD_FAILED:"upload failed",DELETE_FAILED:"delete failed",DELETING:"deleting",DELETED:"deleted"};(function(){b.basePublicApi={addBlobs:function(a,b,d){this.addFiles(a,b,d)},addInitialFiles:function(a){var c=this;b.each(a,function(a,b){c._addCannedFile(b)})},addFiles:function(a,c,d){this._maybeHandleIos8SafariWorkaround();
var e=0===this._storedIds.length?b.getUniqueId():this._currentBatchId,f=b.bind(function(a){this._handleNewFile({blob:a,name:this._options.blobs.defaultName},e,n)},this),g=b.bind(function(a){this._handleNewFile(a,e,n)},this),h=b.bind(function(a){a=b.canvasToBlob(a);this._handleNewFile({blob:a,name:this._options.blobs.defaultName+".png"},e,n)},this),k=b.bind(function(a){var c=b.canvasToBlob(a.canvas,a.type,a.quality&&a.quality/100);this._handleNewFile({blob:c,name:a.name},e,n)},this),l=b.bind(function(a){if(b.isInput(a)&&
b.supportedFeatures.ajaxUploading){a=Array.prototype.slice.call(a.files);var c=this;b.each(a,function(a,b){c._handleNewFile(b,e,n)})}else this._handleNewFile(a,e,n)},this),m=this,n=[];this._currentBatchId=e;a&&(b.isFileList(a)&&(a=Array.prototype.slice.call(a)),a=[].concat(a),b.each(a,function(a,c){b.isFileOrInput(c)?l(c):b.isBlob(c)?f(c):b.isObject(c)?c.blob&&c.name?g(c):c.canvas&&c.name&&k(c):c.tagName&&"canvas"===c.tagName.toLowerCase()?h(c):m.log(c+" is not a valid file container!  Ignoring!",
"warn")}),this.log("Received "+n.length+" files."),this._prepareItemsForUpload(n,c,d))},cancel:function(a){this._handler.cancel(a)},cancelAll:function(){var a=[],c=this;b.extend(a,this._storedIds);b.each(a,function(a,b){c.cancel(b)});this._handler.cancelAll()},clearStoredFiles:function(){this._storedIds=[]},continueUpload:function(a){var c=this._uploadData.retrieve({id:a});if(!b.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(c.status===b.status.PAUSED)return this.log(b.format("Paused file ID {} ({}) will be continued.  Not paused.",
a,this.getName(a))),this._uploadFile(a),!0;this.log(b.format("Ignoring continue for file ID {} ({}).  Not paused.",a,this.getName(a)),"error");return!1},deleteFile:function(a){return this._onSubmitDelete(a)},doesExist:function(a){return this._handler.isValid(a)},drawThumbnail:function(a,c,d,e,f){var g=new b.Promise,h;this._imageGenerator?(h=this._thumbnailUrls[a],d={customResizeFunction:f,maxSize:0<d?d:null,scale:0<d},!e&&b.supportedFeatures.imagePreviews&&(h=this.getFile(a)),null==h?g.failure({container:c,
error:"File or URL not found."}):this._imageGenerator.generate(h,c,d).then(function(a){g.success(a)},function(a,b){g.failure({container:a,error:b||"Problem generating thumbnail"})})):g.failure({container:c,error:"Missing image generator module"});return g},getButton:function(a){return this._getButton(this._buttonIdsForFileIds[a])},getEndpoint:function(a){return this._endpointStore.get(a)},getFile:function(a){return this._handler.getFile(a)||null},getInProgress:function(){return this._uploadData.retrieve({status:[b.status.UPLOADING,
b.status.UPLOAD_RETRYING,b.status.QUEUED]}).length},getName:function(a){return this._uploadData.retrieve({id:a}).name},getParentId:function(a){a=this.getUploads({id:a});var b=null;a&&void 0!==a.parentId&&(b=a.parentId);return b},getResumableFilesData:function(){return this._handler.getResumableFilesData()},getSize:function(a){return this._uploadData.retrieve({id:a}).size},getNetUploads:function(){return this._netUploaded},getRemainingAllowedItems:function(){var a=this._currentItemLimit;return 0<a?
a-this._netUploadedOrQueued:null},getUploads:function(a){return this._uploadData.retrieve(a)},getUuid:function(a){return this._uploadData.retrieve({id:a}).uuid},log:function(a,c){!this._options.debug||c&&"info"!==c?c&&"info"!==c&&b.log("[Fine Uploader "+b.version+"] "+a,c):b.log("[Fine Uploader "+b.version+"] "+a)},pauseUpload:function(a){var c=this._uploadData.retrieve({id:a});if(!b.supportedFeatures.pause||!this._options.chunking.enabled)return!1;if(0<=b.indexOf([b.status.UPLOADING,b.status.UPLOAD_RETRYING],
c.status)){if(this._handler.pause(a))return this._uploadData.setStatus(a,b.status.PAUSED),!0;this.log(b.format("Unable to pause file ID {} ({}).",a,this.getName(a)),"error")}else this.log(b.format("Ignoring pause for file ID {} ({}).  Not in progress.",a,this.getName(a)),"error");return!1},reset:function(){this.log("Resetting uploader...");this._handler.reset();this._storedIds=[];this._autoRetries=[];this._retryTimeouts=[];this._preventRetries=[];this._thumbnailUrls=[];b.each(this._buttons,function(a,
b){b.reset()});this._paramsStore.reset();this._endpointStore.reset();this._netUploaded=this._netUploadedOrQueued=0;this._uploadData.reset();this._buttonIdsForFileIds=[];this._pasteHandler&&this._pasteHandler.reset();this._options.session.refreshOnReset&&this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[];this._totalProgress&&this._totalProgress.reset()},retry:function(a){return this._manualRetry(a)},scaleImage:function(a,c){return b.Scaler.prototype.scaleImage(a,
c,{log:b.bind(this.log,this),getFile:b.bind(this.getFile,this),uploadData:this._uploadData})},setCustomHeaders:function(a,b){this._customHeadersStore.set(a,b)},setDeleteFileCustomHeaders:function(a,b){this._deleteFileCustomHeadersStore.set(a,b)},setDeleteFileEndpoint:function(a,b){this._deleteFileEndpointStore.set(a,b)},setDeleteFileParams:function(a,b){this._deleteFileParamsStore.set(a,b)},setEndpoint:function(a,b){this._endpointStore.set(a,b)},setForm:function(a){this._updateFormSupportAndParams(a)},
setItemLimit:function(a){this._currentItemLimit=a},setName:function(a,b){this._uploadData.updateName(a,b)},setParams:function(a,b){this._paramsStore.set(a,b)},setUuid:function(a,b){return this._uploadData.uuidChanged(a,b)},uploadStoredFiles:function(){0===this._storedIds.length?this._itemError("noFilesError"):this._uploadStoredFiles()}};b.basePrivateApi={_addCannedFile:function(a){var c=this._uploadData.addFile({uuid:a.uuid,name:a.name,size:a.size,status:b.status.UPLOAD_SUCCESSFUL});a.deleteFileEndpoint&&
this.setDeleteFileEndpoint(a.deleteFileEndpoint,c);a.deleteFileParams&&this.setDeleteFileParams(a.deleteFileParams,c);a.thumbnailUrl&&(this._thumbnailUrls[c]=a.thumbnailUrl);this._netUploaded++;this._netUploadedOrQueued++;return c},_annotateWithButtonId:function(a,c){b.isFile(a)&&(a.qqButtonId=this._getButtonId(c))},_batchError:function(a){this._options.callbacks.onError(null,null,a,void 0)},_createDeleteHandler:function(){var a=this;return new b.DeleteFileAjaxRequester({method:this._options.deleteFile.method.toUpperCase(),
maxConnections:this._options.maxConnections,uuidParamName:this._options.request.uuidName,customHeaders:this._deleteFileCustomHeadersStore,paramsStore:this._deleteFileParamsStore,endpointStore:this._deleteFileEndpointStore,cors:this._options.cors,log:b.bind(a.log,a),onDelete:function(b){a._onDelete(b);a._options.callbacks.onDelete(b)},onDeleteComplete:function(b,d,e){a._onDeleteComplete(b,d,e);a._options.callbacks.onDeleteComplete(b,d,e)}})},_createPasteHandler:function(){var a=this;return new b.PasteSupport({targetElement:this._options.paste.targetElement,
callbacks:{log:b.bind(a.log,a),pasteReceived:function(c){a._handleCheckedCallback({name:"onPasteReceived",callback:b.bind(a._options.callbacks.onPasteReceived,a,c),onSuccess:b.bind(a._handlePasteSuccess,a,c),identifier:"pasted image"})}}})},_createStore:function(a,c){var d={},e=a,f={},g=c,h=function(a){return b.isObject(a)?b.extend({},a):a};return{set:function(a,b){null==b?(d={},e=h(a)):d[b]=h(a)},get:function(a){var c;c=null!=a&&d[a]?d[a]:h(e);g&&b.isObject(c)&&b.extend(c,b.isFunction(g)?g():g);
f[a]&&b.extend(c,f[a]);return h(c)},addReadOnly:function(a,c){b.isObject(d)&&(null===a?b.isFunction(c)?g=c:(g=g||{},b.extend(g,c)):(f[a]=f[a]||{},b.extend(f[a],c)))},remove:function(a){return delete d[a]},reset:function(){d={};f={};e=a}}},_createUploadDataTracker:function(){var a=this;return new b.UploadData({getName:function(b){return a.getName(b)},getUuid:function(b){return a.getUuid(b)},getSize:function(b){return a.getSize(b)},onStatusChange:function(b,d,e){a._onUploadStatusChange(b,d,e);a._options.callbacks.onStatusChange(b,
d,e);a._maybeAllComplete(b,e);a._totalProgress&&setTimeout(function(){a._totalProgress.onStatusChange(b,d,e)},0)}})},_createUploadButton:function(a){var c=this,d=a.allowedExtensions||this._options.validation.allowedExtensions,e;e=new b.UploadButton({acceptFiles:a.accept||this._options.validation.acceptFiles,element:a.element,focusClass:this._options.classes.buttonFocus,folders:a.folders,hoverClass:this._options.classes.buttonHover,ios8BrowserCrashWorkaround:this._options.workarounds.ios8BrowserCrash,
multiple:b.supportedFeatures.ajaxUploading?c._options.workarounds.iosEmptyVideos&&b.ios()&&!b.ios6()&&c._isAllowedExtension(d,".mov")?!1:void 0===a.multiple?c._options.multiple:a.multiple:!1,name:this._options.request.inputName,onChange:function(a){c._onInputChange(a)},title:null==a.title?this._options.text.fileInputTitle:a.title});this._disposeSupport.addDisposer(function(){e.dispose()});c._buttons.push(e);return e},_createUploadHandler:function(a,c){var d=this,e={},f={debug:this._options.debug,
maxConnections:this._options.maxConnections,cors:this._options.cors,paramsStore:this._paramsStore,endpointStore:this._endpointStore,chunking:this._options.chunking,resume:this._options.resume,blobs:this._options.blobs,log:b.bind(d.log,d),preventRetryParam:this._options.retry.preventRetryResponseProperty,onProgress:function(a,b,c,f){if(!(0>c||0>f)){if(e[a]){if(e[a].loaded!==c||e[a].total!==f)d._onProgress(a,b,c,f),d._options.callbacks.onProgress(a,b,c,f)}else d._onProgress(a,b,c,f),d._options.callbacks.onProgress(a,
b,c,f);e[a]={loaded:c,total:f}}},onComplete:function(a,c,f,l){delete e[a];var m=d.getUploads({id:a}).status;if(m!==b.status.UPLOAD_SUCCESSFUL&&m!==b.status.UPLOAD_FAILED)if(m=d._onComplete(a,c,f,l),m instanceof b.Promise)m.done(function(){d._options.callbacks.onComplete(a,c,f,l)});else d._options.callbacks.onComplete(a,c,f,l)},onCancel:function(a,c,e){var f=new b.Promise;d._handleCheckedCallback({name:"onCancel",callback:b.bind(d._options.callbacks.onCancel,d,a,c),onFailure:f.failure,onSuccess:function(){e.then(function(){d._onCancel(a,
c)});f.success()},identifier:a});return f},onUploadPrep:b.bind(this._onUploadPrep,this),onUpload:function(a,b){d._onUpload(a,b);d._options.callbacks.onUpload(a,b)},onUploadChunk:function(a,b,c){d._onUploadChunk(a,c);d._options.callbacks.onUploadChunk(a,b,c)},onUploadChunkSuccess:function(a,b,c,e){d._options.callbacks.onUploadChunkSuccess.apply(d,arguments)},onResume:function(a,b,c){return d._options.callbacks.onResume(a,b,c)},onAutoRetry:function(a,b,c,e){return d._onAutoRetry.apply(d,arguments)},
onUuidChanged:function(a,b){d.log("Server requested UUID change from '"+d.getUuid(a)+"' to '"+b+"'");d.setUuid(a,b)},getName:b.bind(d.getName,d),getUuid:b.bind(d.getUuid,d),getSize:b.bind(d.getSize,d),setSize:b.bind(d._setSize,d),getDataByUuid:function(a){return d.getUploads({uuid:a})},isQueued:function(a){a=d.getUploads({id:a}).status;return a===b.status.QUEUED||a===b.status.SUBMITTED||a===b.status.UPLOAD_RETRYING||a===b.status.PAUSED},getIdsInProxyGroup:d._uploadData.getIdsInProxyGroup,getIdsInBatch:d._uploadData.getIdsInBatch};
b.each(this._options.request,function(a,b){f[a]=b});f.customHeaders=this._customHeadersStore;a&&b.each(a,function(a,b){f[a]=b});return new b.UploadHandlerController(f,c)},_fileOrBlobRejected:function(a){this._netUploadedOrQueued--;this._uploadData.setStatus(a,b.status.REJECTED)},_formatSize:function(a){var b=-1;do a/=1E3,b++;while(999<a);return Math.max(a,.1).toFixed(1)+this._options.text.sizeSymbols[b]},_generateExtraButtonSpecs:function(){var a=this;this._extraButtonSpecs={};b.each(this._options.extraButtons,
function(c,d){var e=d.multiple,f=b.extend({},a._options.validation,!0),g=b.extend({},d);void 0===e&&(e=a._options.multiple);g.validation&&b.extend(f,d.validation,!0);b.extend(g,{multiple:e,validation:f},!0);a._initExtraButton(g)})},_getButton:function(a){var b=this._extraButtonSpecs[a];if(b)return b.element;if(a===this._defaultButtonId)return this._options.button},_getButtonId:function(a){var c;a instanceof b.BlobProxy&&(a=a.referenceBlob);if(a&&!b.isBlob(a)){if(b.isFile(a))return a.qqButtonId;if("input"===
a.tagName.toLowerCase()&&"file"===a.type.toLowerCase())return a.getAttribute(b.UploadButton.BUTTON_ID_ATTR_NAME);a=a.getElementsByTagName("input");b.each(a,function(a,b){if("file"===b.getAttribute("type"))return c=b,!1});if(c)return c.getAttribute(b.UploadButton.BUTTON_ID_ATTR_NAME)}},_getNotFinished:function(){return this._uploadData.retrieve({status:[b.status.UPLOADING,b.status.UPLOAD_RETRYING,b.status.QUEUED,b.status.SUBMITTING,b.status.SUBMITTED,b.status.PAUSED]}).length},_getValidationBase:function(a){return(a=
this._extraButtonSpecs[a])?a.validation:this._options.validation},_getValidationDescriptor:function(a){return a.file instanceof b.BlobProxy?{name:b.getFilename(a.file.referenceBlob),size:a.file.referenceBlob.size}:{name:this.getUploads({id:a.id}).name,size:this.getUploads({id:a.id}).size}},_getValidationDescriptors:function(a){var c=this,d=[];b.each(a,function(a,b){d.push(c._getValidationDescriptor(b))});return d},_handleCameraAccess:function(){if(this._options.camera.ios&&b.ios()){var a=this._options.camera.button,
c=a?this._getButtonId(a):this._defaultButtonId,d=this._options;c&&c!==this._defaultButtonId&&(d=this._extraButtonSpecs[c]);d.multiple=!1;d.validation.acceptFiles=null===d.validation.acceptFiles?"image/*;capture=camera":d.validation.acceptFiles+",image/*;capture=camera";b.each(this._buttons,function(a,b){if(b.getButtonId()===c)return b.setMultiple(d.multiple),b.setAcceptFiles(d.acceptFiles),!1})}},_handleCheckedCallback:function(a){var c=this,d=a.callback();if(b.isGenericPromise(d))return this.log(a.name+
" - waiting for "+a.name+" promise to be fulfilled for "+a.identifier),d.then(function(b){c.log(a.name+" promise success for "+a.identifier);a.onSuccess(b)},function(){a.onFailure?(c.log(a.name+" promise failure for "+a.identifier),a.onFailure()):c.log(a.name+" promise failure for "+a.identifier)});if(!1!==d)a.onSuccess(d);else a.onFailure?(this.log(a.name+" - return value was 'false' for "+a.identifier+".  Invoking failure callback."),a.onFailure()):this.log(a.name+" - return value was 'false' for "+
a.identifier+".  Will not proceed.");return d},_handleNewFile:function(a,c,d){var e=this,f=b.getUniqueId(),g=-1,h=b.getFilename(a);a=a.blob||a;var k=this._customNewFileHandler?this._customNewFileHandler:b.bind(e._handleNewFileGeneric,e);!b.isInput(a)&&0<=a.size&&(g=a.size);k(a,h,f,g,d,c,this._options.request.uuidName,{uploadData:e._uploadData,paramsStore:e._paramsStore,addFileToHandler:function(a,b){e._handler.add(a,b);e._netUploadedOrQueued++;e._trackButton(a)}})},_handleNewFileGeneric:function(a,
b,d,e,f,g){b=this._uploadData.addFile({uuid:d,name:b,size:e,batchId:g});this._handler.add(b,a);this._trackButton(b);this._netUploadedOrQueued++;f.push({id:b,file:a})},_handlePasteSuccess:function(a,b){var d=a.type.split("/")[1],e=b;null==e&&(e=this._options.paste.defaultName);this.addFiles({name:e+("."+d),blob:a})},_initExtraButton:function(a){var b=this._createUploadButton({accept:a.validation.acceptFiles,allowedExtensions:a.validation.allowedExtensions,element:a.element,folders:a.folders,multiple:a.multiple,
title:a.fileInputTitle});this._extraButtonSpecs[b.getButtonId()]=a},_initFormSupportAndParams:function(){(this._formSupport=b.FormSupport&&new b.FormSupport(this._options.form,b.bind(this.uploadStoredFiles,this),b.bind(this.log,this)))&&this._formSupport.attachedToForm?(this._paramsStore=this._createStore(this._options.request.params,this._formSupport.getFormInputsAsObject),this._options.autoUpload=this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&(this._options.request.endpoint=this._formSupport.newEndpoint)):
this._paramsStore=this._createStore(this._options.request.params)},_isDeletePossible:function(){return b.DeleteFileAjaxRequester&&this._options.deleteFile.enabled?this._options.cors.expected?b.supportedFeatures.deleteFileCorsXhr||b.supportedFeatures.deleteFileCorsXdr&&this._options.cors.allowXdr?!0:!1:!0:!1},_isAllowedExtension:function(a,c){var d=!1;if(!a.length)return!0;b.each(a,function(a,f){if(b.isString(f)&&null!=c.match(new RegExp("\\."+f+"$","i")))return d=!0,!1});return d},_itemError:function(a,
c,d){function e(a,b){f=f.replace(a,b)}var f=this._options.messages[a],g=[],h=[].concat(c);a=h[0];d=this._getButtonId(d);d=this._getValidationBase(d);b.each(d.allowedExtensions,function(a,c){b.isString(c)&&g.push(c)});c=g.join(", ").toLowerCase();e("{file}",this._options.formatFileName(a));e("{extensions}",c);e("{sizeLimit}",this._formatSize(d.sizeLimit));e("{minSizeLimit}",this._formatSize(d.minSizeLimit));d=f.match(/(\{\w+\})/g);null!==d&&b.each(d,function(a,b){e(b,h[a])});this._options.callbacks.onError(null,
a,f,void 0);return f},_manualRetry:function(a,c){if(this._onBeforeManualRetry(a))return this._netUploadedOrQueued++,this._uploadData.setStatus(a,b.status.UPLOAD_RETRYING),c?c(a):this._handler.retry(a),!0},_maybeAllComplete:function(a,c){var d=this,e=this._getNotFinished();c===b.status.UPLOAD_SUCCESSFUL?this._succeededSinceLastAllComplete.push(a):c===b.status.UPLOAD_FAILED&&this._failedSinceLastAllComplete.push(a);0===e&&(this._succeededSinceLastAllComplete.length||this._failedSinceLastAllComplete.length)&&
setTimeout(function(){d._onAllComplete(d._succeededSinceLastAllComplete,d._failedSinceLastAllComplete)},0)},_maybeHandleIos8SafariWorkaround:function(){var a=this;if(this._options.workarounds.ios8SafariUploads&&b.ios800()&&b.iosSafari())throw setTimeout(function(){window.alert(a._options.messages.unsupportedBrowserIos8Safari)},0),new b.Error(this._options.messages.unsupportedBrowserIos8Safari);},_maybeParseAndSendUploadError:function(a,b,d,e){if(!d.success)if(e&&200!==e.status&&!d.error)this._options.callbacks.onError(a,
b,"XHR returned response code "+e.status,e);else this._options.callbacks.onError(a,b,d.error?d.error:this._options.text.defaultResponseError,e)},_maybeProcessNextItemAfterOnValidateCallback:function(a,c,d,e,f){var g=this;if(c.length>d)if(a||!this._options.validation.stopOnFirstInvalidFile)setTimeout(function(){var a=g._getValidationDescriptor(c[d]),k=g._getButtonId(c[d].file),k=g._getButton(k);g._handleCheckedCallback({name:"onValidate",callback:b.bind(g._options.callbacks.onValidate,g,a,k),onSuccess:b.bind(g._onValidateCallbackSuccess,
g,c,d,e,f),onFailure:b.bind(g._onValidateCallbackFailure,g,c,d,e,f),identifier:"Item '"+a.name+"', size: "+a.size})},0);else if(!a)for(;d<c.length;d++)g._fileOrBlobRejected(c[d].id)},_onAllComplete:function(a,c){this._totalProgress&&this._totalProgress.onAllComplete(a,c,this._preventRetries);this._options.callbacks.onAllComplete(b.extend([],a),b.extend([],c));this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[]},_onAutoRetry:function(a,c,d,e,f){var g=this;g._preventRetries[a]=
d[g._options.retry.preventRetryResponseProperty];if(g._shouldAutoRetry(a,c,d)){var h=1E3*g._options.retry.autoAttemptDelay;g._maybeParseAndSendUploadError.apply(g,arguments);g._options.callbacks.onAutoRetry(a,c,g._autoRetries[a]);g._onBeforeAutoRetry(a,c);g._uploadData.setStatus(a,b.status.UPLOAD_RETRYING);g._retryTimeouts[a]=setTimeout(function(){g.log("Starting retry for "+c+"...");f?f(a):g._handler.retry(a)},h);return!0}},_onBeforeAutoRetry:function(a,b){this.log("Waiting "+this._options.retry.autoAttemptDelay+
" seconds before retrying "+b+"...")},_onBeforeManualRetry:function(a){var b=this._currentItemLimit,d;if(this._preventRetries[a])return this.log("Retries are forbidden for id "+a,"warn"),!1;if(this._handler.isValid(a)){d=this.getName(a);if(!1===this._options.callbacks.onManualRetry(a,d))return!1;if(0<b&&this._netUploadedOrQueued+1>b)return this._itemError("retryFailTooManyItems"),!1;this.log("Retrying upload for '"+d+"' (id: "+a+")...");return!0}this.log("'"+a+"' is not a valid file ID","error");
return!1},_onCancel:function(a,c){this._netUploadedOrQueued--;clearTimeout(this._retryTimeouts[a]);var d=b.indexOf(this._storedIds,a);!this._options.autoUpload&&0<=d&&this._storedIds.splice(d,1);this._uploadData.setStatus(a,b.status.CANCELED)},_onComplete:function(a,c,d,e){d.success?(d.thumbnailUrl&&(this._thumbnailUrls[a]=d.thumbnailUrl),this._netUploaded++,this._uploadData.setStatus(a,b.status.UPLOAD_SUCCESSFUL)):(this._netUploadedOrQueued--,this._uploadData.setStatus(a,b.status.UPLOAD_FAILED),
!0===d[this._options.retry.preventRetryResponseProperty]&&(this._preventRetries[a]=!0));this._maybeParseAndSendUploadError(a,c,d,e);return d.success?!0:!1},_onDelete:function(a){this._uploadData.setStatus(a,b.status.DELETING)},_onDeleteComplete:function(a,c,d){var e=this.getName(a);if(d)if(this._uploadData.setStatus(a,b.status.DELETE_FAILED),this.log("Delete request for '"+e+"' has failed.","error"),void 0===c.withCredentials)this._options.callbacks.onError(a,e,"Delete request failed",c);else this._options.callbacks.onError(a,
e,"Delete request failed with response code "+c.status,c);else this._netUploadedOrQueued--,this._netUploaded--,this._handler.expunge(a),this._uploadData.setStatus(a,b.status.DELETED),this.log("Delete request for '"+e+"' has succeeded.")},_onInputChange:function(a){var c;if(b.supportedFeatures.ajaxUploading){for(c=0;c<a.files.length;c++)this._annotateWithButtonId(a.files[c],a);this.addFiles(a.files)}else 0<a.value.length&&this.addFiles(a);b.each(this._buttons,function(a,b){b.reset()})},_onProgress:function(a,
b,d,e){this._totalProgress&&this._totalProgress.onIndividualProgress(a,d,e)},_onSubmit:function(a,b){},_onSubmitCallbackSuccess:function(a,c){this._onSubmit.apply(this,arguments);this._uploadData.setStatus(a,b.status.SUBMITTED);this._onSubmitted.apply(this,arguments);this._options.autoUpload?(this._options.callbacks.onSubmitted.apply(this,arguments),this._uploadFile(a)):(this._storeForLater(a),this._options.callbacks.onSubmitted.apply(this,arguments))},_onSubmitDelete:function(a,c,d){var e=this.getUuid(a),
f;c&&(f=b.bind(c,this,a,e,d));if(this._isDeletePossible())return this._handleCheckedCallback({name:"onSubmitDelete",callback:b.bind(this._options.callbacks.onSubmitDelete,this,a),onSuccess:f||b.bind(this._deleteHandler.sendDelete,this,a,e,d),identifier:a}),!0;this.log("Delete request ignored for ID "+a+", delete feature is disabled or request not possible due to CORS on a user agent that does not support pre-flighting.","warn");return!1},_onSubmitted:function(a){},_onTotalProgress:function(a,b){this._options.callbacks.onTotalProgress(a,
b)},_onUploadPrep:function(a){},_onUpload:function(a,c){this._uploadData.setStatus(a,b.status.UPLOADING)},_onUploadChunk:function(a,b){},_onUploadStatusChange:function(a,c,d){d===b.status.PAUSED&&clearTimeout(this._retryTimeouts[a])},_onValidateBatchCallbackFailure:function(a){var c=this;b.each(a,function(a,b){c._fileOrBlobRejected(b.id)})},_onValidateBatchCallbackSuccess:function(a,c,d,e,f){var g=this._currentItemLimit,h=this._netUploadedOrQueued;0===g||h<=g?0<c.length?this._handleCheckedCallback({name:"onValidate",
callback:b.bind(this._options.callbacks.onValidate,this,a[0],f),onSuccess:b.bind(this._onValidateCallbackSuccess,this,c,0,d,e),onFailure:b.bind(this._onValidateCallbackFailure,this,c,0,d,e),identifier:"Item '"+c[0].file.name+"', size: "+c[0].file.size}):this._itemError("noFilesError"):(this._onValidateBatchCallbackFailure(c),a=this._options.messages.tooManyItemsError.replace(/\{netItems\}/g,h).replace(/\{itemLimit\}/g,g),this._batchError(a))},_onValidateCallbackFailure:function(a,b,d,e){var f=b+1;
this._fileOrBlobRejected(a[b].id,a[b].file.name);this._maybeProcessNextItemAfterOnValidateCallback(!1,a,f,d,e)},_onValidateCallbackSuccess:function(a,b,d,e){var f=this,g=b+1,h=this._getValidationDescriptor(a[b]);this._validateFileOrBlobData(a[b],h).then(function(){f._upload(a[b].id,d,e);f._maybeProcessNextItemAfterOnValidateCallback(!0,a,g,d,e)},function(){f._maybeProcessNextItemAfterOnValidateCallback(!1,a,g,d,e)})},_prepareItemsForUpload:function(a,c,d){if(0===a.length)this._itemError("noFilesError");
else{var e=this._getValidationDescriptors(a),f=this._getButtonId(a[0].file),f=this._getButton(f);this._handleCheckedCallback({name:"onValidateBatch",callback:b.bind(this._options.callbacks.onValidateBatch,this,e,f),onSuccess:b.bind(this._onValidateBatchCallbackSuccess,this,e,a,c,d,f),onFailure:b.bind(this._onValidateBatchCallbackFailure,this,a),identifier:"batch validation"})}},_preventLeaveInProgress:function(){var a=this;this._disposeSupport.attach(window,"beforeunload",function(b){if(a.getInProgress())return b=
b||window.event,b.returnValue=a._options.messages.onLeave})},_refreshSessionData:function(){var a=this,c=this._options.session;b.Session&&null!=this._options.session.endpoint&&(this._session||(b.extend(c,{cors:this._options.cors}),c.log=b.bind(this.log,this),c.addFileRecord=b.bind(this._addCannedFile,this),this._session=new b.Session(c)),setTimeout(function(){a._session.refresh().then(function(b,c){a._sessionRequestComplete();a._options.callbacks.onSessionRequestComplete(b,!0,c)},function(b,c){a._options.callbacks.onSessionRequestComplete(b,
!1,c)})},0))},_sessionRequestComplete:function(){},_setSize:function(a,b){this._uploadData.updateSize(a,b);this._totalProgress&&this._totalProgress.onNewSize(a)},_shouldAutoRetry:function(a,c,d){c=this._uploadData.retrieve({id:a});return!this._preventRetries[a]&&this._options.retry.enableAuto&&c.status!==b.status.PAUSED&&(void 0===this._autoRetries[a]&&(this._autoRetries[a]=0),this._autoRetries[a]<this._options.retry.maxAutoAttempts)?(this._autoRetries[a]+=1,!0):!1},_storeForLater:function(a){this._storedIds.push(a)},
_trackButton:function(a){var c;(c=b.supportedFeatures.ajaxUploading?this._handler.getFile(a).qqButtonId:this._getButtonId(this._handler.getInput(a)))&&(this._buttonIdsForFileIds[a]=c)},_updateFormSupportAndParams:function(a){this._options.form.element=a;(this._formSupport=b.FormSupport&&new b.FormSupport(this._options.form,b.bind(this.uploadStoredFiles,this),b.bind(this.log,this)))&&this._formSupport.attachedToForm&&(this._paramsStore.addReadOnly(null,this._formSupport.getFormInputsAsObject),this._options.autoUpload=
this._formSupport.newAutoUpload,this._formSupport.newEndpoint&&this.setEndpoint(this._formSupport.newEndpoint))},_upload:function(a,c,d){var e=this.getName(a);c&&this.setParams(c,a);d&&this.setEndpoint(d,a);this._handleCheckedCallback({name:"onSubmit",callback:b.bind(this._options.callbacks.onSubmit,this,a,e),onSuccess:b.bind(this._onSubmitCallbackSuccess,this,a,e),onFailure:b.bind(this._fileOrBlobRejected,this,a,e),identifier:a})},_uploadFile:function(a){this._handler.upload(a)||this._uploadData.setStatus(a,
b.status.QUEUED)},_uploadStoredFiles:function(){for(var a,c=this;this._storedIds.length;)a=this._storedIds.shift(),this._uploadFile(a);if(a=this.getUploads({status:b.status.SUBMITTING}).length)b.log("Still waiting for "+a+" files to clear submit queue. Will re-parse stored IDs array shortly."),setTimeout(function(){c._uploadStoredFiles()},1E3)},_validateFileOrBlobData:function(a,c){var d=this,e;e=a.file instanceof b.BlobProxy?a.file.referenceBlob:a.file;var f=c.name,g=c.size,h=this._getButtonId(a.file),
h=this._getValidationBase(h),k=new b.Promise;k.then(function(){},function(){d._fileOrBlobRejected(a.id,f)});if(b.isFileOrInput(e)&&!this._isAllowedExtension(h.allowedExtensions,f))return this._itemError("typeError",f,e),k.failure();if(0===g)return this._itemError("emptyError",f,e),k.failure();if(0<g&&h.sizeLimit&&g>h.sizeLimit)return this._itemError("sizeError",f,e),k.failure();if(0<g&&g<h.minSizeLimit)return this._itemError("minSizeError",f,e),k.failure();b.ImageValidation&&b.supportedFeatures.imagePreviews&&
b.isFile(e)?(new b.ImageValidation(e,b.bind(d.log,d))).validate(h.image).then(k.success,function(a){d._itemError(a+"ImageError",f,e);k.failure()}):k.success();return k},_wrapCallbacks:function(){var a,b,d;a=this;b=function(b,c,d){try{return c.apply(a,d)}catch(h){c=h.message||h.toString(),a.log("Caught exception in '"+b+"' callback - "+c,"error")}};for(d in this._options.callbacks)(function(){var e,f;e=d;f=a._options.callbacks[e];a._options.callbacks[e]=function(){return b(e,f,arguments)}})()}}})();
(function(){b.FineUploaderBasic=function(a){var c=this;this._options={debug:!1,button:null,multiple:!0,maxConnections:3,disableCancelForFormUploads:!1,autoUpload:!0,request:{customHeaders:{},endpoint:"/server/upload",filenameParam:"qqfilename",forceMultipart:!0,inputName:"qqfile",method:"POST",params:{},paramsInBody:!0,totalFileSizeName:"qqtotalfilesize",uuidName:"qquuid"},validation:{allowedExtensions:[],sizeLimit:0,minSizeLimit:0,itemLimit:0,stopOnFirstInvalidFile:!0,acceptFiles:null,image:{maxHeight:0,
maxWidth:0,minHeight:0,minWidth:0}},callbacks:{onSubmit:function(a,b){},onSubmitted:function(a,b){},onComplete:function(a,b,c,g){},onAllComplete:function(a,b){},onCancel:function(a,b){},onUpload:function(a,b){},onUploadChunk:function(a,b,c){},onUploadChunkSuccess:function(a,b,c,g){},onResume:function(a,b,c){},onProgress:function(a,b,c,g){},onTotalProgress:function(a,b){},onError:function(a,b,c,g){},onAutoRetry:function(a,b,c){},onManualRetry:function(a,b){},onValidateBatch:function(a){},onValidate:function(a){},
onSubmitDelete:function(a){},onDelete:function(a){},onDeleteComplete:function(a,b,c){},onPasteReceived:function(a){},onStatusChange:function(a,b,c){},onSessionRequestComplete:function(a,b,c){}},messages:{typeError:"{file} has an invalid extension. Valid extension(s): {extensions}.",sizeError:"{file} is too large, maximum file size is {sizeLimit}.",minSizeError:"{file} is too small, minimum file size is {minSizeLimit}.",emptyError:"{file} is empty, please select files again without it.",noFilesError:"No files to upload.",
tooManyItemsError:"Too many items ({netItems}) would be uploaded.  Item limit is {itemLimit}.",maxHeightImageError:"Image is too tall.",maxWidthImageError:"Image is too wide.",minHeightImageError:"Image is not tall enough.",minWidthImageError:"Image is not wide enough.",retryFailTooManyItems:"Retry failed - you have reached your file limit.",onLeave:"The files are being uploaded, if you leave now the upload will be canceled.",unsupportedBrowserIos8Safari:"Unrecoverable error - this browser does not permit file uploading of any kind due to serious bugs in iOS8 Safari.  Please use iOS8 Chrome until Apple fixes these issues."},
retry:{enableAuto:!1,maxAutoAttempts:3,autoAttemptDelay:5,preventRetryResponseProperty:"preventRetry"},classes:{buttonHover:"qq-upload-button-hover",buttonFocus:"qq-upload-button-focus"},chunking:{enabled:!1,concurrent:{enabled:!1},mandatory:!1,paramNames:{partIndex:"qqpartindex",partByteOffset:"qqpartbyteoffset",chunkSize:"qqchunksize",totalFileSize:"qqtotalfilesize",totalParts:"qqtotalparts"},partSize:2E6,success:{endpoint:null}},resume:{enabled:!1,recordsExpireIn:7,paramNames:{resuming:"qqresume"}},
formatFileName:function(a){return a},text:{defaultResponseError:"Upload failure reason unknown",fileInputTitle:"file input",sizeSymbols:"kB MB GB TB PB EB".split(" ")},deleteFile:{enabled:!1,method:"DELETE",endpoint:"/server/upload",customHeaders:{},params:{}},cors:{expected:!1,sendCredentials:!1,allowXdr:!1},blobs:{defaultName:"misc_data"},paste:{targetElement:null,defaultName:"pasted_image"},camera:{ios:!1,button:null},extraButtons:[],session:{endpoint:null,params:{},customHeaders:{},refreshOnReset:!0},
form:{element:"qq-form",autoUpload:!1,interceptSubmit:!0},scaling:{customResizer:null,sendOriginal:!0,orient:!0,defaultType:null,defaultQuality:80,failureText:"Failed to scale",includeExif:!1,sizes:[]},workarounds:{iosEmptyVideos:!0,ios8SafariUploads:!0,ios8BrowserCrash:!1}};b.extend(this._options,a,!0);this._buttons=[];this._extraButtonSpecs={};this._buttonIdsForFileIds=[];this._wrapCallbacks();this._disposeSupport=new b.DisposeSupport;this._storedIds=[];this._autoRetries=[];this._retryTimeouts=
[];this._preventRetries=[];this._thumbnailUrls=[];this._netUploaded=this._netUploadedOrQueued=0;this._uploadData=this._createUploadDataTracker();this._initFormSupportAndParams();this._customHeadersStore=this._createStore(this._options.request.customHeaders);this._deleteFileCustomHeadersStore=this._createStore(this._options.deleteFile.customHeaders);this._deleteFileParamsStore=this._createStore(this._options.deleteFile.params);this._endpointStore=this._createStore(this._options.request.endpoint);this._deleteFileEndpointStore=
this._createStore(this._options.deleteFile.endpoint);this._handler=this._createUploadHandler();this._deleteHandler=b.DeleteFileAjaxRequester&&this._createDeleteHandler();this._options.button&&(this._defaultButtonId=this._createUploadButton({element:this._options.button,title:this._options.text.fileInputTitle}).getButtonId());this._generateExtraButtonSpecs();this._handleCameraAccess();this._options.paste.targetElement&&(b.PasteSupport?this._pasteHandler=this._createPasteHandler():this.log("Paste support module not found",
"error"));this._preventLeaveInProgress();this._imageGenerator=b.ImageGenerator&&new b.ImageGenerator(b.bind(this.log,this));this._refreshSessionData();this._succeededSinceLastAllComplete=[];this._failedSinceLastAllComplete=[];this._scaler=b.Scaler&&new b.Scaler(this._options.scaling,b.bind(this.log,this))||{};this._scaler.enabled&&(this._customNewFileHandler=b.bind(this._scaler.handleNewFile,this._scaler));b.TotalProgress&&b.supportedFeatures.progressBar&&(this._totalProgress=new b.TotalProgress(b.bind(this._onTotalProgress,
this),function(a){return(a=c._uploadData.retrieve({id:a}))&&a.size||0}));this._currentItemLimit=this._options.validation.itemLimit};b.FineUploaderBasic.prototype=b.basePublicApi;b.extend(b.FineUploaderBasic.prototype,b.basePrivateApi)})();b.AjaxRequester=function(a){function c(a){var c=!1;b.each(c,function(a,d){if(0>b.indexOf(["Accept","Accept-Language","Content-Language","Content-Type"],d))return c=!0,!1});return c}function d(a){return t.cors.expected&&void 0===a.withCredentials}function e(){var a;
if(window.XMLHttpRequest||window.ActiveXObject)a=b.createXhrInstance(),void 0===a.withCredentials&&(a=new XDomainRequest,a.onload=function(){},a.onerror=function(){},a.ontimeout=function(){},a.onprogress=function(){});return a}function f(a,c){var d=x[a].xhr;d||(d=c?c:t.cors.expected?e():b.createXhrInstance(),x[a].xhr=d);return d}function g(a){var c=b.indexOf(v,a),d=t.maxConnections;delete x[a];v.splice(c,1);v.length>=d&&c<d&&(a=v[d-1],l(a))}function h(a,c){var e=f(a),r=t.method,h=!0===c;g(a);h?y(r+
" request for "+a+" has failed","error"):d(e)||0<=b.indexOf(t.successfulResponseCodes[t.method],e.status)||(h=!0,y(r+" request for "+a+" has failed - response code "+e.status,"error"));t.onComplete(a,e,h)}function k(a){var c=x[a].additionalParams,d=t.mandatedParams,e;t.paramsStore.get&&(e=t.paramsStore.get(a));c&&b.each(c,function(a,b){e=e||{};e[a]=b});d&&b.each(d,function(a,b){e=e||{};e[a]=b});return e}function l(a,c){var e=f(a,c),g=t.method,h=k(a),l=x[a].payload,v;t.onSend(a);v=x[a].additionalQueryParams;
var u=t.endpointStore.get(a),F=x[a].addToPath;void 0!=F&&(u+="/"+F);w&&h&&(u=b.obj2url(h,u));v&&(u=b.obj2url(v,u));v=u;d(e)?(e.onload=q(a),e.onerror=p(a)):e.onreadystatechange=m(a);n(a);e.open(g,v,!0);t.cors.expected&&t.cors.sendCredentials&&!d(e)&&(e.withCredentials=!0);r(a);y("Sending "+g+" request for "+a);l?e.send(l):w||!h?e.send():h&&t.contentType&&0<=t.contentType.toLowerCase().indexOf("application/x-www-form-urlencoded")?e.send(b.obj2url(h,"")):h&&t.contentType&&0<=t.contentType.toLowerCase().indexOf("application/json")?
e.send(JSON.stringify(h)):e.send(h);return e}function m(a){return function(){4===f(a).readyState&&h(a)}}function n(a){var b=t.onProgress;b&&(f(a).upload.onprogress=function(c){c.lengthComputable&&b(a,c.loaded,c.total)})}function q(a){return function(){h(a)}}function p(a){return function(){h(a,!0)}}function r(a){var e=f(a),g=t.customHeaders,r=x[a].additionalHeaders||{},h=t.method,k={};d(e)||(t.acceptHeader&&e.setRequestHeader("Accept",t.acceptHeader),!t.allowXRequestedWithAndCacheControl||t.cors.expected&&
0<=b.indexOf(["GET","POST","HEAD"],t.method)&&!c(g)||(e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.setRequestHeader("Cache-Control","no-cache")),!t.contentType||"POST"!==h&&"PUT"!==h||e.setRequestHeader("Content-Type",t.contentType),b.extend(k,b.isFunction(g)?g(a):g),b.extend(k,r),b.each(k,function(a,b){e.setRequestHeader(a,b)}))}var y,w,v=[],x={},t={acceptHeader:null,validMethods:["PATCH","POST","PUT"],method:"POST",contentType:"application/x-www-form-urlencoded",maxConnections:3,customHeaders:{},
endpointStore:{},paramsStore:{},mandatedParams:{},allowXRequestedWithAndCacheControl:!0,successfulResponseCodes:{DELETE:[200,202,204],PATCH:[200,201,202,203,204],POST:[200,201,202,203,204],PUT:[200,201,202,203,204],GET:[200]},cors:{expected:!1,sendCredentials:!1},log:function(a,b){},onSend:function(a){},onComplete:function(a,b,c){},onProgress:null};b.extend(t,a);y=t.log;if(0>b.indexOf(t.validMethods,t.method))throw Error("'"+t.method+"' is not a supported method for this type of request!");w="GET"===
t.method||"DELETE"===t.method;b.extend(this,{initTransport:function(a){var c,d,e,f,g,r;return{withPath:function(a){c=a;return this},withParams:function(a){d=a;return this},withQueryParams:function(a){r=a;return this},withHeaders:function(a){e=a;return this},withPayload:function(a){f=a;return this},withCacheBuster:function(){g=!0;return this},send:function(h){g&&0<=b.indexOf(["GET","DELETE"],t.method)&&(d.qqtimestamp=(new Date).getTime());x[a]={addToPath:c,additionalParams:d,additionalQueryParams:r,
additionalHeaders:e,payload:f};h=v.push(a)<=t.maxConnections?l(a,h):void 0;return h}}},canceled:function(a){g(a)}})};b.UploadHandler=function(a){a=a.proxy;var c={},d=a.onCancel,e=a.getName;b.extend(this,{add:function(a,b){c[a]=b;c[a].temp={}},cancel:function(a){var g=this,h=new b.Promise;d(a,e(a),h).then(function(){g.isValid(a)&&(c[a].canceled=!0,g.expunge(a));h.success()})},expunge:function(a){delete c[a]},getThirdPartyFileId:function(a){return c[a].key},isValid:function(a){return void 0!==c[a]},
reset:function(){c={}},_getFileState:function(a){return c[a]},_setThirdPartyFileId:function(a,b){c[a].key=b},_wasCanceled:function(a){return!!c[a].canceled}})};b.UploadHandlerController=function(a,c){var d=this,e=!1,f=!1,g,h,k,l={paramsStore:{},maxConnections:3,chunking:{enabled:!1,multiple:{enabled:!1}},log:function(a,b){},onProgress:function(a,b,c,d){},onComplete:function(a,b,c,d){},onCancel:function(a,b){},onUploadPrep:function(a){},onUpload:function(a,b){},onUploadChunk:function(a,b,c){},onUploadChunkSuccess:function(a,
b,c,d){},onAutoRetry:function(a,b,c,d){},onResume:function(a,b,c){},onUuidChanged:function(a,b){},getName:function(a){},setSize:function(a,b){},isQueued:function(a){},getIdsInProxyGroup:function(a){},getIdsInBatch:function(a){}},m={done:function(a,b,c,d){var e=k._getChunkData(a,b);k._getFileState(a).attemptingResume=!1;delete k._getFileState(a).temp.chunkProgress[b];k._getFileState(a).loaded+=e.size;l.onUploadChunkSuccess(a,k._getChunkDataForCallback(e),c,d)},finalize:function(a){var b=l.getSize(a),
c=l.getName(a);h("All chunks have been uploaded for "+a+" - finalizing....");k.finalizeChunks(a).then(function(d,e){h("Finalize successful for "+a);var f=p.normalizeResponse(d,!0);l.onProgress(a,c,b,b);k._maybeDeletePersistedChunkData(a);p.cleanup(a,f,e)},function(b,d){var e=p.normalizeResponse(b,!1);h("Problem finalizing chunks for file ID "+a+" - "+e.error,"error");e.reset&&m.reset(a);l.onAutoRetry(a,c,e,d)||p.cleanup(a,e,d)})},handleFailure:function(a,c,d,e){var g=l.getName(c);h("Chunked upload request failed for "+
c+", chunk "+a);k.clearCachedChunk(c,a);d=p.normalizeResponse(d,!1);var q;d.reset?m.reset(c):(q=b.indexOf(k._getFileState(c).chunking.inProgress,a),0<=q&&(k._getFileState(c).chunking.inProgress.splice(q,1),k._getFileState(c).chunking.remaining.unshift(a)));k._getFileState(c).temp.ignoreFailure||(f&&(k._getFileState(c).temp.ignoreFailure=!0,h(b.format("Going to attempt to abort these chunks: {}. These are currently in-progress: {}.",JSON.stringify(Object.keys(k._getXhrs(c))),JSON.stringify(k._getFileState(c).chunking.inProgress))),
b.each(k._getXhrs(c),function(a,d){h(b.format("Attempting to abort file {}.{}. XHR readyState {}. ",c,a,d.readyState));d.abort();d._cancelled=!0}),k.moveInProgressToRemaining(c),n.free(c,!0)),l.onAutoRetry(c,g,d,e)||p.cleanup(c,d,e))},hasMoreParts:function(a){return!!k._getFileState(a).chunking.remaining.length},nextPart:function(a){var b=k._getFileState(a).chunking.remaining.shift();b>=k._getTotalChunks(a)&&(b=null);return b},reset:function(a){h("Server or callback has ordered chunking effort to be restarted on next attempt for item ID "+
a,"error");k._maybeDeletePersistedChunkData(a);k.reevaluateChunking(a);k._getFileState(a).loaded=0},sendNext:function(a){var c=l.getSize(a),d=l.getName(a),e=m.nextPart(a),g=k._getChunkData(a,e),q=k._getFileState(a).attemptingResume,C=k._getFileState(a).chunking.inProgress||[];null==k._getFileState(a).loaded&&(k._getFileState(a).loaded=0);q&&!1===l.onResume(a,d,g)&&(m.reset(a),e=m.nextPart(a),g=k._getChunkData(a,e),q=!1);null==e&&0===C.length?m.finalize(a):(h(b.format("Sending chunked upload request for item {}.{}, bytes {}-{} of {}.",
a,e,g.start+1,g.end,c)),l.onUploadChunk(a,d,k._getChunkDataForCallback(g)),C.push(e),k._getFileState(a).chunking.inProgress=C,f&&n.open(a,e),f&&n.available()&&k._getFileState(a).chunking.remaining.length&&m.sendNext(a),0===g.blob.size?(h(b.format("Chunk {} for file {} will not be uploaded, zero sized chunk.",e,a),"error"),m.handleFailure(e,a,"File is no longer available",null)):k.uploadChunk(a,e,q).then(function(c,d){h("Chunked upload request succeeded for "+a+", chunk "+e);k.clearCachedChunk(a,e);
var f=k._getFileState(a).chunking.inProgress||[],g=p.normalizeResponse(c,!0),x=b.indexOf(f,e);h(b.format("Chunk {} for file {} uploaded successfully.",e,a));m.done(a,e,g,d);0<=x&&f.splice(x,1);k._maybePersistChunkedState(a);m.hasMoreParts(a)||0!==f.length?m.hasMoreParts(a)?m.sendNext(a):h(b.format("File ID {} has no more chunks to send and these chunk indexes are still marked as in-progress: {}",a,JSON.stringify(f))):m.finalize(a)},function(b,c){m.handleFailure(e,a,b,c)}).done(function(){k.clearXhr(a,
e)}))}},n={_open:[],_openChunks:{},_waiting:[],available:function(){var a=l.maxConnections,c=0,d=0;b.each(n._openChunks,function(a,b){c++;d+=b.length});return a-(n._open.length-c+d)},free:function(a,c){var d=!c,e=b.indexOf(n._waiting,a),f=b.indexOf(n._open,a);delete n._openChunks[a];p.getProxyOrBlob(a)instanceof b.BlobProxy&&(h("Generated blob upload has ended for "+a+", disposing generated blob."),delete k._getFileState(a).file);0<=e?n._waiting.splice(e,1):d&&0<=f&&(n._open.splice(f,1),d=n._waiting.shift(),
0<=d&&(n._open.push(d),p.start(d)))},getWaitingOrConnected:function(){var a=[];b.each(n._openChunks,function(b,c){c&&c.length&&a.push(parseInt(b))});b.each(n._open,function(b,c){n._openChunks[c]||a.push(parseInt(c))});return a=a.concat(n._waiting)},isUsingConnection:function(a){return 0<=b.indexOf(n._open,a)},open:function(a,b){null==b&&n._waiting.push(a);if(n.available()){if(null==b)n._waiting.pop(),n._open.push(a);else{var c=n._openChunks[a]||[];c.push(b);n._openChunks[a]=c}return!0}return!1},reset:function(){n._waiting=
[];n._open=[]}},q={send:function(a,b){k._getFileState(a).loaded=0;h("Sending simple upload request for "+a);k.uploadFile(a).then(function(c,d){h("Simple upload request succeeded for "+a);var e=p.normalizeResponse(c,!0),f=l.getSize(a);l.onProgress(a,b,f,f);p.maybeNewUuid(a,e);p.cleanup(a,e,d)},function(c,d){h("Simple upload request failed for "+a);var e=p.normalizeResponse(c,!1);l.onAutoRetry(a,b,e,d)||p.cleanup(a,e,d)})}},p={cancel:function(a){h("Cancelling "+a);l.paramsStore.remove(a);n.free(a)},
cleanup:function(a,b,c){var d=l.getName(a);l.onComplete(a,d,b,c);k._getFileState(a)&&k._clearXhrs&&k._clearXhrs(a);n.free(a)},getProxyOrBlob:function(a){return k.getProxy&&k.getProxy(a)||k.getFile&&k.getFile(a)},initHandler:function(){k=new (c?b[c]:b.traditional)[(b.supportedFeatures.ajaxUploading?"Xhr":"Form")+"UploadHandler"](l,{getDataByUuid:l.getDataByUuid,getName:l.getName,getSize:l.getSize,getUuid:l.getUuid,log:h,onCancel:l.onCancel,onProgress:l.onProgress,onUuidChanged:l.onUuidChanged});k._removeExpiredChunkingRecords&&
k._removeExpiredChunkingRecords()},isDeferredEligibleForUpload:function(a){return l.isQueued(a)},maybeDefer:function(a,c){if(c&&!k.getFile(a)&&c instanceof b.BlobProxy)l.onUploadPrep(a),h("Attempting to generate a blob on-demand for "+a),c.create().then(function(b){h("Generated an on-demand blob for "+a);k.updateBlob(a,b);l.setSize(a,b.size);k.reevaluateChunking(a);p.maybeSendDeferredFiles(a)},function(c){var d={};c&&(d.error=c);h(b.format("Failed to generate blob for ID {}.  Error message: {}.",
a,c),"error");l.onComplete(a,l.getName(a),b.extend(d,g),null);p.maybeSendDeferredFiles(a);n.free(a)});else return p.maybeSendDeferredFiles(a);return!1},maybeSendDeferredFiles:function(a){var c=l.getIdsInProxyGroup(a),d=!1;c&&c.length?(h("Maybe ready to upload proxy group file "+a),b.each(c,function(b,c){if(p.isDeferredEligibleForUpload(c)&&k.getFile(c))d=c===a,p.now(c);else if(p.isDeferredEligibleForUpload(c))return!1})):(d=!0,p.now(a));return d},maybeNewUuid:function(a,b){if(void 0!==b.newUuid)l.onUuidChanged(a,
b.newUuid)},normalizeResponse:function(a,c){var d=a;b.isObject(a)||(d={},b.isString(a)&&!c&&(d.error=a));d.success=c;return d},now:function(a){var c=l.getName(a);if(!d.isValid(a))throw new b.Error(a+" is not a valid file ID to upload!");l.onUpload(a,c);e&&k._shouldChunkThisFile(a)?m.sendNext(a):q.send(a,c)},start:function(a){var b=p.getProxyOrBlob(a);if(b)return p.maybeDefer(a,b);p.now(a);return!0}};b.extend(this,{add:function(a,b){k.add.apply(this,arguments)},upload:function(a){return n.open(a)?
p.start(a):!1},retry:function(a){f&&(k._getFileState(a).temp.ignoreFailure=!1);return n.isUsingConnection(a)?p.start(a):d.upload(a)},cancel:function(a){var c=k.cancel(a);b.isGenericPromise(c)?c.then(function(){p.cancel(a)}):!1!==c&&p.cancel(a)},cancelAll:function(){var a=n.getWaitingOrConnected(),b;if(a.length)for(b=a.length-1;0<=b;b--)d.cancel(a[b]);n.reset()},getFile:function(a){return k.getProxy&&k.getProxy(a)?k.getProxy(a).referenceBlob:k.getFile&&k.getFile(a)},isProxied:function(a){return!(!k.getProxy||
!k.getProxy(a))},getInput:function(a){if(k.getInput)return k.getInput(a)},reset:function(){h("Resetting upload handler");d.cancelAll();n.reset();k.reset()},expunge:function(a){if(d.isValid(a))return k.expunge(a)},isValid:function(a){return k.isValid(a)},getResumableFilesData:function(){return k.getResumableFilesData?k.getResumableFilesData():[]},getThirdPartyFileId:function(a){if(d.isValid(a))return k.getThirdPartyFileId(a)},pause:function(a){return d.isResumable(a)&&k.pause&&d.isValid(a)&&k.pause(a)?
(n.free(a),k.moveInProgressToRemaining(a),!0):!1},isResumable:function(a){return!!k.isResumable&&k.isResumable(a)}});b.extend(l,a);h=l.log;f=(e=l.chunking.enabled&&b.supportedFeatures.chunking)&&l.chunking.concurrent.enabled;g=function(){var a={};a[l.preventRetryParam]=!0;return a}();p.initHandler()};b.WindowReceiveMessage=function(a){var c={};b.extend({log:function(a,b){}},a);b.extend(this,{receiveMessage:function(a,e){var f=function(a){e(a.data)};window.postMessage?c[a]=b(window).attach("message",
f):log("iframe message passing not supported in this browser!","error")},stopReceivingMessages:function(a){window.postMessage&&(a=c[a])&&a()}})};b.FormUploadHandler=function(a){function c(a,c){var d=a.id,f=d.split("_")[0],g=q(f);h[g]=c;k[f]=b(a).attach("load",function(){e.getInput(f)&&(p("Received iframe load event for CORS upload request (iframe name "+d+")"),l[d]=setTimeout(function(){var a="No valid message received from loaded iframe for iframe name "+d;p(a,"error");c({error:a})},1E3))});r.receiveMessage(d,
function(a){p("Received the following window message: '"+a+"'");d.split("_");var b=e._parseJsonResponse(a),c=b.uuid;c&&h[c]?(p("Handling response for iframe name "+d),clearTimeout(l[d]),delete l[d],e._detachLoadEvent(d),a=h[c],delete h[c],r.stopReceivingMessages(d),a(b)):c||p("'"+a+"' does not contain a UUID - ignoring.")})}var d=a.options,e=this,f=a.proxy,g=b.getUniqueId(),h={},k={},l={},m=d.isCors,n=d.inputName,q=f.getUuid,p=f.log,r=new b.WindowReceiveMessage({log:p});b.extend(this,new b.UploadHandler(a));
b.override(this,function(a){return{add:function(c,d){a.add(c,{input:d});d.setAttribute("name",n);d.parentNode&&b(d).remove()},expunge:function(c){delete k[c];m&&(clearTimeout(l[c]),delete l[c],r.stopReceivingMessages(c));var d=document.getElementById(e._getIframeName(c));d&&(d.setAttribute("src","javascript:false;"),b(d).remove());a.expunge(c)},isValid:function(b){return a.isValid(b)&&void 0!==e._getFileState(b).input}}});b.extend(this,{getInput:function(a){return e._getFileState(a).input},_attachLoadEvent:function(a,
d){var e;m?c(a,d):k[a.id]=b(a).attach("load",function(){p("Received response for "+a.id);if(a.parentNode){try{if(a.contentDocument&&a.contentDocument.body&&"false"==a.contentDocument.body.innerHTML)return}catch(b){p("Error when attempting to access iframe during handling of upload response ("+b.message+")","error"),e={success:!1}}d(e)}})},_createIframe:function(a){a=e._getIframeName(a);var c=b.toElement("<iframe src='javascript:false;' name='"+a+"' />");c.setAttribute("id",a);c.style.display="none";
document.body.appendChild(c);return c},_detachLoadEvent:function(a){void 0!==k[a]&&(k[a](),delete k[a])},_getIframeName:function(a){return a+"_"+g},_initFormForUpload:function(a){var c=a.endpoint,d=a.params,e=a.paramsInBody,f=a.targetName;a=b.toElement("<form method='"+a.method+"' enctype='multipart/form-data'></form>");var g=c;e?b.obj2Inputs(d,a):g=b.obj2url(d,c);a.setAttribute("action",g);a.setAttribute("target",f);a.style.display="none";document.body.appendChild(a);return a},_parseJsonResponse:function(a){var c=
{};try{c=b.parseJson(a)}catch(d){p("Error when attempting to parse iframe upload response ("+d.message+")","error")}return c}})};b.XhrUploadHandler=function(a){function c(a){b.each(d._getXhrs(a),function(b,c){var e=d._getAjaxRequester(a,b);c.onreadystatechange=null;c.upload.onprogress=null;c.abort();e&&e.canceled&&e.canceled(a)})}var d=this,e=a.options.namespace,f=a.proxy,g=a.options.chunking,h=a.options.resume,k=g&&a.options.chunking.enabled&&b.supportedFeatures.chunking,l=h&&a.options.resume.enabled&&
k&&b.supportedFeatures.resume,m=f.getName,n=f.getSize,q=f.getUuid,p=f.getEndpoint,r=f.getDataByUuid,y=f.onUuidChanged,w=f.onProgress,v=f.log;b.extend(this,new b.UploadHandler(a));b.override(this,function(a){return{add:function(c,e){if(b.isFile(e)||b.isBlob(e))a.add(c,{file:e});else if(e instanceof b.BlobProxy)a.add(c,{proxy:e});else throw Error("Passed obj is not a File, Blob, or proxy");d._initTempState(c);l&&d._maybePrepareForResume(c)},expunge:function(b){c(b);d._maybeDeletePersistedChunkData(b);
d._clearXhrs(b);a.expunge(b)}}});b.extend(this,{clearCachedChunk:function(a,b){delete d._getFileState(a).temp.cachedChunks[b]},clearXhr:function(a,b){var c=d._getFileState(a).temp;c.xhrs&&delete c.xhrs[b];c.ajaxRequesters&&delete c.ajaxRequesters[b]},finalizeChunks:function(a,c){var e=d._getTotalChunks(a)-1,e=d._getXhr(a,e);return c?(new b.Promise).success(c(e),e):(new b.Promise).success({},e)},getFile:function(a){return d.isValid(a)&&d._getFileState(a).file},getProxy:function(a){return d.isValid(a)&&
d._getFileState(a).proxy},getResumableFilesData:function(){var a=[];d._iterateResumeRecords(function(b,c){d.moveInProgressToRemaining(null,c.chunking.inProgress,c.chunking.remaining);var e={name:c.name,remaining:c.chunking.remaining,size:c.size,uuid:c.uuid};c.key&&(e.key=c.key);a.push(e)});return a},isResumable:function(a){return!!g&&d.isValid(a)&&!d._getFileState(a).notResumable},moveInProgressToRemaining:function(a,c,e){c=c||d._getFileState(a).chunking.inProgress;var f=e||d._getFileState(a).chunking.remaining;
c&&(v(b.format("Moving these chunks from in-progress {}, to remaining.",JSON.stringify(c))),c.reverse(),b.each(c,function(a,b){f.unshift(b)}),c.length=0)},pause:function(a){if(d.isValid(a))return v(b.format("Aborting XHR upload for {} '{}' due to pause instruction.",a,m(a))),d._getFileState(a).paused=!0,c(a),!0},reevaluateChunking:function(a){if(g&&d.isValid(a)){var b=d._getFileState(a),c,e;delete b.chunking;b.chunking={};c=d._getTotalChunks(a);if(1<c||g.mandatory){b.chunking.enabled=!0;b.chunking.parts=
c;b.chunking.remaining=[];for(e=0;e<c;e++)b.chunking.remaining.push(e);d._initTempState(a)}else b.chunking.enabled=!1}},updateBlob:function(a,b){d.isValid(a)&&(d._getFileState(a).file=b)},_clearXhrs:function(a){var c=d._getFileState(a).temp;b.each(c.ajaxRequesters,function(a){delete c.ajaxRequesters[a]});b.each(c.xhrs,function(a){delete c.xhrs[a]})},_createXhr:function(a,c){return d._registerXhr(a,c,b.createXhrInstance())},_getAjaxRequester:function(a,b){var c=null==b?-1:b;return d._getFileState(a).temp.ajaxRequesters[c]},
_getChunkData:function(a,c){var e=g.partSize,f=n(a),h=d.getFile(a),k=e*c,e=k+e>=f?f:k+e,f=d._getTotalChunks(a),l=this._getFileState(a).temp.cachedChunks,h=l[c]||b.sliceBlob(h,k,e);l[c]=h;return{part:c,start:k,end:e,count:f,blob:h,size:e-k}},_getChunkDataForCallback:function(a){return{partIndex:a.part,startByte:a.start+1,endByte:a.end,totalParts:a.count}},_getLocalStorageId:function(a){var c=m(a),d=n(a),f=g.partSize;a=p(a);return b.format("qq{}resume{}-{}-{}-{}-{}",e,"5.0",c,d,f,a)},_getMimeType:function(a){return d.getFile(a).type},
_getPersistableData:function(a){return d._getFileState(a).chunking},_getTotalChunks:function(a){if(g)return a=n(a),Math.ceil(a/g.partSize)},_getXhr:function(a,b){var c=null==b?-1:b;return d._getFileState(a).temp.xhrs[c]},_getXhrs:function(a){return d._getFileState(a).temp.xhrs},_iterateResumeRecords:function(a){l&&b.each(localStorage,function(c,d){if(0===c.indexOf(b.format("qq{}resume",e))){var f=JSON.parse(d);a(c,f)}})},_initTempState:function(a){d._getFileState(a).temp={ajaxRequesters:{},chunkProgress:{},
xhrs:{},cachedChunks:{}}},_markNotResumable:function(a){d._getFileState(a).notResumable=!0},_maybeDeletePersistedChunkData:function(a){return l&&d.isResumable(a)&&(a=d._getLocalStorageId(a))&&localStorage.getItem(a)?(localStorage.removeItem(a),!0):!1},_maybePrepareForResume:function(a){var c=d._getFileState(a),e;l&&void 0===c.key&&(e=d._getLocalStorageId(a),e=localStorage.getItem(e))&&(e=JSON.parse(e),r(e.uuid)?d._markNotResumable(a):(v(b.format("Identified file with ID {} and name of {} as resumable.",
a,m(a))),y(a,e.uuid),c.key=e.key,c.chunking=e.chunking,c.loaded=e.loaded,c.attemptingResume=!0,d.moveInProgressToRemaining(a)))},_maybePersistChunkedState:function(a){var c=d._getFileState(a),e;if(l&&d.isResumable(a)){e=d._getLocalStorageId(a);c={name:m(a),size:n(a),uuid:q(a),key:c.key,chunking:c.chunking,loaded:c.loaded,lastUpdated:Date.now()};try{localStorage.setItem(e,JSON.stringify(c))}catch(f){v(b.format("Unable to save resume data for '{}' due to error: '{}'.",a,f.toString()),"warn")}}},_registerProgressHandler:function(a,
c,e){var f=d._getXhr(a,c),g=m(a),h={simple:function(b,c){var d=n(a);b===c?w(a,g,d,d):w(a,g,b>=d?d-1:b,d)},chunked:function(f,h){var k=d._getFileState(a).temp.chunkProgress,l=d._getFileState(a).loaded,q=n(a),p=l;k[c]=f-(h-e);b.each(k,function(a,b){p+=b});w(a,g,p,q)}};f.upload.onprogress=function(a){if(a.lengthComputable)h[null==e?"simple":"chunked"](a.loaded,a.total)}},_registerXhr:function(a,b,c,e){b=null==b?-1:b;a=d._getFileState(a).temp;a.xhrs=a.xhrs||{};a.ajaxRequesters=a.ajaxRequesters||{};a.xhrs[b]=
c;e&&(a.ajaxRequesters[b]=e);return c},_removeExpiredChunkingRecords:function(){var a=h.recordsExpireIn;d._iterateResumeRecords(function(b,c){var d=new Date(c.lastUpdated);d.setDate(d.getDate()+a);d.getTime()<=Date.now()&&(v("Removing expired resume record with key "+b),localStorage.removeItem(b))})},_shouldChunkThisFile:function(a){var b=d._getFileState(a);b.chunking||d.reevaluateChunking(a);return b.chunking.enabled}})};b.DeleteFileAjaxRequester=function(a){var c,d={method:"DELETE",uuidParamName:"qquuid",
endpointStore:{},maxConnections:3,customHeaders:function(a){return{}},paramsStore:{},cors:{expected:!1,sendCredentials:!1},log:function(a,b){},onDelete:function(a){},onDeleteComplete:function(a,b,c){}};b.extend(d,a);c=b.extend(this,new b.AjaxRequester({acceptHeader:"application/json",validMethods:["POST","DELETE"],method:d.method,endpointStore:d.endpointStore,paramsStore:d.paramsStore,mandatedParams:"POST"===d.method.toUpperCase()?{_method:"DELETE"}:{},maxConnections:d.maxConnections,customHeaders:function(a){return d.customHeaders.get(a)},
log:d.log,onSend:d.onDelete,onComplete:d.onDeleteComplete,cors:d.cors}));b.extend(this,{sendDelete:function(a,b,g){g=g||{};d.log("Submitting delete file request for "+a);"DELETE"===d.method?c.initTransport(a).withPath(b).withParams(g).send():(g[d.uuidParamName]=b,c.initTransport(a).withParams(g).send())}})};(function(){function a(a,d,e,f){var m=document.createElement("canvas"),n=e.mime||"image/jpeg",q=new b.Promise;c(a,d,m,e,f).then(function(){q.success(m.toDataURL(n,e.quality||.8))});return q}function c(a,
c,f,l,m){var n=a.naturalWidth,q=a.naturalHeight,p=l.width,r=l.height,y=f.getContext("2d"),w=new b.Promise;y.save();if(l.resize)return d({blob:c,canvas:f,image:a,imageHeight:q,imageWidth:n,orientation:l.orientation,resize:l.resize,targetHeight:r,targetWidth:p});if(!b.supportedFeatures.unlimitedScaledImageSize){c=p;var v=r;if(!b.ios())throw new b.Error("Downsampled dimensions can only be reliably calculated for iOS!");c=5241E3<v*c?{newHeight:Math.round(Math.sqrt(v/c*5241E3)),newWidth:Math.round(Math.sqrt(c/
v*5241E3))}:void 0;c&&(b.log(b.format("Had to reduce dimensions due to device limitations from {}w / {}h to {}w / {}h",p,r,c.newWidth,c.newHeight),"warn"),p=c.newWidth,r=c.newHeight)}e(f,p,r,l.orientation);if(b.ios()){l=a.naturalWidth;c=a.naturalHeight;v=document.createElement("canvas");1048576<l*c?(v.width=v.height=1,c=v.getContext("2d"),c.drawImage(a,-l+1,0),l=0===c.getImageData(0,0,1,1).data[3]):l=!1;l&&(n/=2,q/=2);l=document.createElement("canvas");if(m){m=q;var x=document.createElement("canvas");
c=0;var t=v=m,C;x.width=1;x.height=m;x=x.getContext("2d");x.drawImage(a,0,0);for(x=x.getImageData(0,0,1,m).data;t>c;)C=x[4*(t-1)+3],0===C?v=t:c=t,t=v+c>>1;m=t/m;m=0===m?1:m}else m=1;p=Math.ceil(1024*p/n);r=Math.ceil(1024*r/q/m);c=m=0;l.width=l.height=1024;for(v=l.getContext("2d");m<q;){for(x=t=0;t<n;)v.clearRect(0,0,1024,1024),v.drawImage(a,-t,-m),y.drawImage(l,0,0,1024,1024,x,c,p,r),t+=1024,x+=p;m+=1024;c+=r}y.restore()}else y.drawImage(a,0,0,p,r);f.qqImageRendered&&f.qqImageRendered();w.success();
return w}function d(a){var c=a.blob,d=a.image,f=a.imageHeight,m=a.imageWidth,n=a.orientation,q=new b.Promise,p=a.resize,r=document.createElement("canvas"),y=r.getContext("2d"),w=a.canvas,v=a.targetHeight;a=a.targetWidth;e(r,m,f,n);w.height=v;w.width=a;y.drawImage(d,0,0);p({blob:c,height:v,image:d,sourceCanvas:r,targetCanvas:w,width:a}).then(function(){w.qqImageRendered&&w.qqImageRendered();q.success()},q.failure);return q}function e(a,b,c,d){switch(d){case 5:case 6:case 7:case 8:a.width=c;a.height=
b;break;default:a.width=b,a.height=c}a=a.getContext("2d");switch(d){case 2:a.translate(b,0);a.scale(-1,1);break;case 3:a.translate(b,c);a.rotate(Math.PI);break;case 4:a.translate(0,c);a.scale(1,-1);break;case 5:a.rotate(.5*Math.PI);a.scale(1,-1);break;case 6:a.rotate(.5*Math.PI);a.translate(0,-c);break;case 7:a.rotate(.5*Math.PI);a.translate(b,-c);a.scale(-1,1);break;case 8:a.rotate(-.5*Math.PI),a.translate(-b,0)}}function f(a,b){var c=this;window.Blob&&a instanceof Blob&&function(){var b=new Image,
d=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;if(!d)throw Error("No createObjectURL function found to create blob url");b.src=d.createObjectURL(a);c.blob=a;a=b}();a.naturalWidth||a.naturalHeight||(a.onload=function(){var a=c.imageLoadListeners;a&&(c.imageLoadListeners=null,setTimeout(function(){for(var b=0,c=a.length;b<c;b++)a[b]()},0))},a.onerror=b,this.imageLoadListeners=[]);this.srcImage=a}f.prototype.render=function(d,
e){e=e||{};var f=this,l=this.srcImage.naturalWidth,m=this.srcImage.naturalHeight,n=e.width,q=e.height,p=e.maxWidth,r=e.maxHeight,y=!this.blob||"image/jpeg"===this.blob.type,w=d.tagName.toLowerCase(),v;if(this.imageLoadListeners)this.imageLoadListeners.push(function(){f.render(d,e)});else if(n&&!q?q=m*n/l<<0:q&&!n?n=l*q/m<<0:(n=l,q=m),p&&n>p&&(n=p,q=m*n/l<<0),r&&q>r&&(q=r,n=l*q/m<<0),v={width:n,height:q},b.each(e,function(a,b){v[a]=b}),"img"===w?function(){var b=d.src;a(f.srcImage,f.blob,v,y).then(function(a){d.src=
a;b===d.src&&d.onload()})}():"canvas"===w&&c(this.srcImage,this.blob,d,v,y),"function"===typeof this.onrender)this.onrender(d)};b.MegaPixImage=f})();b.ImageGenerator=function(a){function c(a){return"img"===a.tagName.toLowerCase()}function d(a){return"canvas"===a.tagName.toLowerCase()}function e(a){a=a.split("/");a=a[a.length-1].split("?")[0];a=(a=b.getExtension(a))&&a.toLowerCase();switch(a){case "jpeg":case "jpg":return"image/jpeg";case "png":return"image/png";case "bmp":return"image/bmp";case "gif":return"image/gif";
case "tiff":case "tif":return"image/tiff"}}function f(a){var c=document.createElement("a"),d;c.href=a;a=c.protocol;d=c.port;c=c.hostname;return a.toLowerCase()!==window.location.protocol.toLowerCase()||c.toLowerCase()!==window.location.hostname.toLowerCase()||d!==window.location.port&&!b.ie()?!0:!1}function g(b,c){b.onload=function(){b.onload=null;b.onerror=null;c.success(b)};b.onerror=function(){b.onload=null;b.onerror=null;a("Problem drawing thumbnail!","error");c.failure(b,"Problem drawing thumbnail!")}}
function h(a,b){a.qqImageRendered=function(){b.success(a)}}function k(e,f){var k=c(e)||d(e);c(e)?g(e,f):d(e)?h(e,f):(f.failure(e),a(b.format("Element container of type {} is not supported!",e.tagName),"error"));return k}function l(c,d,e){var f=new b.Promise,g=new b.Identify(c,a),h=e.maxSize,l=null==e.orient?!0:e.orient,n=function(){d.onerror=null;d.onload=null;a("Could not render preview, file may be too large!","error");f.failure(d,"Browser cannot render image!")};g.isPreviewable().then(function(g){var m=
{parse:function(){return(new b.Promise).success()}},m=l?new b.Exif(c,a):m,w=new b.MegaPixImage(c,n);k(d,f)&&m.parse().then(function(a){w.render(d,{maxWidth:h,maxHeight:h,orientation:a&&a.Orientation,mime:g,resize:e.customResizeFunction})},function(c){a(b.format("EXIF data could not be parsed ({}).  Assuming orientation = 1.",c));w.render(d,{maxWidth:h,maxHeight:h,mime:g,resize:e.customResizeFunction})})},function(){a("Not previewable");f.failure(d,"Not previewable")});return f}function m(a,c,d,g,
h){var l=new Image,n=new b.Promise;k(l,n);f(a)&&(l.crossOrigin="anonymous");l.src=a;n.then(function(){k(c,d);(new b.MegaPixImage(l)).render(c,{maxWidth:g,maxHeight:g,mime:e(a),resize:h})},d.failure)}function n(a,c,d,e){k(c,d);b(c).css({maxWidth:e+"px",maxHeight:e+"px"});c.src=a}b.extend(this,{generate:function(e,g,h){if(b.isString(e)){a("Attempting to update thumbnail based on server response.");var y=h||{};h=new b.Promise;var w=y.scale,y=w?y.maxSize:null;w&&c(g)?(w=document.createElement("canvas"),
w.getContext&&w.getContext("2d")?f(e)&&void 0===(new Image).crossOrigin?n(e,g,h,y):m(e,g,h,y):n(e,g,h,y)):d(g)?m(e,g,h,y):k(g,h)&&(g.src=e);return h}a("Attempting to draw client-side image preview.");return l(e,g,h||{})}});this._testing={};this._testing.isImg=c;this._testing.isCanvas=d;this._testing.isCrossOrigin=f;this._testing.determineMimeOfFileName=e};b.Exif=function(a,c){function d(a){for(var b=0,c=0;0<a.length;)b+=parseInt(a.substring(0,2),16)*Math.pow(2,c),a=a.substring(2,a.length),c+=8;return b}
function e(c,d){var f=c,g=d;void 0===f&&(f=2,g=new b.Promise);b.readBlobToHex(a,f,4).then(function(a){var b=/^ffe([0-9])/.exec(a);b?"1"!==b[1]?(a=parseInt(a.slice(4,8),16),e(f+a+2,g)):g.success(f):g.failure("No EXIF header to be found!")});return g}function f(){var c=new b.Promise;b.readBlobToHex(a,0,6).then(function(a){0!==a.indexOf("ffd8")?c.failure("Not a valid JPEG!"):e().then(function(a){c.success(a)},function(a){c.failure(a)})});return c}function g(c){var d=new b.Promise;b.readBlobToHex(a,c+
10,2).then(function(a){d.success("4949"===a)});return d}function h(c,e){var f=new b.Promise;b.readBlobToHex(a,c+18,2).then(function(a){if(e)return f.success(d(a));f.success(parseInt(a,16))});return f}function k(a,c){var e=b.extend([],l),f={};b.each(c,function(b,c){var g=c.slice(0,4),h=a?d(g):parseInt(g,16),g=e.indexOf(h),k;0<=g&&(k=m[h].name,h=m[h].bytes,h=c.slice(16,16+2*h),f[k]=a?d(h):parseInt(h,16),e.splice(g,1));if(0===e.length)return!1});return f}var l=[274],m={274:{name:"Orientation",bytes:2}};
b.extend(this,{parse:function(){var d=new b.Promise,e=function(a){c(b.format("EXIF header parse failed: '{}' ",a));d.failure(a)};f().then(function(f){c(b.format("Moving forward with EXIF header parsing for '{}'",void 0===a.name?"blob":a.name));g(f).then(function(g){c(b.format("EXIF Byte order is {} endian",g?"little":"big"));h(f,g).then(function(h){c(b.format("Found {} APP1 directory entries",h));b.readBlobToHex(a,f+20,12*h).then(function(a){for(var b=[],e=0;e+24<=a.length;)b.push(a.slice(e,e+24)),
e+=24;a=k(g,b);c("Successfully parsed some EXIF tags");d.success(a)},e)},e)},e)},e);return d}});this._testing={};this._testing.parseLittleEndian=d};b.Identify=function(a,c){function d(a,c){var d=!1,h=[].concat(a);b.each(h,function(a,b){if(0===c.indexOf(b))return d=!0,!1});return d}b.extend(this,{isPreviewable:function(){var e=this,f=new b.Promise,g=!1,h=void 0===a.name?"blob":a.name;c(b.format("Attempting to determine if {} can be rendered in this browser",h));c("First pass: check type attribute of blob object.");
this.isPreviewableSync()?(c("Second pass: check for magic bytes in file header."),b.readBlobToHex(a,0,4).then(function(a){b.each(e.PREVIEWABLE_MIME_TYPES,function(c,e){if(d(e,a)){if("image/tiff"!==c||b.supportedFeatures.tiffPreviews)g=!0,f.success(c);return!1}});c(b.format("'{}' is {} able to be rendered in this browser",h,g?"":"NOT"));g||f.failure()},function(){c("Error reading file w/ name '"+h+"'.  Not able to be rendered in this browser.");f.failure()})):f.failure();return f},isPreviewableSync:function(){var d=
a.type,f=0<=b.indexOf(Object.keys(this.PREVIEWABLE_MIME_TYPES),d),g=!1,h=void 0===a.name?"blob":a.name;f&&(g="image/tiff"===d?b.supportedFeatures.tiffPreviews:!0);!g&&c(h+" is not previewable in this browser per the blob's type attr");return g}})};b.Identify.prototype.PREVIEWABLE_MIME_TYPES={"image/jpeg":"ffd8ff","image/gif":"474946","image/png":"89504e","image/bmp":"424d","image/tiff":["49492a00","4d4d002a"]};b.ImageValidation=function(a,c){function d(a){var c=!1;b.each(a,function(a,b){if(0<b)return c=
!0,!1});return c}function e(){var d=new b.Promise;(new b.Identify(a,c)).isPreviewable().then(function(){var b=new Image,e=window.URL&&window.URL.createObjectURL?window.URL:window.webkitURL&&window.webkitURL.createObjectURL?window.webkitURL:null;e?(b.onerror=function(){c("Cannot determine dimensions for image.  May be too large.","error");d.failure()},b.onload=function(){d.success({width:this.width,height:this.height})},b.src=e.createObjectURL(a)):(c("No createObjectURL function available to generate image URL!",
"error"),d.failure())},d.failure);return d}function f(a,c){var d;b.each(a,function(a,b){if(0<b){var e=/(max|min)(Width|Height)/.exec(a),f=e[2].charAt(0).toLowerCase()+e[2].slice(1),f=c[f];switch(e[1]){case "min":if(f<b)return d=a,!1;break;case "max":if(f>b)return d=a,!1}}});return d}this.validate=function(a){var h=new b.Promise;c("Attempting to validate image.");d(a)?e().then(function(b){(b=f(a,b))?h.failure(b):h.success()},h.success):h.success();return h}};b.Session=function(a){function c(a,c,g,
h){var k=!1;c&&(b.isArray(a)?c=!0:(d.log("Session response is not an array.","error"),c=void 0));c&&b.each(a,function(a,c){if(null==c.uuid)k=!0,d.log(b.format("Session response item {} did not include a valid UUID - ignoring.",a),"error");else if(null==c.name)k=!0,d.log(b.format("Session response item {} did not include a valid name - ignoring.",a),"error");else try{return d.addFileRecord(c),!0}catch(e){k=!0,d.log(e.message,"error")}return!1});h[c&&!k?"success":"failure"](a,g)}var d={endpoint:null,
params:{},customHeaders:{},cors:{},addFileRecord:function(a){},log:function(a,b){}};b.extend(d,a,!0);this.refresh=function(){var a=new b.Promise,f=b.extend({},d);(new b.SessionAjaxRequester(b.extend(f,{onComplete:function(b,d,f){c(b,d,f,a)}}))).queryServer();return a}};b.SessionAjaxRequester=function(a){var c,d={endpoint:null,customHeaders:{},params:{},cors:{expected:!1,sendCredentials:!1},onComplete:function(a,b,c){},log:function(a,b){}};b.extend(d,a);c=b.extend(this,new b.AjaxRequester({acceptHeader:"application/json",
validMethods:["GET"],method:"GET",endpointStore:{get:function(){return d.endpoint}},customHeaders:d.customHeaders,log:d.log,onComplete:function(a,c,g){a=null;if(null!=c.responseText)try{a=b.parseJson(c.responseText)}catch(h){d.log("Problem parsing session response: "+h.message,"error"),g=!0}d.onComplete(a,!g,c)},cors:d.cors}));b.extend(this,{queryServer:function(){var a=b.extend({},d.params);d.log("Session query request.");c.initTransport("sessionRefresh").withParams(a).withCacheBuster().send()}})};
b.Scaler=function(a,c){var d=a.customResizer,e=a.sendOriginal,f=a.orient,g=a.defaultType,h=a.defaultQuality/100,k=a.failureText,l=a.includeExif,m=this._getSortedSizes(a.sizes);b.extend(this,{enabled:b.supportedFeatures.scaling&&0<m.length,getFileRecords:function(a,q,p){var r=this,y=[],w=p.blob?p.blob:p;(new b.Identify(w,c)).isPreviewableSync()?(b.each(m,function(a,e){var m=r._determineOutputType({defaultType:g,requestedType:e.type,refType:w.type});y.push({uuid:b.getUniqueId(),name:r._getName(q,{name:e.name,
type:m,refType:w.type}),blob:new b.BlobProxy(w,b.bind(r._generateScaledImage,r,{customResizeFunction:d,maxSize:e.maxSize,orient:f,type:m,quality:h,failedText:k,includeExif:l,log:c}))})}),y.push({uuid:a,name:q,size:w.size,blob:e?w:null})):y.push({uuid:a,name:q,size:w.size,blob:w});return y},handleNewFile:function(a,c,d,e,f,g,h,k){var l=[],m=null,H=k.addFileToHandler,E=k.uploadData,I=k.paramsStore,D=b.getUniqueId();b.each(this.getFileRecords(d,c,a),function(a,c){var d=c.size;c.blob instanceof b.BlobProxy&&
(d=-1);d=E.addFile({uuid:c.uuid,name:c.name,size:d,batchId:g,proxyGroupId:D});c.blob instanceof b.BlobProxy?l.push(d):m=d;c.blob?(H(d,c.blob),f.push({id:d,file:c.blob})):E.setStatus(d,b.status.REJECTED)});null!==m&&(b.each(l,function(a,b){var c={qqparentuuid:E.retrieve({id:m}).uuid,qqparentsize:E.retrieve({id:m}).size};c[h]=E.retrieve({id:b}).uuid;E.setParentId(b,m);I.addReadOnly(b,c)}),l.length&&function(){var a={};a[h]=E.retrieve({id:m}).uuid;I.addReadOnly(m,a)}())}})};b.extend(b.Scaler.prototype,
{scaleImage:function(a,c,d){if(!b.supportedFeatures.scaling)throw new b.Error("Scaling is not supported in this browser!");var e=new b.Promise,f=d.log,g=d.getFile(a),h=(d=d.uploadData.retrieve({id:a}))&&d.name,k=d&&d.uuid,l=new b.Scaler({customResizer:c.customResizer,sendOriginal:!1,orient:c.orient,defaultType:c.type||null,defaultQuality:c.quality,failedToScaleText:"Unable to scale",sizes:[{name:"",maxSize:c.maxSize}]},f);b.Scaler&&b.supportedFeatures.imagePreviews&&g?b.bind(function(){var c=l.getFileRecords(k,
h,g)[0];c&&c.blob instanceof b.BlobProxy?c.blob.create().then(e.success,e.failure):(f(a+" is not a scalable image!","error"),e.failure())},this)():(e.failure(),f("Could not generate requested scaled image for "+a+".  Scaling is either not possible in this browser, or the file could not be located.","error"));return e},_determineOutputType:function(a){var c=a.requestedType,d=a.defaultType;a=a.refType;return d||c?c?0<=b.indexOf(Object.keys(b.Identify.prototype.PREVIEWABLE_MIME_TYPES),c)?"image/tiff"===
c?b.supportedFeatures.tiffPreviews?c:d:c:d:d:"image/jpeg"!==a?"image/png":a},_getName:function(a,c){var d=a.lastIndexOf("."),e=c.type||"image/png",f=c.refType,g="",h=b.getExtension(a),k="";c.name&&c.name.trim().length&&(k=" ("+c.name+")");0<=d?(g=a.substr(0,d),f!==e&&(h=e.split("/")[1]),g+=k+"."+h):g=a+k;return g},_getSortedSizes:function(a){a=b.extend([],a);return a.sort(function(a,b){return a.maxSize>b.maxSize?1:a.maxSize<b.maxSize?-1:0})},_generateScaledImage:function(a,c){var d=this,e=a.customResizeFunction,
f=a.log,g=a.maxSize,h=a.orient,k=a.type,l=a.quality,m=a.failedText,n=a.includeExif&&"image/jpeg"===c.type&&"image/jpeg"===k,q=new b.Promise,p=new b.ImageGenerator(f),r=document.createElement("canvas");f("Attempting to generate scaled version for "+c.name);p.generate(c,r,{maxSize:g,orient:h,customResizeFunction:e}).then(function(){var a=r.toDataURL(k,l),e=function(){f("Success generating scaled version for "+c.name);var d=b.dataUriToBlob(a);q.success(d)};n?d._insertExifHeader(c,a,f).then(function(b){a=
b;e()},function(){f("Problem inserting EXIF header into scaled image.  Using scaled image w/out EXIF data.","error");e()}):e()},function(){f("Failed attempt to generate scaled version for "+c.name,"error");q.failure(m)});return q},_insertExifHeader:function(a,c,d){var e=new FileReader,f=new b.Promise,g="";e.onload=function(){g=e.result;f.success(b.ExifRestorer.restore(g,c))};e.onerror=function(){d("Problem reading "+a.name+" during attempt to transfer EXIF data to scaled version.","error");f.failure()};
e.readAsDataURL(a);return f},_dataUriToBlob:function(a){var c,d,e;c=0<=a.split(",")[0].indexOf("base64")?atob(a.split(",")[1]):decodeURI(a.split(",")[1]);a=a.split(",")[0].split(":")[1].split(";")[0];d=new ArrayBuffer(c.length);e=new Uint8Array(d);b.each(c,function(a,b){e[a]=b.charCodeAt(0)});return this._createBlob(d,a)},_createBlob:function(a,b){var d=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;return(d=d&&new d)?(d.append(a),d.getBlob(b)):new Blob([a],
{type:b})}});b.ExifRestorer=function(){return{KEY_STR:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode64:function(a){var b="",d,e,f="",g,h,k="",l=0;do d=a[l++],e=a[l++],f=a[l++],g=d>>2,d=(d&3)<<4|e>>4,h=(e&15)<<2|f>>6,k=f&63,isNaN(e)?h=k=64:isNaN(f)&&(k=64),b=b+this.KEY_STR.charAt(g)+this.KEY_STR.charAt(d)+this.KEY_STR.charAt(h)+this.KEY_STR.charAt(k);while(l<a.length);return b},restore:function(a,b){if(!a.match("data:image/jpeg;base64,"))return b;var d=this.decode64(a.replace("data:image/jpeg;base64,",
"")),d=this.slice2Segments(d),d=this.exifManipulation(b,d);return"data:image/jpeg;base64,"+this.encode64(d)},exifManipulation:function(a,b){var d=this.getExifArray(b),d=this.insertExif(a,d);return new Uint8Array(d)},getExifArray:function(a){for(var b,d=0;d<a.length;d++)if(b=a[d],255==b[0]&225==b[1])return b;return[]},insertExif:function(a,b){var d=a.replace("data:image/jpeg;base64,",""),e=this.decode64(d),f=e.indexOf(255,3),d=e.slice(0,f),e=e.slice(f),d=d.concat(b);return d=d.concat(e)},slice2Segments:function(a){for(var b=
0,d=[];!(255==a[b]&218==a[b+1]);){if(255==a[b]&216==a[b+1])b+=2;else{var e=b+(256*a[b+2]+a[b+3])+2,b=a.slice(b,e);d.push(b);b=e}if(b>a.length)break}return d},decode64:function(a){var b,d,e="",f,g="",h=0,k=[];if(/[^A-Za-z0-9\+\/\=]/g.exec(a))throw Error("There were invalid base64 characters in the input text.  Valid base64 characters are A-Z, a-z, 0-9, '+', '/',and '='");a=a.replace(/[^A-Za-z0-9\+\/\=]/g,"");do b=this.KEY_STR.indexOf(a.charAt(h++)),d=this.KEY_STR.indexOf(a.charAt(h++)),f=this.KEY_STR.indexOf(a.charAt(h++)),
g=this.KEY_STR.indexOf(a.charAt(h++)),b=b<<2|d>>4,d=(d&15)<<4|f>>2,e=(f&3)<<6|g,k.push(b),64!=f&&k.push(d),64!=g&&k.push(e);while(h<a.length);return k}}}();b.TotalProgress=function(a,c){var d={},e=0,f=0,g=-1,h=-1,k=function(b,c){b===g&&c===h||a(b,c);g=b;h=c},l=function(a,c){var d=!0;b.each(a,function(a,e){if(0<=b.indexOf(c,e))return d=!1});return d},m=function(a){var b=c(a);0<b&&(n(a,0,b),d[a]={loaded:0,total:b})},n=function(a,b,c){var g=d[a]?d[a].loaded:0;a=d[a]?d[a].total:0;-1===b&&-1===c?(e-=g,
f-=a):(b&&(e+=b-g),c&&(f+=c-a));k(e,f)};b.extend(this,{onAllComplete:function(a,b,c){if(0===b.length||l(b,c))k(f,f),this.reset()},onStatusChange:function(a,c,e){e===b.status.CANCELED||e===b.status.REJECTED?(n(a,-1,-1),delete d[a]):e===b.status.SUBMITTING&&m(a)},onIndividualProgress:function(a,b,c){n(a,b,c);d[a]={loaded:b,total:c}},onNewSize:function(a){m(a)},reset:function(){d={};f=e=0}})};b.PasteSupport=function(a){var c,d;c={targetElement:null,callbacks:{log:function(a,b){},pasteReceived:function(a){}}};
b.extend(c,a);(function(){d=b(c.targetElement).attach("paste",function(a){(a=a.clipboardData)&&b.each(a.items,function(a,b){if(b.type&&0===b.type.indexOf("image/")){var d=b.getAsFile();c.callbacks.pasteReceived(d)}})})})();b.extend(this,{reset:function(){d&&d()}})};b.FormSupport=function(a,c,d){function e(a,b){if(a.checkValidity&&!a.checkValidity())d("Form did not pass validation checks - will not upload.","error"),b();else return!0}function f(a){var d=a.submit;b(a).attach("submit",function(b){b=
b||window.event;b.preventDefault?b.preventDefault():b.returnValue=!1;e(a,d)&&c()});a.submit=function(){e(a,d)&&c()}}var g=this,h=a.interceptSubmit,k=a.element;b.extend(this,{newEndpoint:null,newAutoUpload:a.autoUpload,attachedToForm:!1,getFormInputsAsObject:function(){return null==k?null:g._form2Obj(k)}});k=function(a){if(a&&(b.isString(a)&&(a=document.getElementById(a)),a)){d("Attaching to form element.");var c=a;c.getAttribute("action")&&(g.newEndpoint=c.getAttribute("action"));h&&f(a)}return a}(k);
this.attachedToForm=!!k};b.extend(b.FormSupport.prototype,{_form2Obj:function(a){var c={},d=function(a){return 0<=b.indexOf(["checkbox","radio"],a.type.toLowerCase())&&!a.checked?!0:a.disabled&&"hidden"!==a.type.toLowerCase()},e=function(a){var c=null;b.each(b(a).children(),function(a,b){if("option"===b.tagName.toLowerCase()&&b.selected)return c=b.value,!1});return c};b.each(a.elements,function(a,g){var h;if(h=b.isInput(g,!0)||"textarea"===g.tagName.toLowerCase())h=0>b.indexOf(["button","image","reset",
"submit"],g.type.toLowerCase());h&&!d(g)?c[g.name]=g.value:"select"!==g.tagName.toLowerCase()||d(g)||(h=e(g),null!==h&&(c[g.name]=h))});return c}});b.traditional=b.traditional||{};b.traditional.FormUploadHandler=function(a,c){function d(b,c){var d=a.paramsStore.get(b),h="get"===a.method.toLowerCase()?"GET":"POST",q=a.endpointStore.get(b),p=f(b);d[a.uuidName]=g(b);d[a.filenameParam]=p;return e._initFormForUpload({method:h,endpoint:q,params:d,paramsInBody:a.paramsInBody,targetName:c.name})}var e=this,
f=c.getName,g=c.getUuid,h=c.log;this.uploadFile=function(c){var f=e.getInput(c),g=e._createIframe(c),n=new b.Promise,q;q=d(c,g);q.appendChild(f);e._attachLoadEvent(g,function(d){h("iframe loaded");if(!d){var f,l,q;try{l=g.contentDocument||g.contentWindow.document,q=l.body.innerHTML,h("converting iframe's innerHTML to JSON"),h("innerHTML = "+q),q&&q.match(/^<pre/i)&&(q=l.body.firstChild.firstChild.nodeValue),f=e._parseJsonResponse(q)}catch(v){h("Error when attempting to parse form upload response ("+
v.message+")","error"),f={success:!1}}d=f}e._detachLoadEvent(c);a.cors.expected||b(g).remove();d.success?n.success(d):n.failure(d)});h("Sending upload request for "+c);q.submit();b(q).remove();return n};b.extend(this,new b.FormUploadHandler({options:{isCors:a.cors.expected,inputName:a.inputName},proxy:{onCancel:a.onCancel,getName:f,getUuid:g,log:h}}))};b.traditional=b.traditional||{};b.traditional.XhrUploadHandler=function(a,c){var d=this,e=c.getName,f=c.getSize,g=c.getUuid,h=c.log,k=a.forceMultipart||
a.paramsInBody,l=new b.traditional.AllChunksDoneAjaxRequester({cors:a.cors,endpoint:a.chunking.success.endpoint,log:h}),m=function(a,c){var d=new b.Promise;c.onreadystatechange=function(){var e;if(4===c.readyState){var f;h("xhr - server response received for "+a);h("responseText = "+c.responseText);f=q(!0,c);(e=!(0>b.indexOf([200,201,202,203,204],c.status)||!f.success||f.reset))?d.success(f,c):d.failure(f,c)}};return d},n=function(b){var c=a.paramsStore.get(b),h=e(b),k=f(b);c[a.uuidName]=g(b);c[a.filenameParam]=
h;c[a.totalFileSizeName]=k;c[a.chunking.paramNames.totalParts]=d._getTotalChunks(b);return c},q=function(a,c){var d={};try{h(b.format("Received response status {} with body: {}",c.status,c.responseText)),d=b.parseJson(c.responseText)}catch(e){a&&h("Error when attempting to parse xhr response text ("+e.message+")","error")}return d},p=function(c){var e=new b.Promise;l.complete(c,d._createXhr(c),n(c),a.customHeaders.get(c)).then(function(a){e.success(q(!1,a),a)},function(a){e.failure(q(!1,a),a)});return e},
r=function(c,d,h,l){var m=new FormData,n=a.method,q=a.endpointStore.get(l),p=e(l),r=f(l);c[a.uuidName]=g(l);c[a.filenameParam]=p;k&&(c[a.totalFileSizeName]=r);a.paramsInBody||(k||(c[a.inputName]=p),q=b.obj2url(c,q));d.open(n,q,!0);a.cors.expected&&a.cors.sendCredentials&&(d.withCredentials=!0);return k?(a.paramsInBody&&b.obj2FormData(c,m),m.append(a.inputName,h),m):h},y=function(c,e){var f=a.customHeaders.get(c),g=d.getFile(c);e.setRequestHeader("Accept","application/json");e.setRequestHeader("X-Requested-With",
"XMLHttpRequest");e.setRequestHeader("Cache-Control","no-cache");k||(e.setRequestHeader("Content-Type","application/octet-stream"),e.setRequestHeader("X-Mime-Type",g.type));b.each(f,function(a,b){e.setRequestHeader(a,b)})};b.extend(this,{uploadChunk:function(b,c,g){var h=d._getChunkData(b,c),l=d._createXhr(b,c);f(b);var n;n=m(b,l);d._registerProgressHandler(b,c,h.size);c=a.paramsStore.get(b);var q=f(b),p=e(b);c[a.chunking.paramNames.partIndex]=h.part;c[a.chunking.paramNames.partByteOffset]=h.start;
c[a.chunking.paramNames.chunkSize]=h.size;c[a.chunking.paramNames.totalParts]=h.count;c[a.totalFileSizeName]=q;k&&(c[a.filenameParam]=p);g&&(c[a.resume.paramNames.resuming]=!0);g=r(c,l,h.blob,b);y(b,l);l.send(g);return n},uploadFile:function(b){var c=d.getFile(b),e,f,g;f=d._createXhr(b);d._registerProgressHandler(b);e=m(b,f);g=a.paramsStore.get(b);c=r(g,f,c,b);y(b,f);f.send(c);return e}});b.extend(this,new b.XhrUploadHandler({options:b.extend({namespace:"traditional"},a),proxy:b.extend({getEndpoint:a.endpointStore.get},
c)}));b.override(this,function(c){return{finalizeChunks:function(d){return a.chunking.success.endpoint?p(d):c.finalizeChunks(d,b.bind(q,this,!0))}}})};b.traditional.AllChunksDoneAjaxRequester=function(a){var c,d={cors:{allowXdr:!1,expected:!1,sendCredentials:!1},endpoint:null,log:function(a,b){}},e={};b.extend(d,a);c=b.extend(this,new b.AjaxRequester({acceptHeader:"application/json",validMethods:["POST"],method:"POST",endpointStore:{get:function(a){return d.endpoint}},allowXRequestedWithAndCacheControl:!1,
cors:d.cors,log:d.log,onComplete:function(a,b,c){var d=e[a];delete e[a];c?d.failure(b):d.success(b)}}));b.extend(this,{complete:function(a,g,h,k){var l=new b.Promise;d.log("Submitting All Chunks Done request for "+a);e[a]=l;c.initTransport(a).withParams(h).withHeaders(k).send(g);return l}})};b.DragAndDrop=function(a){function c(a){var e=new b.Promise;a.isFile?a.file(function(b){var c=a.fullPath,d=c.indexOf(a.name),c=c.substr(0,d);"/"===c.charAt(0)&&(c=c.substr(1));b.qqPath=c;l.push(b);e.success()},
function(b){h.callbacks.dropLog("Problem parsing '"+a.fullPath+"'.  FileError code "+b.code+".","error");e.failure()}):a.isDirectory&&d(a).then(function(a){var d=a.length;b.each(a,function(a,b){c(b).done(function(){--d;0===d&&e.success()})});a.length||e.success()},function(b){h.callbacks.dropLog("Problem parsing '"+a.fullPath+"'.  FileError code "+b.code+".","error");e.failure()});return e}function d(a,c,e,f){var g=f||new b.Promise,h=c||a.createReader();h.readEntries(function(b){var c=e?e.concat(b):
b;b.length?setTimeout(function(){d(a,h,c,g)},0):g.success(c)},g.failure);return g}function e(a,d){var e=[],f=new b.Promise;h.callbacks.processingDroppedFiles();d.dropDisabled(!0);1<a.files.length&&!h.allowMultipleItems?(h.callbacks.processingDroppedFilesComplete([]),h.callbacks.dropError("tooManyFilesError",""),d.dropDisabled(!1),f.failure()):(l=[],b.isFolderDropSupported(a)?b.each(a.items,function(a,b){var d=b.webkitGetAsEntry();d&&(d.isFile?l.push(b.getAsFile()):e.push(c(d).done(function(){e.pop();
0===e.length&&f.success()})))}):l=a.files,0===e.length&&f.success());return f}function f(a){var c=new b.UploadDropZone({HIDE_ZONES_EVENT_NAME:"qq-hidezones",element:a,onEnter:function(c){b(a).addClass(h.classes.dropActive);c.stopPropagation()},onLeaveNotDescendants:function(c){b(a).removeClass(h.classes.dropActive)},onDrop:function(a){e(a.dataTransfer,c).then(function(){var a=l,b=c,d=Array.prototype.slice.call(a);h.callbacks.dropLog("Grabbed "+a.length+" dropped files.");b.dropDisabled(!1);h.callbacks.processingDroppedFilesComplete(d,
b.getElement())},function(){h.callbacks.dropLog("Drop event DataTransfer parsing failed.  No files will be uploaded.","error")})}});m.addDisposer(function(){c.dispose()});b(a).hasAttribute("qq-hide-dropzone")&&b(a).hide();k.push(c);return c}function g(a){var c;b.each(a.dataTransfer.types,function(a,b){if("Files"===b)return c=!0,!1});return c}var h,k=[],l=[],m=new b.DisposeSupport;h={dropZoneElements:[],allowMultipleItems:!0,classes:{dropActive:null},callbacks:new b.DragAndDrop.callbacks};b.extend(h,
a,!0);(function(){var a=h.dropZoneElements,c=function(){setTimeout(function(){b.each(a,function(a,c){b(c).hasAttribute("qq-hide-dropzone")&&b(c).hide();b(c).removeClass(h.classes.dropActive)})},10)};b.each(a,function(c,d){var e=f(d);a.length&&b.supportedFeatures.fileDrop&&m.attach(document,"dragenter",function(c){!e.dropDisabled()&&g(c)&&b.each(a,function(a,c){c instanceof HTMLElement&&b(c).hasAttribute("qq-hide-dropzone")&&b(c).css({display:"block"})})})});m.attach(document,"dragleave",function(a){a=
b.firefox()?!a.relatedTarget:b.safari()?0>a.x||0>a.y:0===a.x&&0===a.y;a&&c()});m.attach(b(document).children()[0],"mouseenter",function(a){c()});m.attach(document,"drop",function(a){a.preventDefault();c()});m.attach(document,"qq-hidezones",c)})();b.extend(this,{setupExtraDropzone:function(a){h.dropZoneElements.push(a);f(a)},removeDropzone:function(a){var b,c=h.dropZoneElements;for(b in c)if(c[b]===a)return c.splice(b,1)},dispose:function(){m.dispose();b.each(k,function(a,b){b.dispose()})}})};b.DragAndDrop.callbacks=
function(){return{processingDroppedFiles:function(){},processingDroppedFilesComplete:function(a,b){},dropError:function(a,c){b.log("Drag & drop error code '"+a+" with these specifics: '"+c+"'","error")},dropLog:function(a,c){b.log(a,c)}}};b.UploadDropZone=function(a){function c(){return b.safari()||b.firefox()&&b.windows()}function d(a){if(!b.supportedFeatures.fileDrop)return!1;var c=a.dataTransfer,d=b.safari();a=b.ie()&&b.supportedFeatures.fileDrop?!0:"none"!==c.effectAllowed;return c&&a&&(c.files||
!d&&c.types.contains&&c.types.contains("Files"))}function e(a){void 0!==a&&(l=a);return l}function f(){function a(){b=document.createEvent("Event");b.initEvent(h.HIDE_ZONES_EVENT_NAME,!0,!0)}var b;if(window.CustomEvent)try{b=new CustomEvent(h.HIDE_ZONES_EVENT_NAME)}catch(c){a()}else a();document.dispatchEvent(b)}var g=new b.DisposeSupport,h,k,l,m;h={element:null,onEnter:function(a){},onLeave:function(a){},onLeaveNotDescendants:function(a){},onDrop:function(a){}};b.extend(h,a);k=h.element;(function(a){m||
(c?g.attach(document,"dragover",function(a){a.preventDefault()}):g.attach(document,"dragover",function(a){a.dataTransfer&&(a.dataTransfer.dropEffect="none",a.preventDefault())}),m=!0)})();(function(){g.attach(k,"dragover",function(a){if(d(a)){var c=b.ie()&&b.supportedFeatures.fileDrop?null:a.dataTransfer.effectAllowed;a.dataTransfer.dropEffect="move"===c||"linkMove"===c?"move":"copy";a.stopPropagation();a.preventDefault()}});g.attach(k,"dragenter",function(a){if(!e()&&d(a))h.onEnter(a)});g.attach(k,
"dragleave",function(a){if(d(a)){h.onLeave(a);var c=document.elementFromPoint(a.clientX,a.clientY);if(!b(this).contains(c))h.onLeaveNotDescendants(a)}});g.attach(k,"drop",function(a){!e()&&d(a)&&(a.preventDefault(),a.stopPropagation(),h.onDrop(a),f())})})();b.extend(this,{dropDisabled:function(a){return e(a)},dispose:function(){g.dispose()},getElement:function(){return k}})};(function(){b.uiPublicApi={addInitialFiles:function(a){this._parent.prototype.addInitialFiles.apply(this,arguments);this._templating.addCacheToDom()},
clearStoredFiles:function(){this._parent.prototype.clearStoredFiles.apply(this,arguments);this._templating.clearFiles()},addExtraDropzone:function(a){this._dnd&&this._dnd.setupExtraDropzone(a)},removeExtraDropzone:function(a){if(this._dnd)return this._dnd.removeDropzone(a)},getItemByFileId:function(a){if(!this._templating.isHiddenForever(a))return this._templating.getFileContainer(a)},reset:function(){this._parent.prototype.reset.apply(this,arguments);this._templating.reset();!this._options.button&&
this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId());this._dnd&&(this._dnd.dispose(),this._dnd=this._setupDragAndDrop());this._filesInBatchAddedToUi=this._totalFilesInBatch=0;this._setupClickAndEditEventHandlers()},setName:function(a,b){var d=this._options.formatFileName(b);this._parent.prototype.setName.apply(this,arguments);this._templating.updateFilename(a,d)},pauseUpload:function(a){var b=
this._parent.prototype.pauseUpload.apply(this,arguments);b&&this._templating.uploadPaused(a);return b},continueUpload:function(a){var b=this._parent.prototype.continueUpload.apply(this,arguments);b&&this._templating.uploadContinued(a);return b},getId:function(a){return this._templating.getFileId(a)},getDropTarget:function(a){return this.getFile(a).qqDropTarget}};b.uiPrivateApi={_getButton:function(a){var b=this._parent.prototype._getButton.apply(this,arguments);b||a===this._defaultButtonId&&(b=this._templating.getButton());
return b},_removeFileItem:function(a){this._templating.removeFile(a)},_setupClickAndEditEventHandlers:function(){this._fileButtonsClickHandler=b.FileButtonsClickHandler&&this._bindFileButtonsClickEvent();this._focusinEventSupported=!b.firefox();this._isEditFilenameEnabled()&&(this._filenameClickHandler=this._bindFilenameClickEvent(),this._filenameInputFocusInHandler=this._bindFilenameInputFocusInEvent(),this._filenameInputFocusHandler=this._bindFilenameInputFocusEvent())},_setupDragAndDrop:function(){var a=
this,c=this._options.dragAndDrop.extraDropzones,d=this._templating,e=d.getDropZone();e&&c.push(e);return new b.DragAndDrop({dropZoneElements:c,allowMultipleItems:this._options.multiple,classes:{dropActive:this._options.classes.dropActive},callbacks:{processingDroppedFiles:function(){d.showDropProcessing()},processingDroppedFilesComplete:function(c,e){d.hideDropProcessing();b.each(c,function(a,b){b.qqDropTarget=e});c.length&&a.addFiles(c,null,null)},dropError:function(b,c){a._itemError(b,c)},dropLog:function(b,
c){a.log(b,c)}}})},_bindFileButtonsClickEvent:function(){var a=this;return new b.FileButtonsClickHandler({templating:this._templating,log:function(b,d){a.log(b,d)},onDeleteFile:function(b){a.deleteFile(b)},onCancel:function(b){a.cancel(b)},onRetry:function(b){a.retry(b)},onPause:function(b){a.pauseUpload(b)},onContinue:function(b){a.continueUpload(b)},onGetName:function(b){return a.getName(b)}})},_isEditFilenameEnabled:function(){return this._templating.isEditFilenamePossible()&&!this._options.autoUpload&&
b.FilenameClickHandler&&b.FilenameInputFocusHandler&&b.FilenameInputFocusHandler},_filenameEditHandler:function(){var a=this,c=this._templating;return{templating:c,log:function(b,c){a.log(b,c)},onGetUploadStatus:function(b){return a.getUploads({id:b}).status},onGetName:function(b){return a.getName(b)},onSetName:function(b,c){a.setName(b,c)},onEditingStatusChange:function(a,e){var f=b(c.getEditInput(a)),g=b(c.getFileContainer(a));e?(f.addClass("qq-editing"),c.hideFilename(a),c.hideEditIcon(a)):(f.removeClass("qq-editing"),
c.showFilename(a),c.showEditIcon(a));g.addClass("qq-temp").removeClass("qq-temp")}}},_onUploadStatusChange:function(a,c,d){this._parent.prototype._onUploadStatusChange.apply(this,arguments);this._isEditFilenameEnabled()&&this._templating.getFileContainer(a)&&d!==b.status.SUBMITTED&&(this._templating.markFilenameEditable(a),this._templating.hideEditIcon(a));c===b.status.UPLOAD_RETRYING&&d===b.status.UPLOADING?(this._templating.hideRetry(a),this._templating.setStatusText(a),b(this._templating.getFileContainer(a)).removeClass(this._classes.retrying)):
d===b.status.UPLOAD_FAILED&&this._templating.hidePause(a)},_bindFilenameInputFocusInEvent:function(){var a=b.extend({},this._filenameEditHandler());return new b.FilenameInputFocusInHandler(a)},_bindFilenameInputFocusEvent:function(){var a=b.extend({},this._filenameEditHandler());return new b.FilenameInputFocusHandler(a)},_bindFilenameClickEvent:function(){var a=b.extend({},this._filenameEditHandler());return new b.FilenameClickHandler(a)},_storeForLater:function(a){this._parent.prototype._storeForLater.apply(this,
arguments);this._templating.hideSpinner(a)},_onAllComplete:function(a,b){this._parent.prototype._onAllComplete.apply(this,arguments);this._templating.resetTotalProgress()},_onSubmit:function(a,b){var d=this.getFile(a);d&&d.qqPath&&this._options.dragAndDrop.reportDirectoryPaths&&this._paramsStore.addReadOnly(a,{qqpath:d.qqPath});this._parent.prototype._onSubmit.apply(this,arguments);this._addToList(a,b)},_onSubmitted:function(a){this._isEditFilenameEnabled()&&(this._templating.markFilenameEditable(a),
this._templating.showEditIcon(a),this._focusinEventSupported||this._filenameInputFocusHandler.addHandler(this._templating.getEditInput(a)))},_onProgress:function(a,b,d,e){this._parent.prototype._onProgress.apply(this,arguments);this._templating.updateProgress(a,d,e);100===Math.round(d/e*100)?(this._templating.hideCancel(a),this._templating.hidePause(a),this._templating.hideProgress(a),this._templating.setStatusText(a,this._options.text.waitingForResponse),this._displayFileSize(a)):this._displayFileSize(a,
d,e)},_onTotalProgress:function(a,b){this._parent.prototype._onTotalProgress.apply(this,arguments);this._templating.updateTotalProgress(a,b)},_onComplete:function(a,c,d,e){function f(c){k&&(h.setStatusText(a),b(k).removeClass(l._classes.retrying),h.hideProgress(a),l.getUploads({id:a}).status!==b.status.UPLOAD_FAILED&&h.hideCancel(a),h.hideSpinner(a),c.success?l._markFileAsSuccessful(a):(b(k).addClass(l._classes.fail),h.showCancel(a),h.isRetryPossible()&&!l._preventRetries[a]&&(b(k).addClass(l._classes.retryable),
h.showRetry(a)),l._controlFailureTextDisplay(a,c)))}var g=this._parent.prototype._onComplete.apply(this,arguments),h=this._templating,k=h.getFileContainer(a),l=this;g instanceof b.Promise?g.done(function(a){f(a)}):f(d);return g},_markFileAsSuccessful:function(a){var c=this._templating;this._isDeletePossible()&&c.showDeleteButton(a);b(c.getFileContainer(a)).addClass(this._classes.success);this._maybeUpdateThumbnail(a)},_onUploadPrep:function(a){this._parent.prototype._onUploadPrep.apply(this,arguments);
this._templating.showSpinner(a)},_onUpload:function(a,b){var d=this._parent.prototype._onUpload.apply(this,arguments);this._templating.showSpinner(a);return d},_onUploadChunk:function(a,b){this._parent.prototype._onUploadChunk.apply(this,arguments);0<b.partIndex&&this._handler.isResumable(a)&&this._templating.allowPause(a)},_onCancel:function(a,b){this._parent.prototype._onCancel.apply(this,arguments);this._removeFileItem(a);0===this._getNotFinished()&&this._templating.resetTotalProgress()},_onBeforeAutoRetry:function(a){var c,
d;this._parent.prototype._onBeforeAutoRetry.apply(this,arguments);this._showCancelLink(a);this._options.retry.showAutoRetryNote&&(c=this._autoRetries[a],d=this._options.retry.maxAutoAttempts,c=this._options.retry.autoRetryNote.replace(/\{retryNum\}/g,c),c=c.replace(/\{maxAuto\}/g,d),this._templating.setStatusText(a,c),b(this._templating.getFileContainer(a)).addClass(this._classes.retrying))},_onBeforeManualRetry:function(a){if(this._parent.prototype._onBeforeManualRetry.apply(this,arguments))return this._templating.resetProgress(a),
b(this._templating.getFileContainer(a)).removeClass(this._classes.fail),this._templating.setStatusText(a),this._templating.showSpinner(a),this._showCancelLink(a),!0;b(this._templating.getFileContainer(a)).addClass(this._classes.retryable);this._templating.showRetry(a);return!1},_onSubmitDelete:function(a){var c=b.bind(this._onSubmitDeleteSuccess,this);this._parent.prototype._onSubmitDelete.call(this,a,c)},_onSubmitDeleteSuccess:function(a,b,d){this._options.deleteFile.forceConfirm?this._showDeleteConfirm.apply(this,
arguments):this._sendDeleteRequest.apply(this,arguments)},_onDeleteComplete:function(a,b,d){this._parent.prototype._onDeleteComplete.apply(this,arguments);this._templating.hideSpinner(a);d?(this._templating.setStatusText(a,this._options.deleteFile.deletingFailedText),this._templating.showDeleteButton(a)):this._removeFileItem(a)},_sendDeleteRequest:function(a,b,d){this._templating.hideDeleteButton(a);this._templating.showSpinner(a);this._templating.setStatusText(a,this._options.deleteFile.deletingStatusText);
this._deleteHandler.sendDelete.apply(this,arguments)},_showDeleteConfirm:function(a,c,d){var e=this.getName(a),e=this._options.deleteFile.confirmMessage.replace(/\{filename\}/g,e);c=this.getUuid(a);var f=arguments,g=this,e=this._options.showConfirm(e);b.isGenericPromise(e)?e.then(function(){g._sendDeleteRequest.apply(g,f)}):!1!==e&&g._sendDeleteRequest.apply(g,f)},_addToList:function(a,c,d){var e,f=0,g=this._handler.isProxied(a)&&this._options.scaling.hideScaled;this._options.display.prependFiles&&
(1<this._totalFilesInBatch&&0<this._filesInBatchAddedToUi&&(f=this._filesInBatchAddedToUi-1),e={index:f});d||(this._options.disableCancelForFormUploads&&!b.supportedFeatures.ajaxUploading&&this._templating.disableCancel(),this._options.multiple||(f=this.getUploads({id:a}),this._handledProxyGroup=this._handledProxyGroup||f.proxyGroupId,f.proxyGroupId===this._handledProxyGroup&&f.proxyGroupId||(this._handler.cancelAll(),this._clearList(),this._handledProxyGroup=null)));d?(this._templating.addFileToCache(a,
this._options.formatFileName(c),e,g),this._templating.updateThumbnail(a,this._thumbnailUrls[a],!0,this._options.thumbnails.customResizer)):(this._templating.addFile(a,this._options.formatFileName(c),e,g),this._templating.generatePreview(a,this.getFile(a),this._options.thumbnails.customResizer));this._filesInBatchAddedToUi+=1;(d||this._options.display.fileSizeOnSubmit&&b.supportedFeatures.ajaxUploading)&&this._displayFileSize(a)},_clearList:function(){this._templating.clearFiles();this.clearStoredFiles()},
_displayFileSize:function(a,b,d){var e=this.getSize(a),f=this._formatSize(e);0<=e&&(void 0!==b&&void 0!==d&&(f=this._formatProgress(b,d)),this._templating.updateSize(a,f))},_formatProgress:function(a,b){var d=this._options.text.formatProgress,d=d.replace("{percent}",Math.round(a/b*100)),e=this._formatSize(b);return d=d.replace("{total_size}",e)},_controlFailureTextDisplay:function(a,b){var d,e;d=this._options.failedUploadTextDisplay.mode;e=this._options.failedUploadTextDisplay.responseProperty;"custom"===
d?(d=b[e],d||(d=this._options.text.failUpload),this._templating.setStatusText(a,d),this._options.failedUploadTextDisplay.enableTooltip&&this._showTooltip(a,d)):"default"===d?this._templating.setStatusText(a,this._options.text.failUpload):"none"!==d&&this.log("failedUploadTextDisplay.mode value of '"+d+"' is not valid","warn")},_showTooltip:function(a,b){this._templating.getFileContainer(a).title=b},_showCancelLink:function(a){this._options.disableCancelForFormUploads&&!b.supportedFeatures.ajaxUploading||
this._templating.showCancel(a)},_itemError:function(a,b,d){var e=this._parent.prototype._itemError.apply(this,arguments);this._options.showMessage(e)},_batchError:function(a){this._parent.prototype._batchError.apply(this,arguments);this._options.showMessage(a)},_setupPastePrompt:function(){var a=this;this._options.callbacks.onPasteReceived=function(){return a._options.showPrompt(a._options.paste.namePromptMessage,a._options.paste.defaultName)}},_fileOrBlobRejected:function(a,b){--this._totalFilesInBatch;
this._parent.prototype._fileOrBlobRejected.apply(this,arguments)},_prepareItemsForUpload:function(a,b,d){this._totalFilesInBatch=a.length;this._filesInBatchAddedToUi=0;this._parent.prototype._prepareItemsForUpload.apply(this,arguments)},_maybeUpdateThumbnail:function(a){var c=this._thumbnailUrls[a];this.getUploads({id:a}).status===b.status.DELETED||!c&&!this._options.thumbnails.placeholders.waitUntilResponse&&b.supportedFeatures.imagePreviews||this._templating.updateThumbnail(a,c,this._options.thumbnails.customResizer)},
_addCannedFile:function(a){var b=this._parent.prototype._addCannedFile.apply(this,arguments);this._addToList(b,this.getName(b),!0);this._templating.hideSpinner(b);this._templating.hideCancel(b);this._markFileAsSuccessful(b);return b},_setSize:function(a,b){this._parent.prototype._setSize.apply(this,arguments);this._templating.updateSize(a,this._formatSize(b))},_sessionRequestComplete:function(){this._templating.addCacheToDom();this._parent.prototype._sessionRequestComplete.apply(this,arguments)}}})();
b.FineUploader=function(a,c){var d=this;this._parent=c?b[c].FineUploaderBasic:b.FineUploaderBasic;this._parent.apply(this,arguments);b.extend(this._options,{element:null,button:null,listElement:null,dragAndDrop:{extraDropzones:[],reportDirectoryPaths:!1},text:{formatProgress:"{percent}% of {total_size}",failUpload:"Upload failed",waitingForResponse:"Processing...",paused:"Paused"},template:"qq-template",classes:{retrying:"qq-upload-retrying",retryable:"qq-upload-retryable",success:"qq-upload-success",
fail:"qq-upload-fail",editable:"qq-editable",hide:"qq-hide",dropActive:"qq-upload-drop-area-active"},failedUploadTextDisplay:{mode:"default",responseProperty:"error",enableTooltip:!0},messages:{tooManyFilesError:"You may only drop one file",unsupportedBrowser:"Unrecoverable error - this browser does not permit file uploading of any kind."},retry:{showAutoRetryNote:!0,autoRetryNote:"Retrying {retryNum}/{maxAuto}..."},deleteFile:{forceConfirm:!1,confirmMessage:"Are you sure you want to delete {filename}?",
deletingStatusText:"Deleting...",deletingFailedText:"Delete failed"},display:{fileSizeOnSubmit:!1,prependFiles:!1},paste:{promptForName:!1,namePromptMessage:"Please name this image"},thumbnails:{customResizer:null,maxCount:0,placeholders:{waitUntilResponse:!1,notAvailablePath:null,waitingPath:null},timeBetweenThumbs:750},scaling:{hideScaled:!1},showMessage:function(a){if(d._templating.hasDialog("alert"))return d._templating.showDialog("alert",a);setTimeout(function(){window.alert(a)},0)},showConfirm:function(a){return d._templating.hasDialog("confirm")?
d._templating.showDialog("confirm",a):window.confirm(a)},showPrompt:function(a,b){return d._templating.hasDialog("prompt")?d._templating.showDialog("prompt",a,b):window.prompt(a,b)}},!0);b.extend(this._options,a,!0);this._templating=new b.Templating({log:b.bind(this.log,this),templateIdOrEl:this._options.template,containerEl:this._options.element,fileContainerEl:this._options.listElement,button:this._options.button,imageGenerator:this._imageGenerator,classes:{hide:this._options.classes.hide,editable:this._options.classes.editable},
limits:{maxThumbs:this._options.thumbnails.maxCount,timeBetweenThumbs:this._options.thumbnails.timeBetweenThumbs},placeholders:{waitUntilUpdate:this._options.thumbnails.placeholders.waitUntilResponse,thumbnailNotAvailable:this._options.thumbnails.placeholders.notAvailablePath,waitingForThumbnail:this._options.thumbnails.placeholders.waitingPath},text:this._options.text});this._options.workarounds.ios8SafariUploads&&b.ios800()&&b.iosSafari()?this._templating.renderFailure(this._options.messages.unsupportedBrowserIos8Safari):
!b.supportedFeatures.uploading||this._options.cors.expected&&!b.supportedFeatures.uploadCors?this._templating.renderFailure(this._options.messages.unsupportedBrowser):(this._wrapCallbacks(),this._templating.render(),this._classes=this._options.classes,!this._options.button&&this._templating.getButton()&&(this._defaultButtonId=this._createUploadButton({element:this._templating.getButton(),title:this._options.text.fileInputTitle}).getButtonId()),this._setupClickAndEditEventHandlers(),b.DragAndDrop&&
b.supportedFeatures.fileDrop&&(this._dnd=this._setupDragAndDrop()),this._options.paste.targetElement&&this._options.paste.promptForName&&(b.PasteSupport?this._setupPastePrompt():this.log("Paste support module not found.","error")),this._filesInBatchAddedToUi=this._totalFilesInBatch=0)};b.extend(b.FineUploader.prototype,b.basePublicApi);b.extend(b.FineUploader.prototype,b.basePrivateApi);b.extend(b.FineUploader.prototype,b.uiPublicApi);b.extend(b.FineUploader.prototype,b.uiPrivateApi);b.Templating=
function(a){var c=document.createDocumentFragment(),d={},e=!1,f=0,g=!1,h=[],k=-1,l={log:null,limits:{maxThumbs:0,timeBetweenThumbs:750},templateIdOrEl:"qq-template",containerEl:null,fileContainerEl:null,button:null,imageGenerator:null,classes:{hide:"qq-hide",editable:"qq-editable"},placeholders:{waitUntilUpdate:!1,thumbnailNotAvailable:null,waitingForThumbnail:null},text:{paused:"Paused"}},m={button:"qq-upload-button-selector",alertDialog:"qq-alert-dialog-selector",dialogCancelButton:"qq-cancel-button-selector",
confirmDialog:"qq-confirm-dialog-selector",dialogMessage:"qq-dialog-message-selector",dialogOkButton:"qq-ok-button-selector",promptDialog:"qq-prompt-dialog-selector",uploader:"qq-uploader-selector",drop:"qq-upload-drop-area-selector",list:"qq-upload-list-selector",progressBarContainer:"qq-progress-bar-container-selector",progressBar:"qq-progress-bar-selector",totalProgressBarContainer:"qq-total-progress-bar-container-selector",totalProgressBar:"qq-total-progress-bar-selector",file:"qq-upload-file-selector",
spinner:"qq-upload-spinner-selector",size:"qq-upload-size-selector",cancel:"qq-upload-cancel-selector",pause:"qq-upload-pause-selector",continueButton:"qq-upload-continue-selector",deleteButton:"qq-upload-delete-selector",retry:"qq-upload-retry-selector",statusText:"qq-upload-status-text-selector",editFilenameInput:"qq-edit-filename-selector",editNameIcon:"qq-edit-filename-icon-selector",dropText:"qq-upload-drop-area-text-selector",dropProcessing:"qq-drop-processing-selector",dropProcessingSpinner:"qq-drop-processing-spinner-selector",
thumbnail:"qq-thumbnail-selector"},n={},q=new b.Promise,p=new b.Promise,r,y,w,v,x,t,C,H,E=function(a){var c=new b.Promise;p.then(function(b){L(b,a);a.src?c.success():(a.src=b.src,a.onload=function(){a.onload=null;B(a);c.success()})},function(){A(a);c.success()});return c},I=function(a,b,c){var d=F(a);r("Generating new thumbnail for "+a);b.qqThumbnailId=a;return l.imageGenerator.generate(b,d,c).then(function(){f++;B(d);n[a].success()},function(){n[a].failure();l.placeholders.waitUntilUpdate||G(a,d)})},
D=function(){if(h.length){g=!0;var a=h.shift();a.update?N(a):O(a)}else g=!1},z=function(a){return d[a]||b(t).getFirstByClass("qq-file-id-"+a)},J=function(a){return null==a?u(x,m.totalProgressBarContainer)||u(x,m.totalProgressBar):u(z(a),m.progressBarContainer)||u(z(a),m.progressBar)},u=function(a,c){return a&&b(a).getFirstByClass(c)},F=function(a){return C&&u(z(a),m.thumbnail)},A=function(a){a&&b(a).addClass(l.classes.hide)},L=function(a,c){var d=a.style.maxWidth,e=a.style.maxHeight;e&&d&&!c.style.maxWidth&&
!c.style.maxHeight&&b(c).css({maxWidth:d,maxHeight:e})},G=function(a,c){var d=n[a]||(new b.Promise).failure(),e=new b.Promise;q.then(function(a){d.then(function(){e.success()},function(){L(a,c);c.onload=function(){c.onload=null;e.success()};c.src=a.src;B(c)})});return e},K=function(a,c,d){var e=d.firstChild;0<c&&(e=b(d).children()[c].nextSibling);d.insertBefore(a,e)},O=function(a){var c=a.id,d=a.optFileOrBlob,e=d&&d.qqThumbnailId,g=F(c),h={customResizeFunction:a.customResizeFunction,maxSize:k,orient:!0,
scale:!0};b.supportedFeatures.imagePreviews?g?l.limits.maxThumbs&&l.limits.maxThumbs<=f?(G(c,g),D()):E(g).done(function(){n[c]=new b.Promise;n[c].done(function(){setTimeout(D,l.limits.timeBetweenThumbs)});null!=e?P(c,e):I(c,d,h)}):D():g&&(E(g),D())},N=function(a){var b=a.id,c=a.thumbnailUrl,d=a.showWaitingImg,e=F(b);a={customResizeFunction:a.customResizeFunction,scale:H,maxSize:k};if(e)if(c)if(l.limits.maxThumbs&&l.limits.maxThumbs<=f)G(b,e),D();else return d&&E(e),l.imageGenerator.generate(c,e,a).then(function(){B(e);
f++;setTimeout(D,l.limits.timeBetweenThumbs)},function(){G(b,e);setTimeout(D,l.limits.timeBetweenThumbs)});else G(b,e),D()},M=function(a,c){var d=J(a),e=null==a?m.totalProgressBar:m.progressBar;d&&!b(d).hasClass(e)&&(d=b(d).getFirstByClass(e));d&&(b(d).css({width:c+"%"}),d.setAttribute("aria-valuenow",c))},B=function(a){a&&b(a).removeClass(l.classes.hide)},P=function(a,c){var d=F(a),e=F(c);r(b.format("ID {} is the same file as ID {}.  Will use generated thumbnail from ID {} instead.",a,c,c));n[c].then(function(){f++;
n[a].success();r(b.format("Now using previously generated thumbnail created for ID {} on ID {}.",c,a));d.src=e.src;B(d)},function(){n[a].failure();l.placeholders.waitUntilUpdate||G(a,d)})};b.extend(l,a);r=l.log;b.supportedFeatures.imagePreviews||(l.limits.timeBetweenThumbs=0,l.limits.maxThumbs=0);x=l.containerEl;C=void 0!==l.imageGenerator;v=function(){var a,c,d;r("Parsing template");if(null==l.templateIdOrEl)throw Error("You MUST specify either a template element or ID!");if(b.isString(l.templateIdOrEl)){a=
document.getElementById(l.templateIdOrEl);if(null===a)throw Error(b.format("Cannot find template script at ID '{}'!",l.templateIdOrEl));c=a.innerHTML}else{if(void 0===l.templateIdOrEl.innerHTML)throw Error("You have specified an invalid value for the template option!  It must be an ID or an Element.");c=l.templateIdOrEl.innerHTML}c=b.trimStr(c);a=document.createElement("div");a.appendChild(b.toElement(c));c=b(a).getFirstByClass(m.uploader);l.button&&(d=b(a).getFirstByClass(m.button))&&b(d).remove();
b.DragAndDrop&&b.supportedFeatures.fileDrop||(d=b(a).getFirstByClass(m.dropProcessing))&&b(d).remove();(d=b(a).getFirstByClass(m.drop))&&!b.DragAndDrop&&(r("DnD module unavailable.","info"),b(d).remove());b.supportedFeatures.fileDrop?b(c).hasAttribute("qq-drop-area-text")&&d&&(c=b(d).getFirstByClass(m.dropText))&&b(c).remove():(c.removeAttribute("qq-drop-area-text"),d&&b(d).hasAttribute("qq-hide-dropzone")&&b(d).css({display:"none"}));c=b(a).getFirstByClass(m.thumbnail);C?c&&(k=parseInt(c.getAttribute("qq-max-size")),
k=0<k?k:null,H=b(c).hasAttribute("qq-server-scale")):c&&b(c).remove();C=C&&c;y=0<b(a).getByClass(m.editFilenameInput).length;w=0<b(a).getByClass(m.retry).length;c=b(a).getFirstByClass(m.list);if(null==c)throw Error("Could not find the file list container in the template!");d=c.innerHTML;c.innerHTML="";a.getElementsByTagName("DIALOG").length&&document.createElement("dialog");r("Template parsing complete");return{template:b.trimStr(a.innerHTML),fileTemplate:b.trimStr(d)}}();(function(){var a=l.placeholders.thumbnailNotAvailable,
b=l.placeholders.waitingForThumbnail,c={maxSize:k,scale:H};C&&(a?l.imageGenerator.generate(a,new Image,c).then(function(a){q.success(a)},function(){q.failure();r("Problem loading 'not available' placeholder image at "+a,"error")}):q.failure(),b?l.imageGenerator.generate(b,new Image,c).then(function(a){p.success(a)},function(){p.failure();r("Problem loading 'waiting for thumbnail' placeholder image at "+b,"error")}):p.failure())})();b.extend(this,{render:function(){r("Rendering template in DOM.");
f=0;x.innerHTML=v.template;A(u(x,m.dropProcessing));this.hideTotalProgress();t=l.fileContainerEl||u(x,m.list);r("Template rendering complete")},renderFailure:function(a){a=b.toElement(a);x.innerHTML="";x.appendChild(a)},reset:function(){this.render()},clearFiles:function(){t.innerHTML=""},disableCancel:function(){e=!0},addFile:function(a,f,g,h,k){var l=b.toElement(v.fileTemplate),n=u(l,m.file),q=u(x,m.uploader),r=k?c:t,w;k&&(d[a]=l);b(l).addClass("qq-file-id-"+a);q.removeAttribute("qq-drop-area-text");
n&&(b(n).setText(f),n.setAttribute("title",f));l.setAttribute("qq-file-id",a);g?K(l,g.index,r):r.appendChild(l);h?(l.style.display="none",b(l).addClass("qq-hidden-forever")):(A(J(a)),A(u(z(a),m.size)),A(u(z(a),m.deleteButton)),A(u(z(a),m.retry)),A(u(z(a),m.pause)),A(u(z(a),m.continueButton)),e&&this.hideCancel(a),(w=F(a))&&!w.src&&p.then(function(a){w.src=a.src;a.style.maxHeight&&a.style.maxWidth&&b(w).css({maxHeight:a.style.maxHeight,maxWidth:a.style.maxWidth});B(w)}))},addFileToCache:function(a,
b,c,d){this.addFile(a,b,c,d,!0)},addCacheToDom:function(){t.appendChild(c);c=document.createDocumentFragment();d={}},removeFile:function(a){b(z(a)).remove()},getFileId:function(a){if(a){for(;null==a.getAttribute("qq-file-id");)a=a.parentNode;return parseInt(a.getAttribute("qq-file-id"))}},getFileList:function(){return t},markFilenameEditable:function(a){(a=u(z(a),m.file))&&b(a).addClass(l.classes.editable)},updateFilename:function(a,c){var d=u(z(a),m.file);d&&(b(d).setText(c),d.setAttribute("title",
c))},hideFilename:function(a){A(u(z(a),m.file))},showFilename:function(a){B(u(z(a),m.file))},isFileName:function(a){return b(a).hasClass(m.file)},getButton:function(){return l.button||u(x,m.button)},hideDropProcessing:function(){A(u(x,m.dropProcessing))},showDropProcessing:function(){B(u(x,m.dropProcessing))},getDropZone:function(){return u(x,m.drop)},isEditFilenamePossible:function(){return y},hideRetry:function(a){A(u(z(a),m.retry))},isRetryPossible:function(){return w},showRetry:function(a){B(u(z(a),
m.retry))},getFileContainer:function(a){return z(a)},showEditIcon:function(a){(a=u(z(a),m.editNameIcon))&&b(a).addClass(l.classes.editable)},isHiddenForever:function(a){return b(z(a)).hasClass("qq-hidden-forever")},hideEditIcon:function(a){(a=u(z(a),m.editNameIcon))&&b(a).removeClass(l.classes.editable)},isEditIcon:function(a){return b(a).hasClass(m.editNameIcon,!0)},getEditInput:function(a){return u(z(a),m.editFilenameInput)},isEditInput:function(a){return b(a).hasClass(m.editFilenameInput,!0)},
updateProgress:function(a,b,c){var d=J(a);d&&0<c&&(b=Math.round(b/c*100),100===b?A(d):B(d),M(a,b))},updateTotalProgress:function(a,b){this.updateProgress(null,a,b)},hideProgress:function(a){(a=J(a))&&A(a)},hideTotalProgress:function(){this.hideProgress()},resetProgress:function(a){M(a,0);this.hideTotalProgress(a)},resetTotalProgress:function(){this.resetProgress()},showCancel:function(a){e||(a=u(z(a),m.cancel))&&b(a).removeClass(l.classes.hide)},hideCancel:function(a){A(u(z(a),m.cancel))},isCancel:function(a){return b(a).hasClass(m.cancel,
!0)},allowPause:function(a){B(u(z(a),m.pause));A(u(z(a),m.continueButton))},uploadPaused:function(a){this.setStatusText(a,l.text.paused);this.allowContinueButton(a);A(u(z(a),m.spinner))},hidePause:function(a){A(u(z(a),m.pause))},isPause:function(a){return b(a).hasClass(m.pause,!0)},isContinueButton:function(a){return b(a).hasClass(m.continueButton,!0)},allowContinueButton:function(a){B(u(z(a),m.continueButton));A(u(z(a),m.pause))},uploadContinued:function(a){this.setStatusText(a,"");this.allowPause(a);
B(u(z(a),m.spinner))},showDeleteButton:function(a){B(u(z(a),m.deleteButton))},hideDeleteButton:function(a){A(u(z(a),m.deleteButton))},isDeleteButton:function(a){return b(a).hasClass(m.deleteButton,!0)},isRetry:function(a){return b(a).hasClass(m.retry,!0)},updateSize:function(a,c){var d=u(z(a),m.size);d&&(B(d),b(d).setText(c))},setStatusText:function(a,c){var d=u(z(a),m.statusText);d&&(null==c?b(d).clearText():b(d).setText(c))},hideSpinner:function(a){b(z(a)).removeClass("qq-in-progress");A(u(z(a),
m.spinner))},showSpinner:function(a){b(z(a)).addClass("qq-in-progress");B(u(z(a),m.spinner))},generatePreview:function(a,b,c){this.isHiddenForever(a)||(h.push({id:a,customResizeFunction:c,optFileOrBlob:b}),!g&&D())},updateThumbnail:function(a,b,c,d){this.isHiddenForever(a)||(h.push({customResizeFunction:d,update:!0,id:a,thumbnailUrl:b,showWaitingImg:c}),!g&&D())},hasDialog:function(a){return b.supportedFeatures.dialogElement&&!!u(x,m[a+"Dialog"])},showDialog:function(a,c,d){var e=u(x,m[a+"Dialog"]);
a=u(e,m.dialogMessage);var f=e.getElementsByTagName("INPUT")[0],g=u(e,m.dialogCancelButton),h=u(e,m.dialogOkButton),k=new b.Promise,l=function(){g.removeEventListener("click",n);h&&h.removeEventListener("click",p);k.failure()},n=function(){g.removeEventListener("click",n);e.close()},p=function(){e.removeEventListener("close",l);h.removeEventListener("click",p);e.close();k.success(f&&f.value)};e.addEventListener("close",l);g.addEventListener("click",n);h&&h.addEventListener("click",p);f&&(f.value=
d);a.textContent=c;e.showModal();return k}})};b.UiEventHandler=function(a,c){function d(a){e.attach(a,f.eventType,function(a){a=a||window.event;f.onHandled(a.target||a.srcElement,a)})}var e=new b.DisposeSupport,f={eventType:"click",attachTo:null,onHandled:function(a,b){}};b.extend(this,{addHandler:function(a){d(a)},dispose:function(){e.dispose()}});b.extend(c,{getFileIdFromItem:function(a){return a.qqFileId},getDisposeSupport:function(){return e}});b.extend(f,a);f.attachTo&&d(f.attachTo)};b.FileButtonsClickHandler=
function(a){var c={templating:null,log:function(a,b){},onDeleteFile:function(a){},onCancel:function(a){},onRetry:function(a){},onPause:function(a){},onContinue:function(a){},onGetName:function(a){}},d={cancel:function(a){c.onCancel(a)},retry:function(a){c.onRetry(a)},deleteButton:function(a){c.onDeleteFile(a)},pause:function(a){c.onPause(a)},continueButton:function(a){c.onContinue(a)}};b.extend(c,a);c.eventType="click";c.onHandled=function(a,f){b.each(d,function(d,h){var k=d.charAt(0).toUpperCase()+
d.slice(1);if(c.templating["is"+k](a))return k=c.templating.getFileId(a),b.preventDefault(f),c.log(b.format("Detected valid file button click event on file '{}', ID: {}.",c.onGetName(k),k)),h(k),!1})};c.attachTo=c.templating.getFileList();b.extend(this,new b.UiEventHandler(c,{}))};b.FilenameClickHandler=function(a){var c={},d={templating:null,log:function(a,b){},classes:{file:"qq-upload-file",editNameIcon:"qq-edit-filename-icon"},onGetUploadStatus:function(a){},onGetName:function(a){}};b.extend(d,
a);d.eventType="click";d.onHandled=function(a,f){if(d.templating.isFileName(a)||d.templating.isEditIcon(a)){var g=d.templating.getFileId(a);d.onGetUploadStatus(g)===b.status.SUBMITTED&&(d.log(b.format("Detected valid filename click event on file '{}', ID: {}.",d.onGetName(g),g)),b.preventDefault(f),c.handleFilenameEdit(g,a,!0))}};b.extend(this,new b.FilenameEditHandler(d,c))};b.FilenameInputFocusInHandler=function(a,c){var d={templating:null,onGetUploadStatus:function(a){},log:function(a,b){}};c||
(c={});d.eventType="focusin";d.onHandled=function(a,f){if(d.templating.isEditInput(a)){var g=d.templating.getFileId(a);d.onGetUploadStatus(g)===b.status.SUBMITTED&&(d.log(b.format("Detected valid filename input focus event on file '{}', ID: {}.",d.onGetName(g),g)),c.handleFilenameEdit(g,a))}};b.extend(d,a);b.extend(this,new b.FilenameEditHandler(d,c))};b.FilenameInputFocusHandler=function(a){a.eventType="focus";a.attachTo=null;b.extend(this,new b.FilenameInputFocusInHandler(a,{}))};b.FilenameEditHandler=
function(a,c){function d(a,c){var d=a.value,e;void 0!==d&&0<b.trimStr(d).length&&(e=g.onGetName(c),e=b.getExtension(e),void 0!==e&&(d=d+"."+e),g.onSetName(c,d));g.onEditingStatusChange(c,!1)}function e(a,b){c.getDisposeSupport().attach(a,"blur",function(){d(a,b)})}function f(a,b){c.getDisposeSupport().attach(a,"keyup",function(c){13===(c.keyCode||c.which)&&d(a,b)})}var g={templating:null,log:function(a,b){},onGetUploadStatus:function(a){},onGetName:function(a){},onSetName:function(a,b){},onEditingStatusChange:function(a,
b){}};b.extend(g,a);g.attachTo=g.templating.getFileList();b.extend(this,new b.UiEventHandler(g,c));b.extend(c,{handleFilenameEdit:function(a,b,c){b=g.templating.getEditInput(a);g.onEditingStatusChange(a,!0);var d=g.onGetName(a),n=d.lastIndexOf(".");0<n&&(d=d.substr(0,n));b.value=d;c&&b.focus();e(b,a);f(b,a)}})}})(window);
