/*
   Copyright 2015-2016 SpryMedia Ltd.

 This source file is free software, available under the following license:
   MIT license - http://datatables.net/license/mit

 This source file is distributed in the hope that it will be useful, but
 WITHOUT ANY WARRANTY; without even the implied warranty of MERCHANTABILITY
 or FITNESS FOR A PARTICULAR PURPOSE. See the license files for details.

 For details please refer to: http://www.datatables.net
*/
(function(e){"function"===typeof define&&define.amd?define(["jquery","datatables.net"],function(f){return e(f,window,document)}):"object"===typeof exports?module.exports=function(f,g){f||(f=window);g&&g.fn.dataTable||(g=require("datatables.net")(f,g).$);return e(g,f,f.document)}:e(jQuery,window,document)})(function(e,f,g,q){var n=e.fn.dataTable,k=function(c,d){if(!n.versionCheck||!n.versionCheck("1.10.8"))throw"DataTables RowReorder requires DataTables 1.10.8 or newer";this.c=e.extend(!0,{},n.defaults.rowReorder,
k.defaults,d);this.s={bodyTop:null,dt:new n.Api(c),getDataFn:n.ext.oApi._fnGetObjectDataFn(this.c.dataSrc),middles:null,scroll:{},scrollInterval:null,setDataFn:n.ext.oApi._fnSetObjectDataFn(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[]},windowHeight:0};this.dom={clone:null,dtScroll:e("div.dataTables_scrollBody",this.s.dt.table().container())};var b=this.s.dt.settings()[0],a=b.rowreorder;if(a)return a;b.rowreorder=this;this._constructor()};e.extend(k.prototype,{_constructor:function(){var c=
this,d=this.s.dt,b=e(d.table().node());"static"===b.css("position")&&b.css("position","relative");e(d.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,function(a){if(c.c.enabled){var b=e(this).closest("tr");if(d.row(b).any())return c._mouseDown(a,b),!1}});d.on("destroy.rowReorder",function(){e(d.table().container()).off(".rowReorder");d.off(".rowReorder")})},_cachePositions:function(){var c=this.s.dt,d=e(c.table().node()).find("thead").outerHeight(),b=e.unique(c.rows({page:"current"}).nodes().toArray()),
a=e.map(b,function(a,c){return e(a).position().top-d}),b=e.map(a,function(b,d){return a.length<d-1?(b+a[d+1])/2:(b+b+e(c.row(":last-child").node()).outerHeight())/2});this.s.middles=b;this.s.bodyTop=e(c.table().body()).offset().top;this.s.windowHeight=e(f).height()},_clone:function(c){var d=e(this.s.dt.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(c.clone(!1)),b=c.outerWidth(),a=c.outerHeight(),l=c.children().map(function(){return e(this).width()});d.width(b).height(a).find("tr").children().each(function(a){this.style.width=
l[a]+"px"});d.appendTo("body");this.dom.clone=d},_clonePosition:function(c){var d=this.s.start,b=this._eventToPage(c,"Y")-d.top;c=this._eventToPage(c,"X")-d.left;var a=this.c.snapX;this.dom.clone.css({top:b+d.offsetTop,left:!0===a?d.offsetLeft:"number"===typeof a?d.offsetLeft+a:c+d.offsetLeft})},_emitEvent:function(c,d){this.s.dt.iterator("table",function(b,a){e(b.nTable).triggerHandler(c+".dt",d)})},_eventToPage:function(c,d){return-1!==c.type.indexOf("touch")?c.originalEvent.touches[0]["page"+d]:
c["page"+d]},_mouseDown:function(c,d){var b=this,a=this.s.dt,l=this.s.start,m=d.offset();l.top=this._eventToPage(c,"Y");l.left=this._eventToPage(c,"X");l.offsetTop=m.top;l.offsetLeft=m.left;l.nodes=e.unique(a.rows({page:"current"}).nodes().toArray());this._cachePositions();this._clone(d);this._clonePosition(c);this.dom.target=d;d.addClass("dt-rowReorder-moving");e(g).on("mouseup.rowReorder touchend.rowReorder",function(a){b._mouseUp(a)}).on("mousemove.rowReorder touchmove.rowReorder",function(a){b._mouseMove(a)});
e(f).width()===e(g).width()&&e(g.body).addClass("dt-rowReorder-noOverflow");a=this.dom.dtScroll;this.s.scroll={windowHeight:e(f).height(),windowWidth:e(f).width(),dtTop:a.length?a.offset().top:null,dtLeft:a.length?a.offset().left:null,dtHeight:a.length?a.outerHeight():null,dtWidth:a.length?a.outerWidth():null}},_mouseMove:function(c){this._clonePosition(c);for(var d=this._eventToPage(c,"Y")-this.s.bodyTop,b=this.s.middles,a=null,l=this.s.dt,m=l.table().body(),h=0,g=b.length;h<g;h++)if(d<b[h]){a=h;
break}null===a&&(a=b.length);if(null===this.s.lastInsert||this.s.lastInsert!==a)0===a?this.dom.target.prependTo(m):(d=e.unique(l.rows({page:"current"}).nodes().toArray()),a>this.s.lastInsert?this.dom.target.insertAfter(d[a-1]):this.dom.target.insertBefore(d[a])),this._cachePositions(),this.s.lastInsert=a;this._shiftScroll(c)},_mouseUp:function(c){var d=this,b=this.s.dt,a,l=this.c.dataSrc;this.dom.clone.remove();this.dom.clone=null;this.dom.target.removeClass("dt-rowReorder-moving");e(g).off(".rowReorder");
e(g.body).removeClass("dt-rowReorder-noOverflow");clearInterval(this.s.scrollInterval);this.s.scrollInterval=null;var m=this.s.start.nodes,h=e.unique(b.rows({page:"current"}).nodes().toArray()),f={},k=[],n=[],p=this.s.getDataFn,q=this.s.setDataFn;a=0;for(c=m.length;a<c;a++)if(m[a]!==h[a]){var r=b.row(h[a]).id(),u=b.row(h[a]).data(),t=b.row(m[a]).data();r&&(f[r]=p(t));k.push({node:h[a],oldData:p(u),newData:p(t),newPosition:a,oldPosition:e.inArray(h[a],m)});n.push(h[a])}m=[k,{dataSrc:l,nodes:n,values:f,
triggerRow:b.row(this.dom.target)}];this._emitEvent("row-reorder",m);this.c.editor&&(this.c.enabled=!1,this.c.editor.edit(n,!1,e.extend({submit:"changed"},this.c.formOptions)).multiSet(l,f).one("submitComplete",function(){d.c.enabled=!0}).submit());if(this.c.update){a=0;for(c=k.length;a<c;a++)f=b.row(k[a].node).data(),q(f,k[a].newData),b.columns().every(function(){this.dataSrc()===l&&b.cell(k[a].node,this.index()).invalidate("data")});this._emitEvent("row-reordered",m);b.draw(!1)}},_shiftScroll:function(c){var d=
this,b=this.s.scroll,a=!1,e=c.pageY-g.body.scrollTop,f,h;65>e?f=-5:e>b.windowHeight-65&&(f=5);null!==b.dtTop&&c.pageY<b.dtTop+65?h=-5:null!==b.dtTop&&c.pageY>b.dtTop+b.dtHeight-65&&(h=5);f||h?(b.windowVert=f,b.dtVert=h,a=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null);!this.s.scrollInterval&&a&&(this.s.scrollInterval=setInterval(function(){b.windowVert&&(g.body.scrollTop+=b.windowVert);if(b.dtVert){var a=d.dom.dtScroll[0];b.dtVert&&(a.scrollTop+=b.dtVert)}},
20))}});k.defaults={dataSrc:0,editor:null,enabled:!0,formOptions:{},selector:"td:first-child",snapX:!1,update:!0};var p=e.fn.dataTable.Api;p.register("rowReorder()",function(){return this});p.register("rowReorder.enable()",function(c){c===q&&(c=!0);return this.iterator("table",function(d){d.rowreorder&&(d.rowreorder.c.enabled=c)})});p.register("rowReorder.disable()",function(){return this.iterator("table",function(c){c.rowreorder&&(c.rowreorder.c.enabled=!1)})});k.version="1.2.0";e.fn.dataTable.RowReorder=
k;e.fn.DataTable.RowReorder=k;e(g).on("init.dt.dtr",function(c,d,b){"dt"===c.namespace&&(c=d.oInit.rowReorder,b=n.defaults.rowReorder,c||b)&&(b=e.extend({},c,b),!1!==c&&new k(d,b))});return k});
