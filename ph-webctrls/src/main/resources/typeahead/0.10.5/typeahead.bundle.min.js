(function(f){var e=function(){return{isMsie:function(){return/(msie|trident)/i.test(navigator.userAgent)?navigator.userAgent.match(/(msie |rv:)(\d+(.\d+)?)/i)[2]:!1},isBlankString:function(b){return!b||/^\s*$/.test(b)},escapeRegExChars:function(b){return b.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},isString:function(b){return"string"===typeof b},isNumber:function(b){return"number"===typeof b},isArray:f.isArray,isFunction:f.isFunction,isObject:f.isPlainObject,isUndefined:function(b){return"undefined"===
typeof b},toStr:function(b){return e.isUndefined(b)||null===b?"":b+""},bind:f.proxy,each:function(b,e){f.each(b,function(b,c){return e(c,b)})},map:f.map,filter:f.grep,every:function(b,e){var d=!0;if(!b)return d;f.each(b,function(c,a){if(!(d=e.call(null,a,c,b)))return!1});return!!d},some:function(b,e){var d=!1;if(!b)return d;f.each(b,function(c,a){if(d=e.call(null,a,c,b))return!1});return!!d},mixin:f.extend,getUniqueId:function(){var b=0;return function(){return b++}}(),templatify:function(b){function e(){return String(b)}
return f.isFunction(b)?b:e},defer:function(b){setTimeout(b,0)},debounce:function(b,e,d){var c,a;return function(){var g=this,l=arguments,n;n=d&&!c;clearTimeout(c);c=setTimeout(function(){c=null;d||(a=b.apply(g,l))},e);n&&(a=b.apply(g,l));return a}},throttle:function(b,e){var d,c,a,g,l,n;l=0;n=function(){l=new Date;a=null;g=b.apply(d,c)};return function(){var k=new Date,m=e-(k-l);d=this;c=arguments;0>=m?(clearTimeout(a),a=null,l=k,g=b.apply(d,c)):a||(a=setTimeout(n,m));return g}},noop:function(){}}}(),
A=function(){function b(c){return(c=e.toStr(c))?c.split(/\s+/):[]}function f(c){return(c=e.toStr(c))?c.split(/\W+/):[]}function d(c){return function(){var a=[].slice.call(arguments,0);return function(g){var l=[];e.each(a,function(a){l=l.concat(c(e.toStr(g[a])))});return l}}}return{nonword:f,whitespace:b,obj:{nonword:d(f),whitespace:d(b)}}}(),v=function(){function b(c){this.maxSize=e.isNumber(c)?c:100;this.reset();0>=this.maxSize&&(this.set=this.get=f.noop)}function h(){this.head=this.tail=null}function d(c,
a){this.key=c;this.val=a;this.prev=this.next=null}e.mixin(b.prototype,{set:function(c,a){var g=this.list.tail;this.size>=this.maxSize&&(this.list.remove(g),delete this.hash[g.key]);(g=this.hash[c])?(g.val=a,this.list.moveToFront(g)):(g=new d(c,a),this.list.add(g),this.hash[c]=g,this.size++)},get:function(c){if(c=this.hash[c])return this.list.moveToFront(c),c.val},reset:function(){this.size=0;this.hash={};this.list=new h}});e.mixin(h.prototype,{add:function(c){this.head&&(c.next=this.head,this.head.prev=
c);this.head=c;this.tail=this.tail||c},remove:function(c){c.prev?c.prev.next=c.next:this.head=c.next;c.next?c.next.prev=c.prev:this.tail=c.prev},moveToFront:function(c){this.remove(c);this.add(c)}});return b}(),B=function(){function b(a){this.prefix=["__",a,"__"].join("");this.ttlKey="__ttl__";this.keyMatcher=new RegExp("^"+e.escapeRegExChars(this.prefix))}function f(a){return JSON.stringify(e.isUndefined(a)?null:a)}var d;try{d=window.localStorage,d.setItem("~~~","!"),d.removeItem("~~~")}catch(c){d=
null}e.mixin(b.prototype,d&&window.JSON?{_prefix:function(a){return this.prefix+a},_ttlKey:function(a){return this._prefix(a)+this.ttlKey},get:function(a){this.isExpired(a)&&this.remove(a);a=d.getItem(this._prefix(a));return JSON.parse(a)},set:function(a,g,c){e.isNumber(c)?d.setItem(this._ttlKey(a),f((new Date).getTime()+c)):d.removeItem(this._ttlKey(a));return d.setItem(this._prefix(a),f(g))},remove:function(a){d.removeItem(this._ttlKey(a));d.removeItem(this._prefix(a));return this},clear:function(){var a,
g,c=[],b=d.length;for(a=0;a<b;a++)(g=d.key(a)).match(this.keyMatcher)&&c.push(g.replace(this.keyMatcher,""));for(a=c.length;a--;)this.remove(c[a]);return this},isExpired:function(a){a=d.getItem(this._ttlKey(a));a=JSON.parse(a);return e.isNumber(a)&&(new Date).getTime()>a?!0:!1}}:{get:e.noop,set:e.noop,remove:e.noop,clear:e.noop,isExpired:e.noop});return b}(),x=function(){function b(a){a=a||{};this.cancelled=!1;this.lastUrl=null;this._send=a.transport?h(a.transport):f.ajax;this._get=a.rateLimiter?
a.rateLimiter(this._get):this._get;this._cache=!1===a.cache?new v(0):g}function h(a){return function(g,c){var b=f.Deferred();a(g,c,function(a){e.defer(function(){b.resolve(a)})},function(a){e.defer(function(){b.reject(a)})});return b}}var d=0,c={},a=6,g=new v(10);b.setMaxPendingRequests=function(g){a=g};b.resetCache=function(){g.reset()};e.mixin(b.prototype,{_get:function(g,b,k){function e(a){k&&k(null,a);q._cache.set(g,a)}function f(){k&&k(!0)}function h(){d--;delete c[g];q.onDeckRequestArgs&&(q._get.apply(q,
q.onDeckRequestArgs),q.onDeckRequestArgs=null)}var q=this,p;this.cancelled||g!==this.lastUrl||((p=c[g])?p.done(e).fail(f):d<a?(d++,c[g]=this._send(g,b).done(e).fail(f).always(h)):this.onDeckRequestArgs=[].slice.call(arguments,0))},get:function(a,g,c){var b;e.isFunction(g)&&(c=g,g={});this.cancelled=!1;this.lastUrl=a;(b=this._cache.get(a))?e.defer(function(){c&&c(null,b)}):this._get(a,g,c);return!!b},cancel:function(){this.cancelled=!0}});return b}(),C=function(){function b(a){a=a||{};a.datumTokenizer&&
a.queryTokenizer||f.error("datumTokenizer and queryTokenizer are both required");this.datumTokenizer=a.datumTokenizer;this.queryTokenizer=a.queryTokenizer;this.reset()}function h(a){a=e.filter(a,function(a){return!!a});return a=e.map(a,function(a){return a.toLowerCase()})}function d(a){for(var g={},c=[],b=0,d=a.length;b<d;b++)g[a[b]]||(g[a[b]]=!0,c.push(a[b]));return c}function c(a,g){function c(a,g){return a-g}var b=0,d=0,e=[];a=a.sort(c);g=g.sort(c);for(var f=a.length,h=g.length;b<f&&d<h;)a[b]<
g[d]?b++:(a[b]>g[d]||(e.push(a[b]),b++),d++);return e}e.mixin(b.prototype,{bootstrap:function(a){this.datums=a.datums;this.trie=a.trie},add:function(a){var g=this;a=e.isArray(a)?a:[a];e.each(a,function(a){var c;c=g.datums.push(a)-1;a=h(g.datumTokenizer(a));e.each(a,function(a){var b,l;b=g.trie;for(a=a.split("");l=a.shift();)b=b.children[l]||(b.children[l]={ids:[],children:{}}),b.ids.push(c)})})},get:function(a){var g=this,b;a=h(this.queryTokenizer(a));e.each(a,function(a){var d,e;if(b&&0===b.length)return!1;
d=g.trie;for(a=a.split("");d&&(e=a.shift());)d=d.children[e];if(d&&0===a.length)d=d.ids.slice(0),b=b?c(b,d):d;else return b=[],!1});return b?e.map(d(b),function(a){return g.datums[a]}):[]},reset:function(){this.datums=[];this.trie={ids:[],children:{}}},serialize:function(){return{datums:this.datums,trie:this.trie}}});return b}(),t=function(){return{local:function(b){return b.local||null},prefetch:function(b){var h;h={url:null,thumbprint:"",ttl:864E5,filter:null,ajax:{}};if(b=b.prefetch||null)b=e.isString(b)?
{url:b}:b,b=e.mixin(h,b),b.thumbprint="0.10.5"+b.thumbprint,b.ajax.type=b.ajax.type||"GET",b.ajax.dataType=b.ajax.dataType||"json",!b.url&&f.error("prefetch requires url to be set");return b},remote:function(b){function h(a){return function(g){return e.debounce(g,a)}}function d(a){return function(g){return e.throttle(g,a)}}var c;c={url:null,cache:!0,wildcard:"%QUERY",replace:null,rateLimitBy:"debounce",rateLimitWait:300,send:null,filter:null,ajax:{}};if(b=b.remote||null)b=e.isString(b)?{url:b}:b,
b=e.mixin(c,b),b.rateLimiter=/^throttle$/i.test(b.rateLimitBy)?d(b.rateLimitWait):h(b.rateLimitWait),b.ajax.type=b.ajax.type||"GET",b.ajax.dataType=b.ajax.dataType||"json",delete b.rateLimitBy,delete b.rateLimitWait,!b.url&&f.error("remote requires url to be set");return b}}}();(function(b){function h(a){a&&(a.local||a.prefetch||a.remote)||f.error("one of local, prefetch, or remote is required");this.limit=a.limit||5;this.sorter=d(a.sorter);this.dupDetector=a.dupDetector||c;this.local=t.local(a);
this.prefetch=t.prefetch(a);this.remote=t.remote(a);this.cacheKey=this.prefetch?this.prefetch.cacheKey||this.prefetch.url:null;this.index=new C({datumTokenizer:a.datumTokenizer,queryTokenizer:a.queryTokenizer});this.storage=this.cacheKey?new B(this.cacheKey):null}function d(a){function c(b){return b.sort(a)}function b(a){return a}return e.isFunction(a)?c:b}function c(){return!1}var a;a=b.Bloodhound;b.Bloodhound=h;h.noConflict=function(){b.Bloodhound=a;return h};h.tokenizers=A;e.mixin(h.prototype,
{_loadPrefetch:function(a){function c(d){b.clear();b.add(a.filter?a.filter(d):d);b._saveToStorage(b.index.serialize(),a.thumbprint,a.ttl)}var b=this,d;(d=this._readFromStorage(a.thumbprint))?(this.index.bootstrap(d),d=f.Deferred().resolve()):d=f.ajax(a.url,a.ajax).done(c);return d},_getFromRemote:function(a,c){function b(a,g){a?c([]):c(d.remote.filter?d.remote.filter(g):g)}var d=this,e;if(this.transport)return a=a||"",e=encodeURIComponent(a),e=this.remote.replace?this.remote.replace(this.remote.url,
a):this.remote.url.replace(this.remote.wildcard,e),this.transport.get(e,this.remote.ajax,b)},_cancelLastRemoteRequest:function(){this.transport&&this.transport.cancel()},_saveToStorage:function(a,c,b){this.storage&&(this.storage.set("data",a,b),this.storage.set("protocol",location.protocol,b),this.storage.set("thumbprint",c,b))},_readFromStorage:function(a){var c,b,d;this.storage&&(c=this.storage.get("data"),b=this.storage.get("protocol"),d=this.storage.get("thumbprint"));a=d!==a||b!==location.protocol;
return c&&!a?c:null},_initialize:function(){function a(){c.add(e.isFunction(b)?b():b)}var c=this,b=this.local,d;d=this.prefetch?this._loadPrefetch(this.prefetch):f.Deferred().resolve();b&&d.done(a);this.transport=this.remote?new x(this.remote):null;return this.initPromise=d.promise()},initialize:function(a){return!this.initPromise||a?this._initialize():this.initPromise},add:function(a){this.index.add(a)},get:function(a,c){function b(a){var g=f.slice(0);e.each(a,function(a){!e.some(g,function(c){return d.dupDetector(a,
c)})&&g.push(a);return g.length<d.limit});c&&c(d.sorter(g))}var d=this,f=[],h=!1,f=this.index.get(a),f=this.sorter(f).slice(0,this.limit);f.length<this.limit?h=this._getFromRemote(a,b):this._cancelLastRemoteRequest();h||(0<f.length||!this.transport)&&c&&c(f)},clear:function(){this.index.reset()},clearPrefetchCache:function(){this.storage&&this.storage.clear()},clearRemoteCache:function(){this.transport&&x.resetCache()},ttAdapter:function(){return e.bind(this.get,this)}});return h})(this);var p=function(){var b=
{wrapper:{position:"relative",display:"inline-block"},hint:{position:"absolute",top:"0",left:"0",borderColor:"transparent",boxShadow:"none",opacity:"1"},input:{position:"relative",verticalAlign:"top",backgroundColor:"transparent"},inputWithNoHint:{position:"relative",verticalAlign:"top"},dropdown:{position:"absolute",top:"100%",left:"0",zIndex:"100",display:"none"},suggestions:{display:"block"},suggestion:{whiteSpace:"nowrap",cursor:"pointer"},suggestionChild:{whiteSpace:"normal"},ltr:{left:"0",right:"auto"},
rtl:{left:"auto",right:" 0"}};e.isMsie()&&e.mixin(b.input,{backgroundImage:"url(data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7)"});e.isMsie()&&7>=e.isMsie()&&e.mixin(b.input,{marginTop:"-1px"});return b}(),y=function(){function b(b){b&&b.el||f.error("EventBus initialized without el");this.$el=f(b.el)}e.mixin(b.prototype,{trigger:function(b){var d=[].slice.call(arguments,1);this.$el.trigger("typeahead:"+b,d)}});return b}(),u=function(){function b(a,b,e,f){if(!e)return this;
b=b.split(c);e=f?d(e,f):e;for(this._callbacks=this._callbacks||{};f=b.shift();)this._callbacks[f]=this._callbacks[f]||{sync:[],async:[]},this._callbacks[f][a].push(e);return this}function e(a,c,b){return function(){for(var d,e=0,f=a.length;!d&&e<f;e+=1)d=!1===a[e].apply(c,b);return!d}}function d(a,c){return a.bind?a.bind(c):function(){a.apply(c,[].slice.call(arguments,0))}}var c=/\s+/,a=function(){return window.setImmediate?function(a){setImmediate(function(){a()})}:function(a){setTimeout(function(){a()},
0)}}();return{onSync:function(a,c,d){return b.call(this,"sync",a,c,d)},onAsync:function(a,c,d){return b.call(this,"async",a,c,d)},off:function(a){var b;if(!this._callbacks)return this;for(a=a.split(c);b=a.shift();)delete this._callbacks[b];return this},trigger:function(b){var d,f,k,m,w;if(!this._callbacks)return this;b=b.split(c);for(k=[].slice.call(arguments,1);(d=b.shift())&&(f=this._callbacks[d]);)m=e(f.sync,this,[d].concat(k)),w=e(f.async,this,[d].concat(k)),m()&&a(w);return this}}}(),D=function(b){function f(c,
a,b){for(var d=[],n=0,k=c.length;n<k;n++)d.push(e.escapeRegExChars(c[n]));c=b?"\\b("+d.join("|")+")\\b":"("+d.join("|")+")";return a?new RegExp(c):new RegExp(c,"i")}var d={node:null,pattern:null,tagName:"strong",className:null,wordsOnly:!1,caseSensitive:!1};return function(c){function a(a){var d,g,e;if(d=l.exec(a.data))e=b.createElement(c.tagName),c.className&&(e.className=c.className),g=a.splitText(d.index),g.splitText(d[0].length),e.appendChild(g.cloneNode(!0)),a.parentNode.replaceChild(e,g);return!!d}
function g(a,c){for(var b,d=0;d<a.childNodes.length;d++)b=a.childNodes[d],3===b.nodeType?d+=c(b)?1:0:g(b,c)}var l;c=e.mixin({},d,c);c.node&&c.pattern&&(c.pattern=e.isArray(c.pattern)?c.pattern:[c.pattern],l=f(c.pattern,c.caseSensitive,c.wordsOnly),g(c.node,a))}}(window.document),z=function(){function b(a){var b=this,d,n,k,m;a=a||{};a.input||f.error("input is missing");d=e.bind(this._onBlur,this);n=e.bind(this._onFocus,this);k=e.bind(this._onKeydown,this);m=e.bind(this._onInput,this);this.$hint=f(a.hint);
this.$input=f(a.input).on("blur.tt",d).on("focus.tt",n).on("keydown.tt",k);0===this.$hint.length&&(this.setHint=this.getHint=this.clearHint=this.clearHintIfInvalid=e.noop);if(e.isMsie())this.$input.on("keydown.tt keypress.tt cut.tt paste.tt",function(a){c[a.which||a.keyCode]||e.defer(e.bind(b._onInput,b,a))});else this.$input.on("input.tt",m);this.query=this.$input.val();this.$overflowHelper=h(this.$input)}function h(a){return f('<pre aria-hidden="true"></pre>').css({position:"absolute",visibility:"hidden",
whiteSpace:"pre",fontFamily:a.css("font-family"),fontSize:a.css("font-size"),fontStyle:a.css("font-style"),fontVariant:a.css("font-variant"),fontWeight:a.css("font-weight"),wordSpacing:a.css("word-spacing"),letterSpacing:a.css("letter-spacing"),textIndent:a.css("text-indent"),textRendering:a.css("text-rendering"),textTransform:a.css("text-transform")}).insertAfter(a)}function d(a){return a.altKey||a.ctrlKey||a.metaKey||a.shiftKey}var c;c={9:"tab",27:"esc",37:"left",39:"right",13:"enter",38:"up",40:"down"};
b.normalizeQuery=function(a){return(a||"").replace(/^\s*/g,"").replace(/\s{2,}/g," ")};e.mixin(b.prototype,u,{_onBlur:function(){this.resetInputValue();this.trigger("blurred")},_onFocus:function(){this.trigger("focused")},_onKeydown:function(a){var b=c[a.which||a.keyCode];this._managePreventDefault(b,a);b&&this._shouldTrigger(b,a)&&this.trigger(b+"Keyed",a)},_onInput:function(){this._checkInputValue()},_managePreventDefault:function(a,c){var b,e;switch(a){case "tab":b=this.getHint();e=this.getInputValue();
b=b&&b!==e&&!d(c);break;case "up":case "down":b=!d(c);break;default:b=!1}b&&c.preventDefault()},_shouldTrigger:function(a,c){var b;switch(a){case "tab":b=!d(c);break;default:b=!0}return b},_checkInputValue:function(){var a,c,d;a=this.getInputValue();c=this.query;d=(c=b.normalizeQuery(a)===b.normalizeQuery(c))?this.query.length!==a.length:!1;this.query=a;c?d&&this.trigger("whitespaceChanged",this.query):this.trigger("queryChanged",this.query)},focus:function(){this.$input.focus()},blur:function(){this.$input.blur()},
getQuery:function(){return this.query},setQuery:function(a){this.query=a},getInputValue:function(){return this.$input.val()},setInputValue:function(a,c){this.$input.val(a);c?this.clearHint():this._checkInputValue()},resetInputValue:function(){this.setInputValue(this.query,!0)},getHint:function(){return this.$hint.val()},setHint:function(a){this.$hint.val(a)},clearHint:function(){this.setHint("")},clearHintIfInvalid:function(){var a,c;a=this.getInputValue();c=this.getHint();c=a!==c&&0===c.indexOf(a);
""!==a&&c&&!this.hasOverflow()||this.clearHint()},getLanguageDirection:function(){return(this.$input.css("direction")||"ltr").toLowerCase()},hasOverflow:function(){var a=this.$input.width()-2;this.$overflowHelper.text(this.getInputValue());return this.$overflowHelper.width()>=a},isCursorAtEnd:function(){var a,c;a=this.$input.val().length;c=this.$input[0].selectionStart;return e.isNumber(c)?c===a:document.selection?(c=document.selection.createRange(),c.moveStart("character",-a),a===c.text.length):
!0},destroy:function(){this.$hint.off(".tt");this.$input.off(".tt");this.$hint=this.$input=this.$overflowHelper=null}});return b}(),r=function(){function b(c){c=c||{};c.templates=c.templates||{};c.source||f.error("missing source");c.name&&!/^[_a-zA-Z0-9-]+$/.test(c.name)&&f.error("invalid dataset name: "+c.name);this.query=null;this.highlight=!!c.highlight;this.name=c.name||e.getUniqueId();this.source=c.source;this.displayFn=h(c.display||c.displayKey);this.templates=d(c.templates,this.displayFn);
this.$el=f('<div class="tt-dataset-%CLASS%"></div>'.replace("%CLASS%",this.name))}function h(c){function a(a){return a[c]}c=c||"value";return e.isFunction(c)?c:a}function d(c,a){function b(c){return"<p>"+a(c)+"</p>"}return{empty:c.empty&&e.templatify(c.empty),header:c.header&&e.templatify(c.header),footer:c.footer&&e.templatify(c.footer),suggestion:c.suggestion||b}}b.extractDatasetName=function(c){return f(c).data("ttDataset")};b.extractValue=function(c){return f(c).data("ttValue")};b.extractDatum=
function(c){return f(c).data("ttDatum")};e.mixin(b.prototype,u,{_render:function(c,a){function b(){var d,g;d=f('<span class="tt-suggestions"></span>').css(p.suggestions);g=e.map(a,function(a){a=f('<div class="tt-suggestion"></div>').append(k.templates.suggestion(a)).data("ttDataset",k.name).data("ttValue",k.displayFn(a)).data("ttDatum",a);a.children().each(function(){f(this).css(p.suggestionChild)});return a});d.append.apply(d,g);k.highlight&&D({className:"tt-highlight",node:d[0],pattern:c});return d}
function d(){return k.templates.header({query:c,isEmpty:!m})}function h(){return k.templates.footer({query:c,isEmpty:!m})}if(this.$el){var k=this,m;this.$el.empty();m=a&&a.length;!m&&this.templates.empty?this.$el.html(k.templates.empty({query:c,isEmpty:!0})).prepend(k.templates.header?d():null).append(k.templates.footer?h():null):m&&this.$el.html(b()).prepend(k.templates.header?d():null).append(k.templates.footer?h():null);this.trigger("rendered")}},getRoot:function(){return this.$el},update:function(c){var a=
this;this.query=c;this.canceled=!1;this.source(c,function(b){a.canceled||c!==a.query||a._render(c,b)})},cancel:function(){this.canceled=!0},clear:function(){this.cancel();this.$el.empty();this.trigger("rendered")},isEmpty:function(){return this.$el.is(":empty")},destroy:function(){this.$el=null}});return b}(),E=function(){function b(b){var c=this,a,g,l;b=b||{};b.menu||f.error("menu is required");this.isOpen=!1;this.isEmpty=!0;this.datasets=e.map(b.datasets,h);a=e.bind(this._onSuggestionClick,this);
g=e.bind(this._onSuggestionMouseEnter,this);l=e.bind(this._onSuggestionMouseLeave,this);this.$menu=f(b.menu).on("click.tt",".tt-suggestion",a).on("mouseenter.tt",".tt-suggestion",g).on("mouseleave.tt",".tt-suggestion",l);e.each(this.datasets,function(a){c.$menu.append(a.getRoot());a.onSync("rendered",c._onRendered,c)})}function h(b){return new r(b)}e.mixin(b.prototype,u,{_onSuggestionClick:function(b){this.trigger("suggestionClicked",f(b.currentTarget))},_onSuggestionMouseEnter:function(b){this._removeCursor();
this._setCursor(f(b.currentTarget),!0)},_onSuggestionMouseLeave:function(){this._removeCursor()},_onRendered:function(){(this.isEmpty=e.every(this.datasets,function(b){return b.isEmpty()}))?this._hide():this.isOpen&&this._show();this.trigger("datasetRendered")},_hide:function(){this.$menu.hide()},_show:function(){this.$menu.css("display","block")},_getSuggestions:function(){return this.$menu.find(".tt-suggestion")},_getCursor:function(){return this.$menu.find(".tt-cursor").first()},_setCursor:function(b,
c){b.first().addClass("tt-cursor");!c&&this.trigger("cursorMoved")},_removeCursor:function(){this._getCursor().removeClass("tt-cursor")},_moveCursor:function(b){var c,a;this.isOpen&&(a=this._getCursor(),c=this._getSuggestions(),this._removeCursor(),b=c.index(a)+b,b=(b+1)%(c.length+1)-1,-1===b?this.trigger("cursorRemoved"):(-1>b&&(b=c.length-1),this._setCursor(c=c.eq(b)),this._ensureVisible(c)))},_ensureVisible:function(b){var c,a,e;c=b.position().top;b=c+b.outerHeight(!0);a=this.$menu.scrollTop();
e=this.$menu.height()+parseInt(this.$menu.css("paddingTop"),10)+parseInt(this.$menu.css("paddingBottom"),10);0>c?this.$menu.scrollTop(a+c):e<b&&this.$menu.scrollTop(a+(b-e))},close:function(){this.isOpen&&(this.isOpen=!1,this._removeCursor(),this._hide(),this.trigger("closed"))},open:function(){this.isOpen||(this.isOpen=!0,!this.isEmpty&&this._show(),this.trigger("opened"))},setLanguageDirection:function(b){this.$menu.css("ltr"===b?p.ltr:p.rtl)},moveCursorUp:function(){this._moveCursor(-1)},moveCursorDown:function(){this._moveCursor(1)},
getDatumForSuggestion:function(b){var c=null;b.length&&(c={raw:r.extractDatum(b),value:r.extractValue(b),datasetName:r.extractDatasetName(b)});return c},getDatumForCursor:function(){return this.getDatumForSuggestion(this._getCursor().first())},getDatumForTopSuggestion:function(){return this.getDatumForSuggestion(this._getSuggestions().first())},update:function(b){e.each(this.datasets,function(c){c.update(b)})},empty:function(){e.each(this.datasets,function(b){b.clear()});this.isEmpty=!0},isVisible:function(){return this.isOpen&&
!this.isEmpty},destroy:function(){this.$menu.off(".tt");this.$menu=null;e.each(this.datasets,function(b){b.destroy()})}});return b}(),F=function(){function b(a){var b,c,d;a=a||{};a.input||f.error("missing input");this.isActivated=!1;this.autoselect=!!a.autoselect;this.minLength=e.isNumber(a.minLength)?a.minLength:1;this.$node=h(a.input,a.withHint);b=this.$node.find(".tt-dropdown-menu");c=this.$node.find(".tt-input");d=this.$node.find(".tt-hint");c.on("blur.tt",function(a){var d,f;d=document.activeElement;
f=b.is(d);d=0<b.has(d).length;e.isMsie()&&(f||d)&&(a.preventDefault(),a.stopImmediatePropagation(),e.defer(function(){c.focus()}))});b.on("mousedown.tt",function(a){a.preventDefault()});this.eventBus=a.eventBus||new y({el:c});this.dropdown=(new E({menu:b,datasets:a.datasets})).onSync("suggestionClicked",this._onSuggestionClicked,this).onSync("cursorMoved",this._onCursorMoved,this).onSync("cursorRemoved",this._onCursorRemoved,this).onSync("opened",this._onOpened,this).onSync("closed",this._onClosed,
this).onAsync("datasetRendered",this._onDatasetRendered,this);this.input=(new z({input:c,hint:d})).onSync("focused",this._onFocused,this).onSync("blurred",this._onBlurred,this).onSync("enterKeyed",this._onEnterKeyed,this).onSync("tabKeyed",this._onTabKeyed,this).onSync("escKeyed",this._onEscKeyed,this).onSync("upKeyed",this._onUpKeyed,this).onSync("downKeyed",this._onDownKeyed,this).onSync("leftKeyed",this._onLeftKeyed,this).onSync("rightKeyed",this._onRightKeyed,this).onSync("queryChanged",this._onQueryChanged,
this).onSync("whitespaceChanged",this._onWhitespaceChanged,this);this._setLanguageDirection()}function h(a,b){var c,e,h,m;c=f(a);e=f('<span class="twitter-typeahead"></span>').css(p.wrapper);h=f('<span class="tt-dropdown-menu"></span>').css(p.dropdown);m=c.clone().css(p.hint).css(d(c));m.val("").removeData().addClass("tt-hint").removeAttr("id name placeholder required").prop("readonly",!0).attr({autocomplete:"off",spellcheck:"false",tabindex:-1});c.data("ttAttrs",{dir:c.attr("dir"),autocomplete:c.attr("autocomplete"),
spellcheck:c.attr("spellcheck"),style:c.attr("style")});c.addClass("tt-input").attr({autocomplete:"off",spellcheck:!1}).css(b?p.input:p.inputWithNoHint);try{!c.attr("dir")&&c.attr("dir","auto")}catch(r){}return c.wrap(e).parent().prepend(b?m:null).append(h)}function d(a){return{backgroundAttachment:a.css("background-attachment"),backgroundClip:a.css("background-clip"),backgroundColor:a.css("background-color"),backgroundImage:a.css("background-image"),backgroundOrigin:a.css("background-origin"),backgroundPosition:a.css("background-position"),
backgroundRepeat:a.css("background-repeat"),backgroundSize:a.css("background-size")}}function c(a){var b=a.find(".tt-input");e.each(b.data("ttAttrs"),function(a,c){e.isUndefined(a)?b.removeAttr(c):b.attr(c,a)});b.detach().removeData("ttAttrs").removeClass("tt-input").insertAfter(a);a.remove()}e.mixin(b.prototype,{_onSuggestionClicked:function(a,b){var c;(c=this.dropdown.getDatumForSuggestion(b))&&this._select(c)},_onCursorMoved:function(){var a=this.dropdown.getDatumForCursor();this.input.setInputValue(a.value,
!0);this.eventBus.trigger("cursorchanged",a.raw,a.datasetName)},_onCursorRemoved:function(){this.input.resetInputValue();this._updateHint()},_onDatasetRendered:function(){this._updateHint()},_onOpened:function(){this._updateHint();this.eventBus.trigger("opened")},_onClosed:function(){this.input.clearHint();this.eventBus.trigger("closed")},_onFocused:function(){this.isActivated=!0;this.dropdown.open()},_onBlurred:function(){this.isActivated=!1;this.dropdown.empty();this.dropdown.close()},_onEnterKeyed:function(a,
b){var c,d;c=this.dropdown.getDatumForCursor();d=this.dropdown.getDatumForTopSuggestion();c?(this._select(c),b.preventDefault()):this.autoselect&&d&&(this._select(d),b.preventDefault())},_onTabKeyed:function(a,b){var c;(c=this.dropdown.getDatumForCursor())?(this._select(c),b.preventDefault()):this._autocomplete(!0)},_onEscKeyed:function(){this.dropdown.close();this.input.resetInputValue()},_onUpKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):
this.dropdown.moveCursorUp();this.dropdown.open()},_onDownKeyed:function(){var a=this.input.getQuery();this.dropdown.isEmpty&&a.length>=this.minLength?this.dropdown.update(a):this.dropdown.moveCursorDown();this.dropdown.open()},_onLeftKeyed:function(){"rtl"===this.dir&&this._autocomplete()},_onRightKeyed:function(){"ltr"===this.dir&&this._autocomplete()},_onQueryChanged:function(a,b){this.input.clearHintIfInvalid();b.length>=this.minLength?this.dropdown.update(b):this.dropdown.empty();this.dropdown.open();
this._setLanguageDirection()},_onWhitespaceChanged:function(){this._updateHint();this.dropdown.open()},_setLanguageDirection:function(){var a;this.dir!==(a=this.input.getLanguageDirection())&&(this.dir=a,this.$node.css("direction",a),this.dropdown.setLanguageDirection(a))},_updateHint:function(){var a,b,c;(a=this.dropdown.getDatumForTopSuggestion())&&this.dropdown.isVisible()&&!this.input.hasOverflow()?(b=this.input.getInputValue(),c=z.normalizeQuery(b),c=e.escapeRegExChars(c),c=new RegExp("^(?:"+
c+")(.+$)","i"),(a=c.exec(a.value))?this.input.setHint(b+a[1]):this.input.clearHint()):this.input.clearHint()},_autocomplete:function(a){var b,c;b=this.input.getHint();c=this.input.getQuery();a=a||this.input.isCursorAtEnd();b&&c!==b&&a&&((b=this.dropdown.getDatumForTopSuggestion())&&this.input.setInputValue(b.value),this.eventBus.trigger("autocompleted",b.raw,b.datasetName))},_select:function(a){this.input.setQuery(a.value);this.input.setInputValue(a.value,!0);this._setLanguageDirection();this.eventBus.trigger("selected",
a.raw,a.datasetName);this.dropdown.close();e.defer(e.bind(this.dropdown.empty,this.dropdown))},open:function(){this.dropdown.open()},close:function(){this.dropdown.close()},setVal:function(a){a=e.toStr(a);this.isActivated?this.input.setInputValue(a):(this.input.setQuery(a),this.input.setInputValue(a,!0));this._setLanguageDirection()},getVal:function(){return this.input.getQuery()},destroy:function(){this.input.destroy();this.dropdown.destroy();c(this.$node);this.$node=null}});return b}();(function(){var b,
h;b=f.fn.typeahead;h={initialize:function(b,c){c=e.isArray(c)?c:[].slice.call(arguments,1);b=b||{};return this.each(function(){var a=f(this),g;e.each(c,function(a){a.highlight=!!b.highlight});g=new F({input:a,eventBus:new y({el:a}),withHint:e.isUndefined(b.hint)?!0:!!b.hint,minLength:b.minLength,autoselect:b.autoselect,datasets:c});a.data("ttTypeahead",g)})},open:function(){return this.each(function(){var b;(b=f(this).data("ttTypeahead"))&&b.open()})},close:function(){return this.each(function(){var b;
(b=f(this).data("ttTypeahead"))&&b.close()})},val:function(b){function c(){var a;(a=f(this).data("ttTypeahead"))&&a.setVal(b)}function a(a){var b;if(a=a.data("ttTypeahead"))b=a.getVal();return b}return arguments.length?this.each(c):a(this.first())},destroy:function(){return this.each(function(){var b=f(this),c;if(c=b.data("ttTypeahead"))c.destroy(),b.removeData("ttTypeahead")})}};f.fn.typeahead=function(b){var c;return h[b]&&"initialize"!==b?(c=this.filter(function(){return!!f(this).data("ttTypeahead")}),
h[b].apply(c,[].slice.call(arguments,1))):h.initialize.apply(this,arguments)};f.fn.typeahead.noConflict=function(){f.fn.typeahead=b;return this}})()})(window.jQuery);
